<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Nana7ha's Café Stella" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Nana7ha's Café Stella" type="application/atom+xml"><link rel="alternate" type="application/json" title="Nana7ha's Café Stella" href="http://cwlrin.wiki/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.20"><link rel="modulepreload" href="/js/chunk-NPDU2HRQ.js"></link><link rel="modulepreload" href="/js/chunk-R2ID445Y.js"></link><link rel="modulepreload" href="/js/chunk-YHPSMGA6.js"></link><link rel="modulepreload" href="/js/copy-tex-2AKW2INC.js"></link><link rel="modulepreload" href="/js/index.esm-TLZT3I4E.js"></link><link rel="modulepreload" href="/js/post-AWU7OAKV.js"></link><link rel="modulepreload" href="/js/quicklink-3TNKEFE4.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="preload" href="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VmQ1I5OEM4aEJKS3BvYlc0UVE4YjZJQkRMTXhpUm52RE93b3dLeC15WnJDRVE_ZT1RcUY5TDc.jpg" as="image" fetchpriority="high"><meta name="keywords" content="C,"/><meta name="description" content="技术与美日新月异"/><link rel="canonical" href="http://cwlrin.wiki/c-cpp/linux-c/Linux%20%E7%9B%AE%E5%BD%95%E6%B5%81/"><title>Linux 目录流</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Linux 目录流</h1><div class="meta"><span class="item" title="创建时间：2020-08-13 22:07:19"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2020-08-13T22:07:19+08:00">2020-08-13</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>25k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>23 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">七葉の喫茶ステラ</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VmQ1I5OEM4aEJKS3BvYlc0UVE4YjZJQkRMTXhpUm52RE93b3dLeC15WnJDRVE_ZT1RcUY5TDc.jpg" loading="eager" decoding="async" fetchpriority="high" alt="Nana7ha's Café Stella"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/c-cpp/" itemprop="item" rel="index" title="分类于C/C++"><span itemprop="name">C/C++<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/c-cpp/linux-c/" itemprop="item" rel="index" title="分类于Linux C"><span itemprop="name">Linux C<meta itemprop="position" content="1"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://cwlrin.wiki/c-cpp/linux-c/Linux%20%E7%9B%AE%E5%BD%95%E6%B5%81/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="樱小路七叶"/><meta itemprop="description" content=", 技术与美日新月异"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Nana7ha's Café Stella"/></span><div class="body md" itemprop="articleBody"><h2 id="文件系统编程概述"><a class="anchor" href="#文件系统编程概述">#</a> 文件系统编程概述</h2>
<h3 id="三种类型的函数对比"><a class="anchor" href="#三种类型的函数对比">#</a> 三种类型的函数对比</h3>
<p><strong>ISO C 标准库函数</strong>：</p>
<ul>
<li>
<p>这些函数是由 ISO（国际标准化组织）提供的，具有最好的通用性和跨平台性。在所有遵循 ISO 标准的现代 C 编译平台上，这些函数的行为都是一致的。</p>
</li>
<li>
<p>这些函数提供了一些通用的功能实现，例如： <code>printf</code> 、 <code>scanf</code> 、 <code>fopen</code> 、 <code>malloc</code>  等。</p>
</li>
<li>
<p>它们在 man 手册的第 3 部分（3 号手册）中有所描述。</p>
</li>
</ul>
<p><strong>POSIX 标准库函数</strong>：</p>
<ul>
<li>
<p>POSIX-C 标准旨在为不同的类 Unix 操作系统提供一致的编程接口，以实现应用程序的跨平台移植。</p>
</li>
<li>
<p>这些函数同样是库函数，也在 man 手册的第 3 部分中描述。</p>
</li>
<li>
<p>典型的 POSIX 标准库函数，如  <code>opendir</code>  和  <code>closedir</code> ，用于在 Linux 环境下操作目录文件。</p>
</li>
</ul>
<p><strong>POSIX 标准系统调用函数</strong>：</p>
<ul>
<li>
<p>这些是遵循 POSIX 标准的系统调用接口，它们在所有类 Unix 平台上较为通用。</p>
</li>
<li>
<p>系统调用函数是 Linux 系统内核和应用程序交互的接口。它们直接与内核交互，因此其通用性和跨平台性相对较差，因为它们的实现依赖于内核的架构和细节。</p>
</li>
</ul>
<h3 id="函数的返回值和形参"><a class="anchor" href="#函数的返回值和形参">#</a> 函数的返回值和形参</h3>
<p>在 C 语言中，函数返回值常用于指示函数是否成功执行。如果函数返回一个特殊的值，这通常表示发生了错误。</p>
<p><strong>返回值类型与错误标志</strong>：</p>
<ul>
<li>函数返回值类型为  <code>void</code>  时，表示函数不返回任何值，通常不需要进行错误处理。</li>
<li>当函数返回  <code>int</code>  类型时，错误标志通常是  <code>-1</code> 。</li>
<li>对于返回  <code>size_t</code>  类型的函数，错误标志通常是  <code>0</code> ，因为  <code>size_t</code>  是一个无符号整数类型。</li>
<li>返回  <code>ssize_t</code>  类型的函数，错误标志同样是  <code>-1</code> ， <code>ssize_t</code>  是有符号整数类型。</li>
<li>如果函数返回指针类型，错误标志通常是  <code>NULL</code> ，表示未找到或无法分配内存。</li>
</ul>
<p><strong>指针返回值</strong>：</p>
<ul>
<li>指针类型的返回值表示函数可能在堆上分配了内存或获取了资源。这通常意味着需要手动管理这些资源，如释放内存或关闭资源，除非文档中明确指出不需要这样做。</li>
</ul>
<p>在查看函数的参数列表时，指针类型的参数尤其重要。需要检查指针是否被  <code>const</code>  修饰：</p>
<ol>
<li>被  <code>const</code>  修饰的指针参数表示函数不会修改它指向的内存区域。</li>
<li>未被  <code>const</code>  修饰的指针参数表示函数可能会修改它指向的内存区域。</li>
</ol>
<h2 id="目录流相关函数"><a class="anchor" href="#目录流相关函数">#</a> 目录流相关函数</h2>
<h3 id="chmod-改变文件权限"><a class="anchor" href="#chmod-改变文件权限">#</a>  <code>chmod</code>  改变文件权限</h3>
<p><code>chmod</code>  是一个在 Unix 和类 Unix 系统中广泛使用的系统调用，用于改变文件或目录的权限。这个函数定义在 POSIX 标准中，并且通常在 C 语言的  <code>sys/stat.h</code>  头文件中声明。</p>
<p>函数原型  <code>int chmod(const char *pathname, mode_t mode);</code>  包含两个参数：</p>
<ol>
<li><code>pathname</code> ：一个指向以 null 结尾的字符串的指针，这个字符串包含了要改变权限的文件或目录的路径。</li>
<li><code>mode</code> ：一个新的文件模式，它定义了文件或目录的权限。这个模式是一个位掩码，通常使用宏来表示不同的权限设置，例如  <code>S_IRUSR</code> （用户读权限）、 <code>S_IWUSR</code> （用户写权限）、 <code>S_IXUSR</code> （用户执行权限）等。</li>
</ol>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回 0。</li>
<li>如果函数执行失败，返回 -1，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p><code>mode_t</code>  是一个在  <code>&lt;sys/types.h&gt;</code>  中定义的类型，通常是一个无符号整数类型，用于表示文件的模式。</p>
<p>下面是一个示例：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">mode_t</span> mode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">sscanf</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%o"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mode <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// % o 表示八进制无符号数</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">chmod</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"chmod"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VYbG1pRklyU3FaQW9wWk9ITGR3ZG5RQl9yRnJBbDFGYXRFanJxbWgtRG1FTEE_ZT14Q2kzanU.png" alt="" /></p>
<p>需要注意的是：设置权限时需要传参权限的 &quot;数字表示法&quot;，而且设定的权限就是文件的最终权限，掩码只会影响新建文件，不会影响  <code>chmod</code>  函数。</p>
<h3 id="getcwd-获取当前工作目录的完整路径"><a class="anchor" href="#getcwd-获取当前工作目录的完整路径">#</a>  <code>getcwd</code>  获取当前工作目录的完整路径</h3>
<p><code>getcwd</code>  是一个 C 语言标准库函数，用于获取当前工作目录的完整路径。这个函数定义在 POSIX 标准中，并且通常在 C 语言的  <code>unistd.h</code>  头文件中声明。</p>
<p>函数原型  <code>char *getcwd(char *buf, size_t size);</code>  包含两个参数：</p>
<ol>
<li><code>buf</code> ：一个指向字符数组的指针，用于存储当前工作目录的路径。如果这个参数是  <code>NULL</code> ，函数会分配一个足够大的缓冲区来存储路径，并且返回指向这个缓冲区的指针。注意，如果  <code>buf</code>  不是  <code>NULL</code> ，调用者需要确保它有足够的空间来存储完整的路径。</li>
<li><code>size</code> ：缓冲区的大小，即  <code>buf</code>  可以存储的字符数，包括最后的空字符（ <code>'\0'</code> ）。</li>
</ol>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回指向  <code>buf</code>  的指针，其中包含了当前工作目录的路径。</li>
<li>如果函数执行失败，返回  <code>NULL</code> ，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p>使用  <code>getcwd</code>  函数时，需要特别注意缓冲区溢出的问题。如果  <code>size</code>  参数指定的大小不足以存储完整的路径，函数将失败，并且  <code>errno</code>  将被设置为  <code>ERANGE</code> 。</p>
<p>下面是一个示例：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 方式 1：直接用栈数组作为 getcwd 返回值数组</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">getcwd</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">,</span><span class="token string">"getcwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"cwd = %s\n"</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 方式 2：动态分配一个堆数组</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// char *path = (char *)malloc(1024);   </span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// char *p = getcwd(path,1024);</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// free(path);  </span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VWdlp4SG94ZVZKS3FCZW82el9YVG5NQjhHTEFDaUEtZGRkdlFLVnlUZDdqR1E_ZT16cFc5R0k.png" alt="" /></p>
<h3 id="chdir-改变当前目录"><a class="anchor" href="#chdir-改变当前目录">#</a>  <code>chdir</code>  改变当前目录</h3>
<p><code>chdir</code>  是一个在 Unix 和类 Unix 系统中广泛使用的系统调用，用于改变当前工作目录。这个函数定义在 POSIX 标准中，并且通常在 C 语言的  <code>unistd.h</code>  头文件中声明。</p>
<p>函数原型  <code>int chdir(const char *path);</code>  包含一个参数： <code>path</code> ：一个指向以 null 结尾的字符串的指针，这个字符串包含了要切换到的目录的路径。</p>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回 0。</li>
<li>如果函数执行失败，返回 -1，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p>使用  <code>chdir</code>  函数可以改变程序的当前工作目录，这会影响后续的文件操作，如打开文件、创建文件等。这些操作默认都是在当前工作目录下进行的。</p>
<p>下面是一个示例：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 命令行参数必须 2 个，第二个是要切换的目标目录</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// 先获取当前工作目录，然后打印</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>ret <span class="token operator">=</span> <span class="token function">getcwd</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"getcwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"一开始的工作目录是: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// 改变当前工作目录</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">int</span> ret2 <span class="token operator">=</span> <span class="token function">chdir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret2<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"chdir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">// 再次打印当前工作目录</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>ret3 <span class="token operator">=</span> <span class="token function">getcwd</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret3<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"getcwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"chdir后的工作目录是: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token function">puts</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VZVWRmd2JldHZKR25qM2VGSGZtWmpNQldmWEtxdFRPU0JXTDdyX1VUZUtXQXc_ZT1kZ0gyaDQ.png" alt="" /></p>
<p>每个进程都有自己的当前工作目录，这是进程解析相对路径的起点。</p>
<p>当父进程创建子进程时，子进程会继承父进程的当前工作目录。这意味着子进程在创建时，其工作目录与父进程相同。</p>
<p><strong>Shell 与子进程</strong>：</p>
<ul>
<li>Shell（如 bash）是一个交互式命令行界面，它允许用户执行命令。当在 Shell 中执行一个可执行程序时，会创建一个新的子进程。</li>
<li>子进程在创建时继承了 Shell 的当前工作目录，但子进程可以独立地改变其工作目录，这不会影响父进程（Shell）的工作目录。</li>
</ul>
<p><strong> <code>chdir</code>  函数与  <code>cd</code>  命令</strong>：</p>
<ul>
<li><code>chdir</code>  函数是一个系统调用，用于改变调用进程的当前工作目录。它与 Shell 中的  <code>cd</code>  命令不同，因为  <code>cd</code>  命令实际上会改变 Shell 进程的当前工作目录，而不仅仅是当前执行的程序。</li>
<li>子进程中使用  <code>chdir</code>  函数修改工作目录的操作是局部的，只影响该子进程，而不影响父进程。</li>
</ul>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VmZFNJNkJ1ZWpGSmh3Nmp5TXoxUkFFQmxabTlvc2pHa3RhM3JmdnZ0WEYzVXc_ZT0wWU40ZHk.png" alt="202403100032762.png" /></p>
<p><strong> <code>cd</code>  指令的原理</strong>：  <code>cd</code>  并不是一个独立的外部程序，而是 Shell（如 bash）的内置命令。这意味着  <code>cd</code>  作为 Shell 的一部分，直接修改当前 Shell 进程的工作目录。</p>
<p><strong>为什么  <code>which cd</code>  找不到可执行程序</strong>： 由于  <code>cd</code>  是 Shell 的内置命令，它不存在于文件系统中作为独立的可执行文件。因此，使用  <code>which</code>  命令查找  <code>cd</code>  会失败，因为  <code>which</code>  仅用于查找外部可执行文件的路径。</p>
<p><strong> <code>cd</code>  指令的作用</strong>： <code>cd</code>  命令允许用户更改当前 Shell 会话的工作目录。这对于导航到不同目录以执行命令或访问文件非常有用。</p>
<h3 id="mkdir-创建目录"><a class="anchor" href="#mkdir-创建目录">#</a>  <code>mkdir</code>  创建目录</h3>
<p><code>mkdir</code>  是一个在 Unix 和类 Unix 系统中广泛使用的系统调用，用于创建一个新的目录。这个函数定义在 POSIX 标准中，并且在 C 语言的  <code>sys/stat.h</code>  头文件中声明。</p>
<p>函数原型  <code>int mkdir(const char *pathname, mode_t mode);</code>  包含两个参数：</p>
<ol>
<li><code>pathname</code> ：一个指向以 null 结尾的字符串的指针，这个字符串包含了要创建的目录的路径。</li>
<li><code>mode</code> ：新目录的权限模式。这个模式是一个位掩码，定义了目录的权限。这个参数与  <code>chmod</code>  函数中使用的模式相同，通常使用宏来表示不同的权限设置，例如  <code>S_IRWXU</code> （所有者读、写、执行权限）、 <code>S_IRWXG</code> （组读、写、执行权限）等。</li>
</ol>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回 0。</li>
<li>如果函数执行失败，返回 -1，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p><code>mode_t</code>  是一个在  <code>&lt;sys/types.h&gt;</code>  中定义的类型，通常是一个无符号整数类型，用于表示文件的模式。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 需要三个命令行参数，允许传入一个三位八进制数表示权限</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">mode_t</span> mode<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">sscanf</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"%o"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 将第三个命令行参数字符串转换成八进制无符号整数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">mkdir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"mkdir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VVUUozU1I1czFKRXFPMFBSSFNRRkpzQkc0OHZUT2RHb1B4alpSWlRYR3hEOXc_ZT1QYnAxYnE.png" alt="" /></p>
<p><strong> <code>umask</code>  的作用</strong>：  <code>umask</code>  是一个系统设置，它定义了新创建的文件和目录的默认权限。 <code>umask</code>  的值通常是一个三位的八进制数，每一位分别对应文件的拥有者、组用户和其他用户的权限。</p>
<p><strong> <code>umask</code>  的影响</strong>：</p>
<ul>
<li>当创建新目录时，如果设置的权限为 777，而  <code>umask</code>  设置为 002，那么最终目录的权限将是 775（即 777 - 002）。</li>
<li>这种计算方式同样适用于文件权限的设置。</li>
</ul>
<p><strong>查看和设置  <code>umask</code> </strong>：</p>
<ul>
<li>使用  <code>umask</code>  命令可以查看当前的文件掩码值。</li>
<li>使用  <code>umask n</code>  命令可以设置一个新的文件掩码值，其中  <code>n</code>  是一个八进制数。</li>
</ul>
<p><strong> <code>umask</code>  的重要性</strong>：</p>
<ul>
<li><code>umask</code>  的存在是为了提高系统的安全性，防止新创建的文件和目录具有过于宽松的权限设置。</li>
<li>较低的  <code>umask</code>  值会导致更开放的权限设置，而较高的  <code>umask</code>  值会导致更严格的权限设置。</li>
</ul>
<h3 id="rmdir-删除空目录"><a class="anchor" href="#rmdir-删除空目录">#</a>  <code>rmdir</code>  删除空目录</h3>
<p><code>rmdir</code>  是一个 POSIX 标准定义的系统调用，用于删除一个空目录。这个函数通常在 C 语言的  <code>unistd.h</code>  头文件中声明。</p>
<p>函数原型  <code>int rmdir(const char *pathname);</code>  包含一个参数：</p>
<ol>
<li><code>pathname</code> ：一个指向以 null 结尾的字符串的指针，这个字符串指定了要删除的目录的路径。</li>
</ol>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回 0。</li>
<li>如果函数执行失败，返回 -1，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p>使用  <code>rmdir</code>  函数时，需要注意以下几点：</p>
<ul>
<li>只有当目录是空的，即不包含任何文件和子目录时， <code>rmdir</code>  才能成功删除该目录。</li>
<li>如果目录不是空的， <code>rmdir</code>  调用将失败，并且  <code>errno</code>  将被设置为  <code>ENOTEMPTY</code> 。</li>
<li>如果指定的路径不存在，或者调用者没有足够的权限删除该目录， <code>rmdir</code>  也会失败。</li>
</ul>
<p>一个示例如下：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">rmdir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 注意：rmdir 只能删除空目录</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"rmdir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="opendir-打开目录流"><a class="anchor" href="#opendir-打开目录流">#</a>  <code>opendir</code>  打开目录流</h3>
<p><code>pendir</code>  是一个 POSIX 标准定义的函数，用于打开一个目录流，以便可以读取其中的内容。这个函数通常在 C 语言的  <code>dirent.h</code>  头文件中声明。</p>
<p>函数原型  <code>DIR *opendir(const char *name);</code>  包含一个参数： <code>name</code> ：一个指向以 null 结尾的字符串的指针，这个字符串指定了要打开的目录的路径。</p>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回一个指向新分配的  <code>DIR</code>  结构的指针，该结构表示目录流。</li>
<li>如果函数执行失败，返回  <code>NULL</code> ，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p>使用  <code>opendir</code>  打开目录流后，可以使用  <code>readdir</code>  函数来读取目录中的条目，使用  <code>rewinddir</code>  函数来重置目录流的位置，以及使用  <code>closedir</code>  函数来关闭目录流并释放相关资源。</p>
<h3 id="closedir-关闭目录流"><a class="anchor" href="#closedir-关闭目录流">#</a>  <code>closedir</code>  关闭目录流</h3>
<p><code>closedir</code>  是一个 POSIX 标准定义的函数，用于关闭之前使用  <code>opendir</code>  函数打开的目录流，并释放与之关联的所有资源。这个函数通常在 C 语言的  <code>dirent.h</code>  头文件中声明。</p>
<p>函数原型  <code>int closedir(DIR *dirp);</code>  包含一个参数  <code>dirp</code> ：一个指向  <code>DIR</code>  结构的指针，该结构是通过  <code>opendir</code>  函数返回的，表示要关闭的目录流。</p>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回 0。</li>
<li>如果函数执行失败，返回 -1，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p>使用  <code>closedir</code>  函数时，通常在完成对目录内容的遍历之后调用，以确保及时释放系统资源。如果  <code>closedir</code>  调用失败，可以通过检查  <code>errno</code>  来确定错误原因，常见的错误可能包括传入的  <code>dirp</code>  指针无效或者内存分配失败等。</p>
<h3 id="readdir-读目录流"><a class="anchor" href="#readdir-读目录流">#</a>  <code>readdir</code>  读目录流</h3>
<p><code>readdir</code>  是一个 POSIX 标准定义的函数，用于从之前使用  <code>opendir</code>  打开的目录流中读取下一个目录项。这个函数通常在 C 语言的  <code>dirent.h</code>  头文件中声明。</p>
<p>函数原型  <code>struct dirent *readdir(DIR *dirp);</code>  包含一个参数： <code>dirp</code> ：一个指向  <code>DIR</code>  结构的指针，该结构是通过  <code>opendir</code>  函数返回的，表示要读取的目录流。</p>
<p>函数的返回值：</p>
<ul>
<li>如果函数成功执行，返回一个指向  <code>struct dirent</code>  的指针，该结构包含了目录中下一个条目的信息。</li>
<li>如果已经到达目录的末尾，返回  <code>NULL</code> 。</li>
<li>如果函数执行失败，也返回  <code>NULL</code> ，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p><code>struct dirent</code>  结构通常包含以下成员：</p>
<ul>
<li><code>d_ino</code> ：一个整数，表示条目的 inode 号（在某些系统上可能不可用）。</li>
<li><code>d_off</code> ：一个长整数，表示目录流中的偏移量，可以用于  <code>seekdir</code>  或  <code>telldir</code>  函数。</li>
<li><code>d_reclen</code> ：一个短整数，表示  <code>struct dirent</code>  结构的长度。</li>
<li><code>d_type</code> : 类型（type）。这是一个指示目录项类型的标志，例如，是否是文件、目录、符号链接等。这个字段不是 POSIX 标准的一部分，但在某些系统（如 GNU/Linux）中可用。</li>
<li><code>d_name</code> ：一个字符数组，包含了条目的名称。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//dirent 是 directory entry 的简写，就是目录项的意思</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">ino_t</span>          d_ino<span class="token punctuation">;</span>           <span class="token comment">// 此目录项的 inode 编号，目录项中会存储文件的 inode 编号。一般是一个 64 位无符号整数（64 位平台）</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">off_t</span>          d_off<span class="token punctuation">;</span>           <span class="token comment">// 到下一个目录项的偏移量。可以视为指向下一个目录项的指针 (近似可以看成链表)，一般是一个 64 位有符号整数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> d_reclen<span class="token punctuation">;</span>        <span class="token comment">// 此目录项的实际大小长度，以字节为单位 (注意不是目录项所表示文件的大小，也不是目录项结构体的大小)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span>  d_type<span class="token punctuation">;</span>          <span class="token comment">// 目录项所表示文件的类型，用不同的整数来表示不同的文件类型</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span>           d_name<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">// 目录项所表示文件的名字，该字段一般决定了目录项的实际大小。也就是说文件名越长，目录项就越大</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>其中文件类型  <code>d_type</code>  的可选值如下 (使用宏常量定义的整数)：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>DT_BLK      <span class="token comment">// 块设备文件，对应整数值 6</span></pre></td></tr><tr><td data-num="2"></td><td><pre>DT_CHR      <span class="token comment">// 字符设备文件，对应整数值 2</span></pre></td></tr><tr><td data-num="3"></td><td><pre>DT_DIR      <span class="token comment">// 目录文件，对应整数值 4</span></pre></td></tr><tr><td data-num="4"></td><td><pre>DT_FIFO     <span class="token comment">// 有名管道文件，对应整数值 1</span></pre></td></tr><tr><td data-num="5"></td><td><pre>DT_LNK      <span class="token comment">// 符号链接文件，对应整数值 10</span></pre></td></tr><tr><td data-num="6"></td><td><pre>DT_REG      <span class="token comment">// 普通文件，对应整数值 8</span></pre></td></tr><tr><td data-num="7"></td><td><pre>DT_SOCK     <span class="token comment">// 套接字文件，对应整数值 12</span></pre></td></tr><tr><td data-num="8"></td><td><pre>DT_UNKNOWN  <span class="token comment">// 未知类型文件，对应整数值 0</span></pre></td></tr></table></figure><h3 id="seekdir-和-telldir"><a class="anchor" href="#seekdir-和-telldir">#</a>  <code>seekdir</code>  和  <code>telldir</code></h3>
<p><code>telldir</code>  和  <code>seekdir</code>  是两个与目录流操作相关的 POSIX 标准函数，它们允许你在目录流中获取当前位置和设置新位置。</p>
<p><code>telldir</code>  函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">long</span> <span class="token function">telldir</span><span class="token punctuation">(</span>DIR <span class="token operator">*</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数： <code>dirp</code> ：指向  <code>DIR</code>  结构的指针，该结构是通过  <code>opendir</code>  函数返回的，表示要查询的目录流。</p>
<p>功能： <code>telldir</code>  函数返回一个值，表示当前目录流的位置。这个位置是一个偏移量，可以用于  <code>seekdir</code>  函数来重新定位目录流。</p>
<p>返回值：</p>
<ul>
<li>返回一个  <code>long</code>  类型的值，表示当前目录流中的偏移量。</li>
<li>如果出现错误，返回  <code>(-1L)</code>  并设置  <code>errno</code>  以指示错误。</li>
</ul>
<p><code>seekdir</code>  函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">seekdir</span><span class="token punctuation">(</span>DIR <span class="token operator">*</span>dirp<span class="token punctuation">,</span> <span class="token keyword">long</span> loc<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数：</p>
<ul>
<li><code>dirp</code> ：指向  <code>DIR</code>  结构的指针，该结构是通过  <code>opendir</code>  函数返回的，表示要设置位置的目录流。</li>
<li><code>loc</code> ：要设置的目录流中的偏移量。</li>
</ul>
<p>功能： <code>seekdir</code>  函数将目录流的位置设置为由  <code>loc</code>  指定的偏移量。这个偏移量应该由先前的  <code>telldir</code>  调用返回。</p>
<p>返回值：</p>
<ul>
<li>此函数不返回任何值（ <code>void</code>  类型）。</li>
<li>如果出现错误，会设置  <code>errno</code>  以指示错误。</li>
</ul>
<p>这两个函数通常一起使用，以实现目录流的定位和重定位。例如，可以先使用  <code>telldir</code>  保存当前位置，然后使用  <code>seekdir</code>  跳转到目录中的特定位置，最后再次使用  <code>telldir</code>  来获取新位置。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    DIR <span class="token operator">*</span>dirp <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"opendir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token operator">*</span>dp<span class="token punctuation">;</span>  <span class="token comment">// 指向目录项结构体的指针</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 需求：记录 dir2 目录项，然后在 while 循环的下面重新打印这个目录项</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">long</span> location<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dp <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">// 每一次循环就处理一个目录项</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string">"inode num = %lu"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token string">"offset = %ld"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token string">"reclen = %hu"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token string">"type = %u"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token string">"file name = %s\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            dp<span class="token operator">-></span>d_ino<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_off<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_reclen<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_type<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token string">".."</span><span class="token punctuation">,</span> dp<span class="token operator">-></span>d_name<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token comment">// 记录 dir2 目录项的位置</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            location <span class="token operator">=</span> <span class="token function">telldir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span>  <span class="token comment">// 当 while 循环结束时，dp 就是空指针</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"----------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token function">seekdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    dp <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token string">"inode num = %lu"</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token string">"offset = %ld"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token string">"reclen = %hu"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token string">"type = %u"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token string">"file name = %s\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        dp<span class="token operator">-></span>d_ino<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_off<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_reclen<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_type<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">// 不要忘记关闭流</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">closedir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"closedir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="rewinddir-目录流重置"><a class="anchor" href="#rewinddir-目录流重置">#</a>  <code>rewinddir</code>  目录流重置</h3>
<p><code>rewinddir</code>  是一个 POSIX 标准定义的函数，用于将目录流的位置重置到开始的位置，即目录的第一个条目。这个函数通常在 C 语言的  <code>dirent.h</code>  头文件中声明。</p>
<p>函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">rewinddir</span><span class="token punctuation">(</span>DIR <span class="token operator">*</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数： <code>dirp</code> ：指向  <code>DIR</code>  结构的指针，该结构是通过  <code>opendir</code>  函数返回的，表示要重置的目录流。</p>
<p>功能： <code>rewinddir</code>  函数将目录流中的当前位置重置到目录的第一个条目。这允许程序重新遍历目录中的所有条目。</p>
<p>返回值：</p>
<ul>
<li>此函数不返回任何值（ <code>void</code>  类型）。</li>
<li>如果出现错误，会设置  <code>errno</code>  以指示错误。</li>
</ul>
<p>使用  <code>rewinddir</code>  可以方便地重新访问目录中的条目，而不需要关闭并重新打开目录流。这在需要多次遍历同一目录的情况下非常有用。</p>
<h3 id="stat-获取元数据"><a class="anchor" href="#stat-获取元数据">#</a>  <code>stat</code>  获取元数据</h3>
<p><code>stat</code>  函数是一个广泛使用的 POSIX 标准函数，用于获取文件或目录的元数据（如大小、权限、时间戳等）。这个函数在 C 语言的  <code>sys/stat.h</code>  头文件中声明。</p>
<p>函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">stat</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数：</p>
<ol>
<li><code>path</code> ：一个指向以 null 结尾的字符串的指针，指定了要获取信息的文件或目录的路径。</li>
<li><code>buf</code> ：一个指向  <code>struct stat</code>  结构的指针，该结构用于接收关于  <code>path</code>  指定的文件或目录的信息。</li>
</ol>
<p><code>struct stat</code>  结构包含了以下一些常见的成员（具体成员可能因系统而异）：</p>
<ul>
<li><code>st_dev</code> ：设备编号</li>
<li><code>st_ino</code> ：inode 号（文件系统的唯一标识符）</li>
<li><code>st_mode</code> ：文件类型和权限</li>
<li><code>st_nlink</code> ：硬链接数量</li>
<li><code>st_uid</code>  和  <code>st_gid</code> ：文件所有者的用户 ID 和组 ID</li>
<li><code>st_size</code> ：文件大小（字节）</li>
<li><code>st_atime</code> ,  <code>st_mtime</code> ,  <code>st_ctime</code> ：分别是文件的最后访问时间、最后修改时间和元数据最后改变时间的时间戳</li>
</ul>
<p>功能：</p>
<ul>
<li><code>stat</code>  函数尝试获取  <code>path</code>  指定的文件或目录的元数据，并将结果存储在  <code>buf</code>  指向的  <code>struct stat</code>  结构中。</li>
</ul>
<p>返回值：</p>
<ul>
<li>如果函数成功执行，返回 0。</li>
<li>如果函数执行失败，返回 -1，并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p><strong>目录流获取的文件名</strong>：在使用目录流读取目录项时，我们可以获得每个文件的文件名。但这并不一定是文件的完整路径名。</p>
<ol>
<li>
<p>当当前工作目录与要打印目录信息的目录相同（例如，都是  <code>/dir</code> ），此时从目录流获取的文件名可以直接作为  <code>stat</code>  函数的参数，因为它们是相对于当前工作目录的相对路径名。</p>
<p>例如，如果  <code>/dir</code>  目录下有三个文件： <code>file1</code> 、 <code>file2</code> 、 <code>file3</code> ，那么它们的相对路径名分别是  <code>file1</code> 、 <code>file2</code> 、 <code>file3</code> 。在这种情况下，文件名可以直接作为  <code>stat</code>  函数的参数，因为它们已经是相对于当前工作目录的路径。</p>
</li>
<li>
<p>如果当前工作目录与要打印目录信息的目录不同（例如，当前工作目录是  <code>/dir</code> ，但要打印的是另一个目录  <code>/subdir</code>  的信息），则从目录流获取的文件名不是完整的路径名。</p>
<ul>
<li>例如，如果  <code>/subdir</code>  目录下有三个文件： <code>file1</code> 、 <code>file2</code> 、 <code>file3</code> ，而当前工作目录是  <code>/dir</code> ，则这些文件的绝对路径应该是  <code>/subdir/file1</code> 、 <code>/subdir/file2</code> 、 <code>/subdir/file3</code> 。如果使用  <code>/dir</code>  作为工作目录，直接使用文件名作为  <code>stat</code>  函数的参数将无法正确找到这些文件。</li>
</ul>
</li>
</ol>
<p>从目录流获取的文件名是否可以直接作为  <code>stat</code>  函数的参数，取决于当前工作目录是否与要查询的目录相同。如果不同，需要将文件名与目录路径拼接成完整的路径名。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    DIR <span class="token operator">*</span>dirp <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"opendir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 解决方法 1：切换工作目录为要打印信息的目录</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// int ret = chdir(argv[1]);</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// ERROR_CHECK(ret, -1, "chdir");</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token operator">*</span>dp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dp <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">struct</span> <span class="token class-name">stat</span> stat_buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">// 循环处理目录项，把文件名直接作为路径名传参给 stat 函数</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// 这里需要配合解决办法 1</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">// int ret = stat(path, &amp;stat_buf);</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment">// ERROR_CHECK(ret, -1, "stat");</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">// 解决办法 2：拼接文件的绝对路径然后再传参给 stat 函数</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">char</span> path<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">// strcpy(path, argv[1]);</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token comment">// strcat(path, "/");</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">// strcat(path, dp->d_name);</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token function">sprintf</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"%s%s%s"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">,</span> dp<span class="token operator">-></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token operator">&amp;</span>stat_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"stat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment">// 获取 stat 结构体后打印文件的详细信息</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%o %lu %u %u %lu %ld %s\n"</span><span class="token punctuation">,</span> stat_buf<span class="token punctuation">.</span>st_mode<span class="token punctuation">,</span> stat_buf<span class="token punctuation">.</span>st_nlink<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>               stat_buf<span class="token punctuation">.</span>st_uid<span class="token punctuation">,</span> stat_buf<span class="token punctuation">.</span>st_gid<span class="token punctuation">,</span> stat_buf<span class="token punctuation">.</span>st_size<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>               <span class="token comment">// stat_buf.st_mtim.tv_sec,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>               stat_buf<span class="token punctuation">.</span>st_mtime<span class="token punctuation">,</span> dp<span class="token operator">-></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token function">closedir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>关于  <code>struct stat</code>  结构体：</p>
<p><code>struct stat</code>  是一个在 POSIX 兼容的操作系统中定义的数据结构，用于存储文件或目录的元数据。当你调用像  <code>stat</code>  或  <code>lstat</code>  这样的函数时，它们会将关于文件的信息填充到一个  <code>struct stat</code>  结构体实例中。这个结构体定义在  <code>sys/stat.h</code>  头文件中。</p>
<p><code>struct stat</code>  结构体通常包含以下成员（成员可能根据不同的系统和编译环境有所不同）：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">stat</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">mode_t</span>    st_mode<span class="token punctuation">;</span>          <span class="token comment">// 包含文件的类型以及权限信息</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">nlink_t</span>   st_nlink<span class="token punctuation">;</span>     	<span class="token comment">// 文件的硬链接数量 </span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">uid_t</span>     st_uid<span class="token punctuation">;</span>           <span class="token comment">// 文件所有者的用户 ID</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">gid_t</span>     st_gid<span class="token punctuation">;</span>           <span class="token comment">// 文件所有者组的组 ID</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token class-name">off_t</span>     st_size<span class="token punctuation">;</span>          <span class="token comment">// 文件的实际大小，以字节为单位</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">timespec</span> st_mtim<span class="token punctuation">;</span>  <span class="token comment">/* 包含文件最后修改时间的结构体对象 */</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这些字段的类型都是使用别名来定义的，在 64 位 Linux 操作系统上，这些别名的类型一般是：</p>
<ol>
<li><code>mode_t</code> ：一般是一个 32 位无符号整数。</li>
<li><code>nlink_t</code> ：一般是一个 64 位无符号整数。</li>
<li><code>uid_t</code>  和  <code>uid_t</code> ：一般是一个 32 位无符号整数。</li>
<li><code>off_t</code> ：一般是一个 64 位无符号整数。</li>
</ol>
<p>其中的  <code>timespec</code>  结构体定义如下：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">timespec</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token class-name">time_t</span> tv_sec<span class="token punctuation">;</span>  <span class="token comment">// 秒，表示时间戳中的秒部分</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">long</span> tv_nsec<span class="token punctuation">;</span>   <span class="token comment">// 纳秒，表示时间戳中的微秒部分，用于更精确地表示时间</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ul>
<li><code>tv_sec</code> ：表示时间戳的秒部分，通常与历元（Epoch）的时间差有关。</li>
<li><code>tv_nsec</code> ：表示时间戳的纳秒部分，即一秒内的微秒数，可以提供额外的时间精度。</li>
</ul>
<p>由于宏  <code>#define st_mtime spec.tv_sec</code>  的存在，可以直接使用  <code>statbuf.st_mtime</code>  来访问  <code>statbuf.st_mtim.tv_sec</code>  的值。</p>
<p><code>statbuf.st_mtim.tv_sec</code>  和  <code>statbuf.st_mtime</code>  是等价的，都表示文件的最后修改时间的秒部分。</p>
<p>注意：</p>
<ol>
<li>一个是  <code>st_mtim</code> ，这是一个结构体类型，它是  <code>stat</code>  结构体的成员。</li>
<li>一个是宏定义  <code>st_time</code> ，它是一个  <code>long int</code>  类型的表示文件最后修改时间的时间戳秒数。</li>
</ol>
<h3 id="getpwuid-获取用户信息"><a class="anchor" href="#getpwuid-获取用户信息">#</a>  <code>getpwuid</code>  获取用户信息</h3>
<p><code>getpwuid</code>  是一个在 POSIX 标准中定义的函数，用于根据用户 ID（ <code>uid</code> ）获取用户的信息。这个函数通常在 C 语言的  <code>pwd.h</code>  头文件中声明。</p>
<p>函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">passwd</span> <span class="token operator">*</span><span class="token function">getpwuid</span><span class="token punctuation">(</span><span class="token class-name">uid_t</span> uid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数：</p>
<ul>
<li><code>uid</code> ：用户 ID，是一个无符号整数，表示要获取信息的用户的唯一标识符。</li>
</ul>
<p>功能：</p>
<ul>
<li><code>getpwuid</code>  函数在系统用户数据库中查找与给定  <code>uid</code>  相对应的用户记录，并返回一个指向  <code>struct passwd</code>  结构的指针，该结构包含了用户的信息。</li>
</ul>
<p>返回值：</p>
<ul>
<li>如果找到对应的用户记录，函数返回一个指向  <code>struct passwd</code>  结构的指针。</li>
<li>如果没有找到对应的用户记录或发生错误，函数返回  <code>NULL</code>  并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p><code>struct passwd</code>  结构通常包含以下成员：</p>
<ul>
<li><code>pw_name</code> ：一个指针，指向一个字符串，表示用户的登录名。</li>
<li><code>pw_passwd</code> ：一个指针，指向一个字符串，表示用户的密码。出于安全考虑，通常密码以加密形式存储。</li>
<li><code>pw_uid</code> ：用户的用户 ID。</li>
<li><code>pw_gid</code> ：用户的组 ID。</li>
<li><code>pw_gecos</code> ：一个指针，指向描述用户信息的字符串，如全名、工作电话、家庭电话等。</li>
<li><code>pw_dir</code> ：一个指针，指向用户主目录的路径。</li>
<li><code>pw_shell</code> ：一个指针，指向用户默认登录 shell 的路径。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">passwd</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>pw_name<span class="token punctuation">;</span>   <span class="token comment">// 用户名</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>pw_passwd<span class="token punctuation">;</span> <span class="token comment">// 密码（通常是加密后的密码，但在现代系统中通常是 'x' 或 '*'，真正的密码存储在安全文件中）</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">uid_t</span> pw_uid<span class="token punctuation">;</span>    <span class="token comment">// 用户 ID</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">gid_t</span> pw_gid<span class="token punctuation">;</span>    <span class="token comment">// 组 ID</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>pw_gecos<span class="token punctuation">;</span>  <span class="token comment">// GECOS 字段，包含其他用户信息</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>pw_dir<span class="token punctuation">;</span>    <span class="token comment">// 用户主目录</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>pw_shell<span class="token punctuation">;</span>  <span class="token comment">// 用户登录 shell</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="getgrgid-获取组信息"><a class="anchor" href="#getgrgid-获取组信息">#</a>  <code>getgrgid</code>  获取组信息</h3>
<p><code>getgrgid</code>  是一个在 POSIX 标准中定义的函数，用于根据组 ID（ <code>gid</code> ）获取组的信息。这个函数通常在 C 语言的  <code>grp.h</code>  头文件中声明。</p>
<p>函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">group</span> <span class="token operator">*</span><span class="token function">getgrgid</span><span class="token punctuation">(</span><span class="token class-name">gid_t</span> gid<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数： <code>gid</code> ：组 ID，是一个无符号整数，表示要获取信息的组的唯一标识符。</p>
<p>功能： <code>getgrgid</code>  函数在系统组数据库中查找与给定  <code>gid</code>  相对应的组记录，并返回一个指向  <code>struct group</code>  结构的指针，该结构包含了组的信息。</p>
<p>返回值：</p>
<ul>
<li>如果找到对应的组记录，函数返回一个指向  <code>struct group</code>  结构的指针。</li>
<li>如果没有找到对应的组记录或发生错误，函数返回  <code>NULL</code>  并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p><code>struct group</code>  结构通常包含以下成员：</p>
<ul>
<li><code>gr_name</code> ：一个指针，指向一个字符串，表示组的名称。</li>
<li><code>gr_passwd</code> ：一个指针，指向一个字符串，表示组的密码。通常这个字段不使用或包含一个占位符。</li>
<li><code>gr_gid</code> ：组的组 ID。</li>
<li><code>gr_mem</code> ：一个指向字符串数组的指针，数组中包含了属于该组的所有用户的登录名列表。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">group</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>gr_name<span class="token punctuation">;</span>   <span class="token comment">// 组名</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>gr_passwd<span class="token punctuation">;</span> <span class="token comment">// 组密码（在现代系统中通常是 'x' 或 '*'，真正的密码存储在安全文件中）</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">gid_t</span> gr_gid<span class="token punctuation">;</span>    <span class="token comment">// 组 ID</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>gr_mem<span class="token punctuation">;</span>   <span class="token comment">// 包含组成员用户名的字符串数组</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="localtime-时间函数"><a class="anchor" href="#localtime-时间函数">#</a>  <code>localtime</code>  时间函数</h3>
<p><code>localtime</code>  是 C 标准库中的一个函数，用于将自纪元（Epoch，即 1970 年 1 月 1 日 00:00:00 UTC）以来的秒数（ <code>time_t</code>  类型）转换为一个更易读的结构化时间表示，即  <code>struct tm</code>  类型。这个函数定义在  <code>time.h</code>  头文件中。</p>
<p>函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">tm</span> <span class="token operator">*</span><span class="token function">localtime</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">time_t</span> <span class="token operator">*</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数： <code>timer</code> ：一个指向  <code>time_t</code>  类型的指针，包含了要转换的时间值，表示自纪元以来的秒数。</p>
<p>功能： <code>localtime</code>  函数将  <code>timer</code>  指向的时间戳转换为当地时间（考虑了时区和夏令时设置）的  <code>struct tm</code>  格式。</p>
<p>返回值：</p>
<ul>
<li>函数返回一个指向  <code>struct tm</code>  结构的指针，该结构包含了转换后的时间信息。</li>
<li>如果转换失败，返回  <code>NULL</code>  并设置全局变量  <code>errno</code>  以指示错误类型。</li>
</ul>
<p><code>struct tm</code>  结构通常包含以下成员：</p>
<ul>
<li><code>tm_sec</code> ：秒（0-59）</li>
<li><code>tm_min</code> ：分钟（0-59）</li>
<li><code>tm_hour</code> ：小时（0-23）</li>
<li><code>tm_mday</code> ：一个月中的第几天（1-31）</li>
<li><code>tm_mon</code> ：年份中第几个月，从 0（1 月）开始计数</li>
<li><code>tm_year</code> ：自 1900 年以来的年数（例如，2023 表示为 123）</li>
<li><code>tm_wday</code> ：一周中的第几天，从 0（通常表示星期日）开始计数</li>
<li><code>tm_yday</code> ：一年中的第几天，从 0（1 月 1 日）开始计数</li>
<li><code>tm_isdst</code> ：夏令时标志，非零表示夏令时，零表示标准时间</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">tm</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">int</span> tm_sec<span class="token punctuation">;</span>    <span class="token comment">/* 秒 – 取值区间为 [0,59] */</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">int</span> tm_min<span class="token punctuation">;</span>    <span class="token comment">/* 分 - 取值区间为 [0,59] */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">int</span> tm_hour<span class="token punctuation">;</span>   <span class="token comment">/* 时 - 取值区间为 [0,23] */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> tm_mday<span class="token punctuation">;</span>   <span class="token comment">/* 一个月中的日期 - 取值区间为 [1,31] */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> tm_mon<span class="token punctuation">;</span>    <span class="token comment">/* 月份（从一月开始，0 代表一月）- 取值区间为 [0,11] */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">int</span> tm_year<span class="token punctuation">;</span>   <span class="token comment">/* 年份，其值从 1900 开始 */</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">int</span> tm_wday<span class="token punctuation">;</span>   <span class="token comment">/* 星期 – 取值区间为 [0,6]，星期日为 0 */</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> tm_yday<span class="token punctuation">;</span>   <span class="token comment">/* 从每年的 1 月 1 日开始的天数 – 取值区间为 [0,365]，1 月 1 日为 0 */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">int</span> tm_isdst<span class="token punctuation">;</span>  <span class="token comment">/* 夏令时标识符，夏令时时为正，不是夏令时时为 0，不了解情况时为负 */</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="目录流和文件流"><a class="anchor" href="#目录流和文件流">#</a> 目录流和文件流</h2>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VkczNhbVlFR3VKRnRHSE9sLWs5YV9JQl9VSDhmREM0eUpFMVFLUFdxWTdQMlE_ZT11V0RYa2k.png" alt="202403101159558.png" /></p>
<p>目录流（ <code>DIR *</code> ）和文件流（如  <code>FILE *</code> ）是文件 I/O 操作中的两种不同类型，它们在操作流程和使用方式上有一些相似之处，但也有明显的区别。</p>
<p>相似点：</p>
<ol>
<li><strong>操作流程</strong>：无论是文件流还是目录流，操作流程都是相同的，即先打开流，然后进行操作，最后关闭流。</li>
<li><strong>操作位置指示</strong>：打开目录文件后，会得到一个目录流指针  <code>DIR *</code> ，类似于文件流的  <code>FILE *</code>  指针，它指示了操作的位置。</li>
<li><strong>库函数封装</strong>：文件流和目录流都是库函数，它们封装了系统调用，提供了相似的使用方式。</li>
</ol>
<p>不同点：</p>
<ol>
<li><strong>写操作</strong>：最明显的不同是目录流不允许写操作，只能进行读操作。系统内核没有提供写目录流的功能。</li>
<li><strong>库函数标准</strong>：文件流通常遵循 ISO C 标准库函数，而目录流则遵循 POSIX 标准库函数。</li>
</ol>
<table>
<thead>
<tr>
<th>文件流</th>
<th>目录流</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fopen</code></td>
<td><code>opendir</code></td>
</tr>
<tr>
<td><code>fclose</code></td>
<td><code>closedir</code></td>
</tr>
<tr>
<td><code>fread</code></td>
<td><code>readdir</code></td>
</tr>
<tr>
<td><code>fwrite</code></td>
<td>×</td>
</tr>
<tr>
<td><code>ftell</code></td>
<td><code>telldir</code></td>
</tr>
<tr>
<td><code>fseek</code></td>
<td><code>seekdir</code></td>
</tr>
<tr>
<td><code>rewind</code></td>
<td><code>rewinddir</code></td>
</tr>
</tbody>
</table>
<h2 id="实现-ll-指令"><a class="anchor" href="#实现-ll-指令">#</a> 实现 ll 指令</h2>
<h3 id="简易版"><a class="anchor" href="#简易版">#</a> 简易版</h3>
<p>使用  <code>opendir</code>  ， <code>closedir</code>  和  <code>readdir</code>  实现一个简易版指令</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdc.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    DIR <span class="token operator">*</span>dirp <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 打开目录流需要进行错误处理</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"opendir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token operator">*</span>pdirent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 循环读目录项并打印目录信息，循环结束的条件是返回值为 NULL</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pdirent <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token string">"inode num = %lu, reclen = %hu, type = %u, name = %s\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            pdirent<span class="token operator">-></span>d_ino<span class="token punctuation">,</span>  <span class="token comment">// 64 位平台这个 inode 编号一般是一个 64 位无符号整数</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            pdirent<span class="token operator">-></span>d_reclen<span class="token punctuation">,</span>  <span class="token comment">// 无符号短整型</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            pdirent<span class="token operator">-></span>d_type<span class="token punctuation">,</span>    <span class="token comment">// 无符号整型</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            pdirent<span class="token operator">-></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 以字符串类型打印</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">// 及时释放资源，关闭目录流</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">closedir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出结果如下：</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0ViTTA2LUJ2bjhaTHE5VFpjNzR6QWNrQmlwMHkyQTlxRHBQRFR5a2xtbkk1Wnc_ZT1XczR4U2g.png" alt="" /></p>
<h3 id="优化"><a class="anchor" href="#优化">#</a> 优化</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdc.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token function">ARGS_CHECK</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  DIR <span class="token operator">*</span>dirp <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"opendir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 切换工作目录为参数传入的目录</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">chdir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"chdir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">//dirent 结构体指针，用于存放目录项信息</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token operator">*</span>pdirent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment">// 读取目录中的每个目录项</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pdirent <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// 拼接文件路径，如果上面没有 chdir 切换目录，这里就需要做绝对路径的拼接操作</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// char path[1024] = &#123;0&#125;;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">// sprintf(path, "%s%s%s", argv[1], "/", pdirent->d_name);</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 或者也可以用 strcpy 以及 strcat 函数进行复制拼接获取最终目录</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">// strcpy(path, argv[1]);</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// strcat(path, "/");</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment">// strcat(path, pdirent->d_name);</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 获取文件相关的信息</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">stat</span> statbuf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        pdirent<span class="token operator">-></span>d_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token operator">&amp;</span>statbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 由于切换了工作目录，所以文件名就是路径名。如果没有切换，那么这里需要传参 path</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"stat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token comment">// 输出文件相关的信息</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token string">"%o %lu %u %u %lu %lu %s\n"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        statbuf<span class="token punctuation">.</span>st_mode<span class="token punctuation">,</span>  <span class="token comment">// 以八进制无符号输出，可以看到权限的数字表示法</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        statbuf<span class="token punctuation">.</span>st_nlink<span class="token punctuation">,</span>  <span class="token comment">// 无符号长整型输出</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        statbuf<span class="token punctuation">.</span>st_uid<span class="token punctuation">,</span>    <span class="token comment">// 无符号 int 输出</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        statbuf<span class="token punctuation">.</span>st_gid<span class="token punctuation">,</span>    <span class="token comment">// 无符号 int 输出</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        statbuf<span class="token punctuation">.</span>st_size<span class="token punctuation">,</span>   <span class="token comment">// 无符号长整型输出</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        statbuf<span class="token punctuation">.</span>st_mtim</pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token punctuation">.</span>tv_sec<span class="token punctuation">,</span>  <span class="token comment">// 时间戳打印秒数，以无符号长整型打印。这里还可以写 statbuf.st_mtime</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        pdirent<span class="token operator">-></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 字符串打印</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token comment">// 关闭目录流</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token function">closedir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VVdDJlWVhLZmZKRGcxejFoUXpJSHpZQmJLMFotdW9URVdNZmZYMk45MlF6TWc_ZT1aODhXY3g.png" alt="" /></p>
<h3 id="再优化"><a class="anchor" href="#再优化">#</a> 再优化</h3>
<p><strong>获取文件权限信息</strong>：  <code>st_mode</code>  成员的最后 9 位二进制数表示文件的权限。以下是如何根据  <code>st_mode</code>  判断文件权限的方法：</p>
<ul>
<li>文件权限  <code>777</code>  的二进制表示为  <code>111 111 111</code> 。</li>
<li>文件权限  <code>775</code>  的二进制表示为  <code>111 110 101</code> 。</li>
<li>文件权限  <code>664</code>  的二进制表示为  <code>110 110 100</code> 。</li>
</ul>
<p><strong>判断权限</strong>： 通过将  <code>st_mode</code>  与特定的位掩码进行按位与操作，可以判断文件的权限：</p>
<ul>
<li>与  <code>0400</code> （可读）进行按位与操作，结果非 0 表示拥有者具有读权限。</li>
<li>与  <code>0200</code> （可写）进行按位与操作，结果非 0 表示拥有者具有写权限。</li>
<li>与  <code>0100</code> （可执行）进行按位与操作，结果非 0 表示拥有者具有执行权限。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 设置文件类型和权限字符串</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">set_type_mode</span><span class="token punctuation">(</span><span class="token class-name">mode_t</span> mode<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>tm_str<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 处理第一个字符，即文件类型 </span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> S_IFMT<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">case</span> S_IFBLK<span class="token operator">:</span>   tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'b'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">case</span> S_IFCHR<span class="token operator">:</span>   tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'c'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">case</span> S_IFDIR<span class="token operator">:</span>   tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'d'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">case</span> S_IFIFO<span class="token operator">:</span>   tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'p'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">case</span> S_IFLNK<span class="token operator">:</span>   tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'l'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">case</span> S_IFREG<span class="token operator">:</span>   tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'-'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">case</span> S_IFSOCK<span class="token operator">:</span>  tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'s'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">default</span><span class="token operator">:</span>        tm_str<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'?'</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 处理后续九个字符，即文件的权限信息</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// 设置拥有者的权限信息</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0400</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'r'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0200</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'w'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0100</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'x'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">// 设置拥有者组的权限                          </span></pre></td></tr><tr><td data-num="21"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0040</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'r'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0020</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'w'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0010</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'x'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 设置其他人的权限</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0004</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'r'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0002</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'w'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0001</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token char">'x'</span> <span class="token operator">:</span> <span class="token char">'-'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    tm_str<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> <span class="token comment">// 确保字符串以 null 结尾</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">// 获取格式化的时间字符串</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">void</span> <span class="token function">set_time</span><span class="token punctuation">(</span><span class="token class-name">time_t</span> mtime<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>time_str<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">// 由于 tm 结构体中存储的是月份的整数值，我们需要的是月份字符串，所以用一个字符串数组来存储月份字符串</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">const</span> <span class="token keyword">char</span> month_arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token string">"1月"</span><span class="token punctuation">,</span> <span class="token string">"2月"</span><span class="token punctuation">,</span> <span class="token string">"3月"</span><span class="token punctuation">,</span> <span class="token string">"4月"</span><span class="token punctuation">,</span> <span class="token string">"5月"</span><span class="token punctuation">,</span> <span class="token string">"6月"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token string">"7月"</span><span class="token punctuation">,</span> <span class="token string">"8月"</span><span class="token punctuation">,</span> <span class="token string">"9月"</span><span class="token punctuation">,</span> <span class="token string">"10月"</span><span class="token punctuation">,</span> <span class="token string">"11月"</span><span class="token punctuation">,</span> <span class="token string">"12月"</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">//tm 结构体当中的月份范围是 [0, 11]，刚好可以适配这个数组</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token comment">// 调用 localtime 函数，获取 tm 结构体指针</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">tm</span><span class="token operator">*</span> st_tm <span class="token operator">=</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mtime<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token comment">// 构建时间字符串，格式为：月份 天数 时：分</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>time_str<span class="token punctuation">,</span> <span class="token string">"%s %2d %02d:%02d"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>            month_arr<span class="token punctuation">[</span>st_tm<span class="token operator">-></span>tm_mon<span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>            st_tm<span class="token operator">-></span>tm_mday<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>            st_tm<span class="token operator">-></span>tm_hour<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>            st_tm<span class="token operator">-></span>tm_min<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token comment">/* Usage: ./07_myls pathname 或 ./07_myls */</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> dir_name<span class="token punctuation">;</span> <span class="token comment">// 存储目录名的指针</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        dir_name <span class="token operator">=</span> <span class="token string">"."</span><span class="token punctuation">;</span>  <span class="token comment">// 如果命令行参数没有提供要打印的目录，就打印当前工作目录</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>        dir_name <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 否则使用提供的命令行参数作为待打印的目标</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"args num error!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>    DIR<span class="token operator">*</span> dirp <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打开指定的目录</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>dirp<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"opendir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token comment">// 改变工作目录到指定目录</span></pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">chdir</span><span class="token punctuation">(</span>dir_name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"chdir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">dirent</span><span class="token operator">*</span> pdirent<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>    <span class="token comment">// 遍历目录项</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pdirent <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token keyword">struct</span> <span class="token class-name">stat</span> stat_buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>        <span class="token comment">// 获取目录项的详细信息</span></pre></td></tr><tr><td data-num="74"></td><td><pre>        <span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">stat</span><span class="token punctuation">(</span>pdirent<span class="token operator">-></span>d_name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>stat_buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>        <span class="token function">ERROR_CHECK</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"stat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>        <span class="token keyword">char</span> mode_str<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 保存文件类型和权限信息</span></pre></td></tr><tr><td data-num="78"></td><td><pre>        <span class="token function">set_type_mode</span><span class="token punctuation">(</span>stat_buf<span class="token punctuation">.</span>st_mode<span class="token punctuation">,</span> mode_str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置类型和权限</span></pre></td></tr><tr><td data-num="79"></td><td><pre></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token keyword">char</span> time_str<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 保存格式化后的时间信息</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token comment">/*</pre></td></tr><tr><td data-num="82"></td><td><pre>            localtime 需要传入时间戳描述</pre></td></tr><tr><td data-num="83"></td><td><pre>            所以这里传参时可以写 stat_buf.st_mtime（宏定义，更简写）</pre></td></tr><tr><td data-num="84"></td><td><pre>            也可以写 stat_buf.st_mtim.tv_sec（宏定义的原版代码）</pre></td></tr><tr><td data-num="85"></td><td><pre>            但不能直接写 stat_buf.st_mtim</pre></td></tr><tr><td data-num="86"></td><td><pre>            原因上面已经讲过了！</pre></td></tr><tr><td data-num="87"></td><td><pre>        */</span></pre></td></tr><tr><td data-num="88"></td><td><pre>        <span class="token function">set_time</span><span class="token punctuation">(</span>stat_buf<span class="token punctuation">.</span>st_mtime<span class="token punctuation">,</span> time_str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取时间字符串</span></pre></td></tr><tr><td data-num="89"></td><td><pre></pre></td></tr><tr><td data-num="90"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s %2lu %s %s %6lu %s %s\n"</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="91"></td><td><pre>               mode_str<span class="token punctuation">,</span>                            <span class="token comment">// 文件类型与权限</span></pre></td></tr><tr><td data-num="92"></td><td><pre>               stat_buf<span class="token punctuation">.</span>st_nlink<span class="token punctuation">,</span>                   <span class="token comment">// 硬链接数，不足 2 个字符的在前面补空格</span></pre></td></tr><tr><td data-num="93"></td><td><pre>               <span class="token function">getpwuid</span><span class="token punctuation">(</span>stat_buf<span class="token punctuation">.</span>st_uid<span class="token punctuation">)</span><span class="token operator">-></span>pw_name<span class="token punctuation">,</span>  <span class="token comment">// 拥有者名</span></pre></td></tr><tr><td data-num="94"></td><td><pre>               <span class="token function">getgrgid</span><span class="token punctuation">(</span>stat_buf<span class="token punctuation">.</span>st_gid<span class="token punctuation">)</span><span class="token operator">-></span>gr_name<span class="token punctuation">,</span>  <span class="token comment">// 拥有者组名</span></pre></td></tr><tr><td data-num="95"></td><td><pre>               stat_buf<span class="token punctuation">.</span>st_size<span class="token punctuation">,</span>                    <span class="token comment">// 文件大小，使用 %4lu 表示最少输出 4 个字符，若不足 4 个字符则在前面补空格</span></pre></td></tr><tr><td data-num="96"></td><td><pre>               time_str<span class="token punctuation">,</span>                            <span class="token comment">// 最后修改时间字符串</span></pre></td></tr><tr><td data-num="97"></td><td><pre>               pdirent<span class="token operator">-></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// 文件名</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="99"></td><td><pre></pre></td></tr><tr><td data-num="100"></td><td><pre>    <span class="token comment">// 关闭目录</span></pre></td></tr><tr><td data-num="101"></td><td><pre>    <span class="token function">closedir</span><span class="token punctuation">(</span>dirp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VZaGlWRHVVZ1U1RXZld1ZfUkxhZU1JQktTaXVLb1BtUGI2eTVBUG1sSlBsclE_ZT1VVUxRbWc.png" alt="202403140057673.png" /></p>
<div class="tags"><a href="/tags/c/" rel="tag"><i class="ic i-tag"></i>C</a><a href="/tags/linux/" rel="tag"><i class="ic i-tag"></i>Linux</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于 </span><time title="修改时间：2024-12-13 15:53:25" itemprop="dateModified" datetime="2024-12-13T15:53:25+08:00">2024-12-13</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>樱小路七叶<i class="ic i-at"><em>@</em></i>Nana7ha's Café Stella</li><li class="link"><strong>本文链接：</strong><a href="http://cwlrin.wiki/c-cpp/linux-c/Linux%20%E7%9B%AE%E5%BD%95%E6%B5%81/" title="Linux 目录流">http://cwlrin.wiki/c-cpp/linux-c/Linux 目录流/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/c-cpp/linux-c/Linux%20%E6%9D%82%E9%A1%B9/" rel="prev" itemprop="url" title="Linux 杂项" style="background-image: linear-gradient(to bottom right, #e8a2eb, #da8eac);"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>Linux C</span><h3>Linux 杂项</h3></a></div><div class="item right"><a href="/c-cpp/linux-c/Linux%20%E6%96%87%E4%BB%B6%E6%B5%81/" rel="next" itemprop="url" title="Linux 文件流" style="background-image: linear-gradient(to bottom right, #8ed4f2, #abeadb);"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>Linux C</span><h3>Linux 文件流</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text"> 文件系统编程概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%87%BD%E6%95%B0%E5%AF%B9%E6%AF%94"><span class="toc-number">1.1.</span> <span class="toc-text"> 三种类型的函数对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%9A%84%E8%BF%94%E5%9B%9E%E5%80%BC%E5%92%8C%E5%BD%A2%E5%8F%82"><span class="toc-number">1.2.</span> <span class="toc-text"> 函数的返回值和形参</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%B5%81%E7%9B%B8%E5%85%B3%E5%87%BD%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text"> 目录流相关函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chmod-%E6%94%B9%E5%8F%98%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90"><span class="toc-number">2.1.</span> <span class="toc-text">  chmod  改变文件权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getcwd-%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%E7%9A%84%E5%AE%8C%E6%95%B4%E8%B7%AF%E5%BE%84"><span class="toc-number">2.2.</span> <span class="toc-text">  getcwd  获取当前工作目录的完整路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chdir-%E6%94%B9%E5%8F%98%E5%BD%93%E5%89%8D%E7%9B%AE%E5%BD%95"><span class="toc-number">2.3.</span> <span class="toc-text">  chdir  改变当前目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mkdir-%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95"><span class="toc-number">2.4.</span> <span class="toc-text">  mkdir  创建目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rmdir-%E5%88%A0%E9%99%A4%E7%A9%BA%E7%9B%AE%E5%BD%95"><span class="toc-number">2.5.</span> <span class="toc-text">  rmdir  删除空目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opendir-%E6%89%93%E5%BC%80%E7%9B%AE%E5%BD%95%E6%B5%81"><span class="toc-number">2.6.</span> <span class="toc-text">  opendir  打开目录流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#closedir-%E5%85%B3%E9%97%AD%E7%9B%AE%E5%BD%95%E6%B5%81"><span class="toc-number">2.7.</span> <span class="toc-text">  closedir  关闭目录流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#readdir-%E8%AF%BB%E7%9B%AE%E5%BD%95%E6%B5%81"><span class="toc-number">2.8.</span> <span class="toc-text">  readdir  读目录流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#seekdir-%E5%92%8C-telldir"><span class="toc-number">2.9.</span> <span class="toc-text">  seekdir  和  telldir</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rewinddir-%E7%9B%AE%E5%BD%95%E6%B5%81%E9%87%8D%E7%BD%AE"><span class="toc-number">2.10.</span> <span class="toc-text">  rewinddir  目录流重置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stat-%E8%8E%B7%E5%8F%96%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">2.11.</span> <span class="toc-text">  stat  获取元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getpwuid-%E8%8E%B7%E5%8F%96%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">2.12.</span> <span class="toc-text">  getpwuid  获取用户信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getgrgid-%E8%8E%B7%E5%8F%96%E7%BB%84%E4%BF%A1%E6%81%AF"><span class="toc-number">2.13.</span> <span class="toc-text">  getgrgid  获取组信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#localtime-%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="toc-number">2.14.</span> <span class="toc-text">  localtime  时间函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E6%B5%81%E5%92%8C%E6%96%87%E4%BB%B6%E6%B5%81"><span class="toc-number">3.</span> <span class="toc-text"> 目录流和文件流</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-ll-%E6%8C%87%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text"> 实现 ll 指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E6%98%93%E7%89%88"><span class="toc-number">4.1.</span> <span class="toc-text"> 简易版</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96"><span class="toc-number">4.2.</span> <span class="toc-text"> 优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E4%BC%98%E5%8C%96"><span class="toc-number">4.3.</span> <span class="toc-text"> 再优化</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/c-cpp/linux-c/Linux%20C%20%E5%9F%BA%E7%A1%80/" rel="bookmark" title="Linux C 基础">Linux C 基础</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E6%9D%82%E9%A1%B9/" rel="bookmark" title="Linux 杂项">Linux 杂项</a></li><li  class="active"><a href="/c-cpp/linux-c/Linux%20%E7%9B%AE%E5%BD%95%E6%B5%81/" rel="bookmark" title="Linux 目录流">Linux 目录流</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E6%96%87%E4%BB%B6%E6%B5%81/" rel="bookmark" title="Linux 文件流">Linux 文件流</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E7%AE%A1%E9%81%93%E5%92%8C%20IO%20%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/" rel="bookmark" title="Linux 管道和 IO 多路复用">Linux 管道和 IO 多路复用</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E8%BF%9B%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/" rel="bookmark" title="Linux 进程（上）">Linux 进程（上）</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E8%BF%9B%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89/" rel="bookmark" title="Linux 进程（下）">Linux 进程（下）</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1/" rel="bookmark" title="Linux 进程间通信">Linux 进程间通信</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E4%BF%A1%E5%8F%B7/" rel="bookmark" title="Linux 信号">Linux 信号</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E7%BA%BF%E7%A8%8B/" rel="bookmark" title="Linux 线程">Linux 线程</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%90%8C%E6%AD%A5%E5%92%8C%E4%BA%92%E6%96%A5/" rel="bookmark" title="Linux 线程的同步和互斥.md">Linux 线程的同步和互斥.md</a></li><li ><a href="/c-cpp/linux-c/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" rel="bookmark" title="网络协议">网络协议</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" rel="bookmark" title="Linux 网络编程">Linux 网络编程</a></li><li ><a href="/c-cpp/linux-c/Linux%20%E8%BF%9B%E7%A8%8B%E6%B1%A0/" rel="bookmark" title="Linux 进程池">Linux 进程池</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="樱小路七叶" src="/assets/avatar.jpg"/><p class="name" itemprop="name">樱小路七叶</p><div class="description" itemprop="description">技术与美日新月异</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">91</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">11</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">13</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/cwlrin" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;cwlrin"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/ying-xiao-lu-qi-ye" class="item zhihu" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;ying-xiao-lu-qi-ye"><i class="ic i-zhihu"></i></a><a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=411590211" class="item music" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;411590211"><i class="ic i-cloud-music"></i></a><a target="_blank" rel="noopener" href="https://space.bilibili.com/8013992" class="item bilibili" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;8013992"><i class="ic i-bilibili"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/c-cpp/linux-c/Linux%20%E6%96%87%E4%BB%B6%E6%B5%81/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/c-cpp/linux-c/Linux%20%E6%9D%82%E9%A1%B9/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2020 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">樱小路七叶 @ 七葉の喫茶ステラ</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.4m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">21:46</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
    path: `c-cpp/linux-c/Linux 目录流/`,
    favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    nocopy: "false",
    copyright: `复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。`,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha384-Zm+UU4tdcfAm29vg+MTbfu&#x2F;&#x2F;q5B&#x2F;lInMbMCr4T8c9rQFyOv6PlfQYpB5wItcXWe7" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" integrity="sha384-TOxsBplaL96&#x2F;QDWPIUg+ye3v89qSE3s22XNtJMmCeZEep3cVDmXy1zEfZvVv+y2m" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.20" type="module" fetchpriority="high" defer></script></body></html>