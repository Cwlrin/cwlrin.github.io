<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Nana7ha's Café Stella" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Nana7ha's Café Stella" type="application/atom+xml"><link rel="alternate" type="application/json" title="Nana7ha's Café Stella" href="http://cwlrin.github.io/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-3QGRG5LW.js"></link><link rel="modulepreload" href="/js/chunk-7LBLERAB.js"></link><link rel="modulepreload" href="/js/chunk-CDMLOMPO.js"></link><link rel="modulepreload" href="/js/copy-tex-NI6UDW37.js"></link><link rel="modulepreload" href="/js/index.esm-LMM4SZN2.js"></link><link rel="modulepreload" href="/js/post-DKVG6ABI.js"></link><link rel="modulepreload" href="/js/quicklink-PZJIXTPA.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="s" as="image" fetchpriority="high"><link rel="preload" href=":" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="l" as="image" fetchpriority="high"><link rel="preload" href="i" as="image" fetchpriority="high"><link rel="preload" href="n" as="image" fetchpriority="high"><link rel="preload" href="k" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="s" as="image" fetchpriority="high"><link rel="preload" href="t" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="r" as="image" fetchpriority="high"><link rel="preload" href="v" as="image" fetchpriority="high"><link rel="preload" href="/" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="H" as="image" fetchpriority="high"><link rel="preload" href="R" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="c" as="image" fetchpriority="high"><link rel="preload" href="H" as="image" fetchpriority="high"><link rel="preload" href="M" as="image" fetchpriority="high"><link rel="preload" href="6" as="image" fetchpriority="high"><link rel="preload" href="L" as="image" fetchpriority="high"><link rel="preload" href="y" as="image" fetchpriority="high"><link rel="preload" href="8" as="image" fetchpriority="high"><link rel="preload" href="x" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="H" as="image" fetchpriority="high"><link rel="preload" href="J" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="L" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="z" as="image" fetchpriority="high"><link rel="preload" href="L" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="k" as="image" fetchpriority="high"><link rel="preload" href="v" as="image" fetchpriority="high"><link rel="preload" href="Y" as="image" fetchpriority="high"><link rel="preload" href="y" as="image" fetchpriority="high"><link rel="preload" href="9" as="image" fetchpriority="high"><link rel="preload" href="i" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="G" as="image" fetchpriority="high"><link rel="preload" href="U" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="M" as="image" fetchpriority="high"><link rel="preload" href="W" as="image" fetchpriority="high"><link rel="preload" href="U" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="M" as="image" fetchpriority="high"><link rel="preload" href="j" as="image" fetchpriority="high"><link rel="preload" href="V" as="image" fetchpriority="high"><link rel="preload" href="l" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="j" as="image" fetchpriority="high"><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="Y" as="image" fetchpriority="high"><link rel="preload" href="2" as="image" fetchpriority="high"><link rel="preload" href="M" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="L" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="V" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="W" as="image" fetchpriority="high"><link rel="preload" href="T" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="5" as="image" fetchpriority="high"><link rel="preload" href="R" as="image" fetchpriority="high"><link rel="preload" href="E" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="b" as="image" fetchpriority="high"><link rel="preload" href="T" as="image" fetchpriority="high"><link rel="preload" href="R" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="Q" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="r" as="image" fetchpriority="high"><link rel="preload" href="U" as="image" fetchpriority="high"><link rel="preload" href="E" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="n" as="image" fetchpriority="high"><link rel="preload" href="S" as="image" fetchpriority="high"><link rel="preload" href="W" as="image" fetchpriority="high"><link rel="preload" href="x" as="image" fetchpriority="high"><link rel="preload" href="G" as="image" fetchpriority="high"><link rel="preload" href="W" as="image" fetchpriority="high"><link rel="preload" href="G" as="image" fetchpriority="high"><link rel="preload" href="k" as="image" fetchpriority="high"><link rel="preload" href="4" as="image" fetchpriority="high"><link rel="preload" href="Q" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="y" as="image" fetchpriority="high"><link rel="preload" href="U" as="image" fetchpriority="high"><link rel="preload" href="X" as="image" fetchpriority="high"><link rel="preload" href="l" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="a" as="image" fetchpriority="high"><link rel="preload" href="V" as="image" fetchpriority="high"><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="D" as="image" fetchpriority="high"><link rel="preload" href="U" as="image" fetchpriority="high"><link rel="preload" href="H" as="image" fetchpriority="high"><link rel="preload" href="F" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="W" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="x" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="h" as="image" fetchpriority="high"><link rel="preload" href="3" as="image" fetchpriority="high"><link rel="preload" href="R" as="image" fetchpriority="high"><link rel="preload" href="m" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="M" as="image" fetchpriority="high"><link rel="preload" href="0" as="image" fetchpriority="high"><link rel="preload" href="E" as="image" fetchpriority="high"><link rel="preload" href="_" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="T" as="image" fetchpriority="high"><link rel="preload" href="1" as="image" fetchpriority="high"><link rel="preload" href="E" as="image" fetchpriority="high"><link rel="preload" href="Y" as="image" fetchpriority="high"><link rel="preload" href="X" as="image" fetchpriority="high"><link rel="preload" href="d" as="image" fetchpriority="high"><link rel="preload" href="o" as="image" fetchpriority="high"><link rel="preload" href="Z" as="image" fetchpriority="high"><link rel="preload" href="H" as="image" fetchpriority="high"><link rel="preload" href="I" as="image" fetchpriority="high"><link rel="preload" href="." as="image" fetchpriority="high"><link rel="preload" href="j" as="image" fetchpriority="high"><link rel="preload" href="p" as="image" fetchpriority="high"><link rel="preload" href="g" as="image" fetchpriority="high"><meta name="keywords" content="C++"/><meta name="description" content="技术与美日新月异"/><link rel="canonical" href="http://cwlrin.github.io/c-cpp/cpp-base/C++%20%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1/"><title>C++ 类和对象</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">C++ 类和对象</h1><div class="meta"><span class="item" title="创建时间：2020-11-05 12:10:50"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2020-11-05T12:10:50+08:00">2020-11-05</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>63k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>57 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">七葉の喫茶ステラ</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VZWTd5REdpbTR0QmhrUEpnSWxGWGk4Qm0yUXlZaVhDUHFpWmoxZmh3RmpZM0E_ZT1EYXdoZHI.jpg" loading="eager" decoding="async" fetchpriority="high" alt="Nana7ha's Café Stella"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/c-cpp/" itemprop="item" rel="index" title="分类于C/C++"><span itemprop="name">C/C++<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/c-cpp/cpp-basic/" itemprop="item" rel="index" title="分类于C++ 基础"><span itemprop="name">C++ 基础<meta itemprop="position" content="1"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://cwlrin.github.io/c-cpp/cpp-base/C++%20%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="樱小路七叶"/><meta itemprop="description" content=", 技术与美日新月异"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Nana7ha's Café Stella"/></span><div class="body md" itemprop="articleBody"><h2 id="面向对象思想"><a class="anchor" href="#面向对象思想">#</a> 面向对象思想</h2>
<h3 id="过程论procedural-programming"><a class="anchor" href="#过程论procedural-programming">#</a> 过程论（Procedural Programming）</h3>
<p><strong>核心观点</strong>：</p>
<ul>
<li>程序由一系列步骤或过程组成，这些步骤按照一定的顺序执行。</li>
<li>数据和逻辑是分离的，数据是被处理的对象，而逻辑是处理数据的规则。</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li>逻辑清晰：对于简单的、顺序的任务，过程论可以提供清晰的执行路径。</li>
<li>易于理解和控制：在小型或结构化程度高的应用中，过程论易于理解和控制。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>可扩展性差：随着系统复杂度的增加，过程论可能导致代码难以管理和维护。</li>
<li>难以适应变化：在需求变化时，过程论的程序可能需要大规模重构。</li>
</ul>
<h3 id="对象论object-oriented-programming-oop"><a class="anchor" href="#对象论object-oriented-programming-oop">#</a> 对象论（Object-Oriented Programming, OOP）</h3>
<p><strong>核心观点</strong>：</p>
<ul>
<li>程序由一系列交互的对象组成，每个对象包含数据和处理这些数据的方法。</li>
<li>对象是数据和逻辑的封装体，具有状态、行为和标识。</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li>高度抽象：通过封装、继承和多态等机制，OOP 提供了高度的抽象能力。</li>
<li>易于扩展和维护：对象的模块化特性使得系统易于扩展和维护。</li>
<li>重用性：对象和类可以被重用，减少了代码的冗余。</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>性能开销：对象的封装和多态等特性可能会带来额外的性能开销。</li>
<li>设计复杂性：设计良好的对象模型需要深入的理解和经验。</li>
</ul>
<h3 id="过程论与对象论的辩证关系"><a class="anchor" href="#过程论与对象论的辩证关系">#</a> 过程论与对象论的辩证关系</h3>
<ul>
<li><strong>相互渗透</strong>：在实际应用中，过程论和对象论往往是相互渗透的。例如，一个面向对象的程序可能包含一些过程式的函数来处理特定的任务。</li>
<li><strong>相互转化</strong>：过程论可以通过封装和抽象转化为对象论，反之亦然。这种转化不是简单的替换，而是根据实际需求和上下文来决定使用哪种方法。</li>
</ul>
<h2 id="类的定义"><a class="anchor" href="#类的定义">#</a> 类的定义</h2>
<p>类是面向对象编程的核心概念之一，用于模拟现实世界中的实体和概念。类的定义和使用涉及几个关键部分，包括数据成员、成员函数以及类的声明和定义。</p>
<p>类的定义和声明：</p>
<ol>
<li>
<p><strong>数据成员</strong>：这些是类的属性，用于存储对象的状态信息。数据成员可以是私有的或公有的，这取决于类的设计和封装的需求。</p>
</li>
<li>
<p><strong>成员函数</strong>：这些是类的方法，用于定义可以对类的数据成员执行的操作。成员函数可以访问和修改数据成员。</p>
</li>
<li>
<p><strong>类的声明</strong>：这通常在头文件中进行，允许其他类或函数知道类的存在，而无需了解其具体实现。</p>
</li>
<li>
<p><strong>类的定义</strong>：这包括类的具体实现，通常在源文件中进行。</p>
</li>
</ol>
<p>类的基本语法：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 类的声明</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// 公有成员函数</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">myFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 函数实现</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 公有数据成员</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">int</span> _a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">// 私有数据成员</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">int</span> _b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">// 类的声明，仅声明，定义在后面</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyClass2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">// 类的完整定义</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">MyClass2</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Display function."</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="访问修饰符"><a class="anchor" href="#访问修饰符">#</a> 访问修饰符</h3>
<p>在 C++ 编程中，我们经常需要定义类来封装数据和行为。以代工厂的角度来看，我们可以定义一个  <code>Computer</code>  类，它包含品牌和价格这两个属性，以及设置这些属性的行为。以下是  <code>Computer</code>  类的基本定义：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">float</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        _price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">char</span> _brand<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">float</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在这个类中， <code>_brand</code>  和  <code>_price</code>  是私有成员，这意味着它们不能直接在类外部被访问。这是为了保护数据的完整性和封装性，确保对象的状态只能通过类提供的方法来改变。</p>
<p>当我们尝试在类外部直接访问这些私有成员时，比如：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer pc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pc<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正确</span></pre></td></tr><tr><td data-num="3"></td><td><pre>pc<span class="token punctuation">.</span>_price<span class="token punctuation">;</span> <span class="token comment">// 错误，因为_price 是私有的</span></pre></td></tr></table></figure><p>我们会发现，直接访问  <code>_price</code>  会导致编译错误。这是因为私有成员只能在类的内部被访问，例如在成员函数中。</p>
<p>class 中的所有的成员都拥有自己的访问权限，分别可以用以下的三个访问修饰符进行修饰：</p>
<ul>
<li>
<p><code>public</code> : 公有的访问权限，在类外可以通过对象直接访问公有成员</p>
</li>
<li>
<p><code>protected</code> : 保护的访问权限，在本类中和派生类中可以访问，在类外不能通过对象直接访问（后面学）</p>
</li>
<li>
<p><code>private</code> : 私有的访问权限，在本类之外不能访问，比较敏感的数据设为 private，类定义中可以访问。</p>
</li>
</ul>
<p>为了正确地使用  <code>Computer</code>  类，我们应该通过公共接口（即公共成员函数）来设置和获取数据。例如，设置品牌和价格应该使用  <code>setBrand</code>  和  <code>setPrice</code>  函数：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer pc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pc<span class="token punctuation">.</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token string">"Dell"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>pc<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这样，我们就能够安全地操作对象的状态，同时保持类的封装性和数据的安全性。<br />
public 的成员函数也可以称为接口，就是该类提供给外界使用的路径，在类外可以直接通过对象进行访问</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> brand<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">float</span> price<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    _price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">char</span> _brand<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">float</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>Computer pc<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>pc<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正确</span></pre></td></tr><tr><td data-num="18"></td><td><pre>pc<span class="token punctuation">.</span>_price<span class="token punctuation">;</span> <span class="token comment">// 错误，因为 _price 是私有的</span></pre></td></tr></table></figure><h3 id="struct-与-class-的对比"><a class="anchor" href="#struct-与-class-的对比">#</a>  <code> struct</code>  与  <code> class</code>  的对比</h3>
<p>在 C++ 中，类（ <code>class</code> ）的概念与 C 语言中的结构体（ <code>struct</code> ）非常相似，但它们在功能和用途上有所不同。</p>
<p>C 语言中， <code>struct</code>  主要用于创建包含多个不同类型数据成员的复合数据类型。它仅仅是数据的集合，不包含方法（函数）。例如：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">struct</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">int</span> number<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">int</span> score<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">struct</span> <span class="token class-name">Student</span> s1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">struct</span> <span class="token class-name">Student</span> s2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这里， <code>struct Student</code>  定义了一个包含学号、姓名和分数的结构体。在 C 语言中，所有结构体成员默认是公开的，无法隐藏数据。</p>
<p>为了简化结构体类型的使用，C 语言提供了  <code>typedef</code>  关键字，允许我们为结构体类型创建别名：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">int</span> number<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">int</span> score<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span> Student<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  Student s1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  Student s2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这种方式使得结构体的使用更加类似于 C++ 中的类。</p>
<p>在 C++ 中， <code>struct</code>  和  <code>class</code>  都可以用来定义数据和行为的组合，但它们在默认访问权限上有所不同：</p>
<ul>
<li><strong>C++ 中的  <code>struct</code> </strong>：默认访问权限是  <code>public</code> ，这意味着其成员在类外可以直接访问，除非显式指定为  <code>private</code>  或  <code>protected</code> 。</li>
<li><strong>C++ 中的  <code>class</code> </strong>：默认访问权限是  <code>private</code> ，这意味着其成员在类外不能直接访问，需要通过公共接口（如公共成员函数）来访问。</li>
</ul>
<p>这种设计使得 C++ 的  <code>class</code>  更适合实现面向对象编程中的封装特性，即隐藏对象的属性和实现细节，仅对外公开接口，严格控制属性的访问级别。</p>
<h3 id="成员函数的定义"><a class="anchor" href="#成员函数的定义">#</a> 成员函数的定义</h3>
<p>在 C++ 中，成员函数可以在类的定义内部直接实现，也可以仅在类定义中声明成员函数，然后在类定义外部实现。以下是两种方式的示例：</p>
<p>成员函数定义的形式：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 设置品牌</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">float</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> _price <span class="token operator">=</span> price<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 设置价格</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* 打印信息 */</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">char</span> _brand<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">float</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>类外定义成员函数：</strong></p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置品牌</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">float</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置价格</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印信息</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">char</span> _brand<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">float</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 类外定义成员函数</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">float</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  _price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>为什么采用成员函数声明和实现分离的写法？</p>
<p>在实际开发中，如果一个类包含很多成员函数，直接在类定义中实现所有成员函数会使代码难以阅读和维护。将成员函数的声明放在类定义中，而将实现放在类定义外部，可以提高代码的可读性和可维护性。同时，这种方法也方便在类定义中通过注释对成员函数进行说明。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置品牌</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置价格</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印信息</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">char</span> _brand<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// 如果将成员函数放在类外定义</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 需要在成员函数名称前面加上类作用域限定</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  _price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"brand:"</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"price:"</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>多文件联合编译时可能出现的错误</p>
<p>在头文件中定义函数时，如果多个源文件包含了该头文件，那么在联合编译时可能会出现重定义错误。这是因为头文件的内容在每个源文件中都会被复制一份，导致在链接阶段出现多个相同函数定义的情况。</p>
<p><strong>解决方法：</strong></p>
<ol>
<li>
<p><strong>使用  <code>inline</code>  关键字：</strong> 在成员函数的定义前加上  <code>inline</code>  关键字，这样即使在头文件中定义函数，也不会导致重定义错误。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置品牌</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置价格</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印信息</span></pre></td></tr><tr><td data-num="6"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">char</span> _brand<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  _price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"brand:"</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"price:"</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>类内部定义成员函数：</strong> 类内部定义的成员函数默认是  <code>inline</code>  函数，因此可以在头文件中定义。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setBrand</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">setPrice</span><span class="token punctuation">(</span><span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	_price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"brand:"</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"price:"</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">char</span> _brand<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>分离声明和实现：</strong> 将成员函数的声明放在头文件中，而将定义放在源文件中。这样即使有多个源文件包含头文件，也不会出现重定义错误。</p>
</li>
</ol>
<h2 id="对象的创建"><a class="anchor" href="#对象的创建">#</a> 对象的创建</h2>
<p>构造函数的主要目的是初始化数据成员。它在对象创建时自动调用，确保对象的状态在首次使用前是正确的。</p>
<p>构造函数具有以下特点：</p>
<ul>
<li><strong>无返回值</strong>：构造函数不返回任何值，甚至不能有  <code>void</code> 。</li>
<li><strong>名称与类名相同</strong>：构造函数的名称必须与类名完全相同。</li>
<li><strong>参数列表</strong>：构造函数可以通过参数列表接收初始化数据。</li>
</ul>
<h3 id="对象的创建规则"><a class="anchor" href="#对象的创建规则">#</a> 对象的创建规则</h3>
<p><strong>默认构造函数</strong>：如果类中没有显式定义任何构造函数，编译器会生成一个默认的无参构造函数。但这个默认构造函数不会初始化数据成员，其值是不确定的。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix</pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> _iy</pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  Point pt<span class="token punctuation">;</span> <span class="token comment">// 调用了默认的无参构造</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出不确定的值</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>显式定义构造函数</strong>：如果类中定义了至少一个构造函数，编译器将不会自动生成默认构造函数。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    _ix <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    _iy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix</pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> _iy</pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  Point pt<span class="token punctuation">;</span> <span class="token comment">// 调用了自定义的构造函数</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 (0,0)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>带参数的构造函数</strong>：构造函数可以接收参数，这提供了更大的灵活性。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    _ix <span class="token operator">=</span> ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    _iy <span class="token operator">=</span> iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix</pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> _iy</pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  Point <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正确</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  pt2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 (10,20)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>提供无参构造函数</strong>：如果需要无参构造函数，必须手动定义。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    _ix <span class="token operator">=</span> ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    _iy <span class="token operator">=</span> iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix</pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> _iy</pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  Point pt<span class="token punctuation">;</span> <span class="token comment">// 正确</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  Point <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  pt2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出 (10,20)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>构造函数重载</strong>：一个类可以有多个构造函数。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    _ix <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    _iy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    _ix <span class="token operator">=</span> ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    _iy <span class="token operator">=</span> iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix</pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> _iy</pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="对象的数据成员初始化"><a class="anchor" href="#对象的数据成员初始化">#</a> 对象的数据成员初始化</h3>
<p>在 C++ 中，构造函数不仅用于执行对象创建时的初始化操作，而且推荐使用初始化列表来初始化数据成员。</p>
<p>初始化列表位于构造函数的参数列表之后、函数体之前，用于初始化数据成员。它使用冒号开始，数据成员的初始值用逗号分隔，并放在一对小括号中。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> iy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	  <span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span>  <span class="token comment">// 初始化列表</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> _iy <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如果在构造函数的初始化列表中没有显式地初始化某个成员，则该成员将在构造函数体执行之前进行默认初始化。这意味着，即使在构造函数体内对成员进行了赋值，成员也会先经历默认初始化，然后再被赋新值。</p>
<p>数据成员的初始化顺序与其在类中声明的顺序一致，与它们在初始化列表中的顺序无关。初始化列表通常按照数据成员声明的顺序排列，以保持代码的清晰和一致性。</p>
<p>构造函数的参数可以设置默认值，使得构造函数更加灵活。如果在声明和定义分开的情况下，建议在声明中设置参数的默认值。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 默认参数设置在声明时</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 使用默认参数值</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>从 C++11 开始，普通的数据成员可以在声明时直接初始化，这为初始化提供了另一种选择。但是，对于某些特殊的数据成员（如引用或类类型），初始化只能在初始化列表中进行。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">int</span> _ix <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// C++11 直接初始化</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">int</span> _iy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="对象所占空间大小"><a class="anchor" href="#对象所占空间大小">#</a> 对象所占空间大小</h3>
<p>C++ 中，类的大小和对象的大小通常是相同的，因为类定义了对象的内存布局。类的大小由其数据成员的大小和内存对齐规则共同决定。</p>
<p>使用  <code>sizeof</code>  运算符可以查看类的大小和类对象的大小，结果通常是相同的。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Point<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span> <span class="token comment">// 输出类的大小</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>    <span class="token comment">// 输出对象的大小</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>内存对齐是出于以下原因：</p>
<ol>
<li>
<p><strong>平台原因</strong>：某些硬件平台只能在特定的地址处访问特定类型的数据。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VWN1JGTVcxYnBORGo0dFd3dnR6UFRFQllSS3BRQ1pqMDhYWFVwdk1ST25HTlE_ZT0yN2tWa3A.png" alt="image-20240223163737665.png" /></p>
</li>
<li>
<p><strong>性能原因</strong>：内存对齐可以减少内存访问次数，提高性能。</p>
</li>
</ol>
<p>内存对齐的规则</p>
<ol>
<li><strong>按照类中最大数据成员大小的倍数对齐</strong>。</li>
<li><strong>数据成员的声明顺序会影响类的大小</strong>。</li>
</ol>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">int</span> _num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// sizeof(A) = 16</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">int</span> _num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">int</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">// sizeof(B) = 8</span></pre></td></tr></table></figure><p>64 位系统默认以 8 个字节的块大小进行读取。</p>
<p>如果没有内存对齐机制，CPU 读取 _price 时，需要两次总线周期来访问内存，第一次读取_price 数据前四个字节的内容，第二次读取后四个字节的内容，还要经过计算，将它们合并成一个数据。</p>
<p>有了内存对齐机制后，以浪费 4 个字节的空间为代价，读取_price 时只需要一次访问，所以编译器会隐式地进行内存对齐。</p>
<p>数据成员的顺序会影响类的大小，因为编译器会根据内存对齐规则来安排数据成员的位置。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">C</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">int</span> _c1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">int</span> _c2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">double</span> _c3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// sizeof(C) = 16</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">D</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">int</span> _d1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">double</span> _d2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">int</span> _d3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// sizeof(D) = 24</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VjYVlvWm11X3NkTXU1WDZLbTY2aWVrQjRjT3l2UU4zQlRmVlI4R1hWbG5CNXc_ZT1NdnV0VHE.png" alt="image-20240223163111420.png" /></p>
<p>如果数据成员中有数组类型，会按照除数组以外的其他数据成员中最大的那一个的倍数对齐。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">E</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">double</span> _e<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">char</span> _eArr<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">double</span> _e1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">int</span> _e2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// sizeof(E) = 48</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">F</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">char</span> _fArr<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// sizeof(F) = 20</span></pre></td></tr></table></figure><p>即使是空类，其对象所占空间通常也为 1 个字节，这是编译器的占位机制。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">EmptyClass</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>EmptyClass ec<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// sizeof(EmptyClass) = 1</span></pre></td></tr></table></figure><p>可以使用  <code>#pragma pack(n)</code>  指令来控制编译器的对齐方式，其中  <code>n</code>  可以是 1, 2, 4, 8, 16 等。</p>
<h3 id="指针数据成员"><a class="anchor" href="#指针数据成员">#</a> 指针数据成员</h3>
<p>在 C++ 中，如果一个类的成员变量是指针，那么通常意味着需要在堆上动态分配内存。为了确保申请的内存得到妥善管理，需要在类的析构函数中释放这些内存。</p>
<p>以下代码示例中， <code>Computer</code>  类的构造函数在初始化列表中分配了内存，但在对象销毁时没有相应的内存释放机制，导致了内存泄漏。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	  <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>_brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在上述代码中， <code>_brand</code>  成员在构造函数中通过  <code>new</code>  分配了内存，但在对象  <code>pc</code>  被销毁时，并没有相应的  <code>delete</code>  操作来释放内存。这会导致内存泄漏。</p>
<h2 id="对象的销毁"><a class="anchor" href="#对象的销毁">#</a> 对象的销毁</h2>
<p>析构函数的作用</p>
<ol>
<li><strong>资源释放</strong>：析构函数负责清理对象的数据成员申请的资源，特别是动态分配的堆空间。这是防止内存泄漏和其他资源泄露的关键。</li>
<li><strong>自动调用</strong>：当对象的作用域结束或被显式删除时，析构函数会被自动调用。</li>
</ol>
<p>析构函数是一种特殊的成员函数，具有以下特点：</p>
<ul>
<li><strong>无返回值</strong>：析构函数不返回任何值，甚至不能是  <code>void</code> 。</li>
<li><strong>无参数</strong>：析构函数不接受任何参数。</li>
<li><strong>特殊命名</strong>：析构函数的名称与类名相同，但在类名前加一个波浪号  <code>~</code> 。</li>
</ul>
<p>析构函数的唯一性：每个类只能有一个析构函数，它不能被重载。</p>
<p>默认析构函数：如果程序员没有显式定义析构函数，编译器会默认提供一个。默认析构函数不做任何操作，但当涉及到动态内存管理或其他资源管理时，显式定义析构函数是必要的。</p>
<p>析构函数的自动调用：当对象生命周期结束时，无论是因为超出作用域还是因为被显式删除，析构函数都会被自动调用。</p>
<h3 id="自定义析构函数"><a class="anchor" href="#自定义析构函数">#</a> 自定义析构函数</h3>
<p>在 C++ 中，析构函数是一个特殊的成员函数，它在对象生命周期结束时被自动调用，用于执行清理工作，尤其是释放动态分配的内存资源。</p>
<p>析构函数的主要作用是：</p>
<ol>
<li><strong>释放资源</strong>：清理对象的数据成员申请的堆空间，防止内存泄漏。</li>
<li><strong>安全回收</strong>：将指针成员设置为  <code>nullptr</code> ，确保不会再次释放同一内存。</li>
</ol>
<p>以下是一个包含指针成员的  <code>Computer</code>  类，它演示了如何正确实现析构函数：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      _brand <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> <span class="token comment">// 设为空指针，安全回收</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Computer()"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">char</span><span class="token operator">*</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"Apple"</span><span class="token punctuation">,</span> <span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token comment">//pc.~Computer (); // 手动调用析构函数是不推荐的做法</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>析构函数的规范写法</p>
<ol>
<li><strong>检查指针是否为空</strong>：在释放内存之前，检查指针是否为空，以避免  <code>delete</code>  空指针的风险</li>
<li><strong>设置为空指针</strong>：释放内存后，将指针设置为  <code>nullptr</code> ，确保不会再次释放同一内存。</li>
</ol>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VROVZVcGpEUjVoTGgzLU5TNGlHMllzQncwZnVVM1g0aGhUVVpiR090M1d0MkE_ZT00ZG1MSVE.png" alt="undefined202403071603877.png" /></p>
<p>析构函数的调用</p>
<ul>
<li><strong>自动调用</strong>：对象被销毁时，析构函数会被自动调用。</li>
<li><strong>手动调用</strong>：虽然可以通过对象手动调用析构函数，但这通常不推荐，因为它可能导致各种问题，如重复释放内存、访问已销毁的对象等。</li>
</ul>
<p>手动调用析构函数的问题</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  pc<span class="token punctuation">.</span><span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 手动调用析构函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 此时调用 print 函数会导致未定义行为</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul>
<li><strong>问题 1</strong>：手动调用析构函数后，再次调用成员函数可能导致未定义行为，因为对象的内存可能已经被部分释放。</li>
<li><strong>问题 2</strong>：手动调用析构函数可能导致析构函数被调用两次，从而引发  <code>double free</code>  错误。</li>
</ul>
<p>析构函数是可以通过对象来调用，而构造函数不同。</p>
<p>构造函数是最特殊的成员函数，不是由对象来调用构造函数。而是，编译器在看到创建对象的语句时，会自动生成一段代码，在这段代码中调用构造函数，利用传入的参数来初始化对象。</p>
<h3 id="析构函数的调用时机"><a class="anchor" href="#析构函数的调用时机">#</a> 析构函数的调用时机</h3>
<ol>
<li><strong>全局对象</strong>：
<ul>
<li><strong>析构时机</strong>：全局对象的析构函数在程序结束时调用，通常是在  <code>main</code>  函数执行完毕后，操作系统开始卸载程序之前。</li>
<li><strong>特点</strong>：全局对象的生命周期贯穿整个程序，它们的析构函数确保在程序结束前释放资源。</li>
</ul>
</li>
<li><strong>局部对象</strong>：
<ul>
<li><strong>析构时机</strong>：局部对象的析构函数在离开其定义的作用域时调用。例如，在一个函数中定义的局部对象，在函数返回前会被销毁。</li>
<li><strong>特点</strong>：局部对象的生命周期由其作用域决定，析构函数确保在对象离开作用域时资源被释放。</li>
</ul>
</li>
<li><strong>静态对象</strong>：
<ul>
<li><strong>析构时机</strong>：静态对象（包括静态存储区的对象和  <code>static</code>  关键字定义的对象）的析构函数在程序结束时调用，与全局对象类似。</li>
<li><strong>特点</strong>：静态对象的生命周期也是整个程序期间，它们的析构函数确保在程序结束前进行必要的清理。</li>
</ul>
</li>
<li><strong>堆对象</strong>：
<ul>
<li><strong>析构时机</strong>：堆对象的析构函数在使用  <code>delete</code>  操作符删除对象时调用。这是显式的内存管理操作，确保在不再需要对象时释放其占用的内存。</li>
<li><strong>特点</strong>：堆对象的生命周期由程序员控制，需要手动管理内存的分配和释放。</li>
</ul>
</li>
</ol>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer <span class="token function">pc1</span><span class="token punctuation">(</span><span class="token string">"Dell"</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  Computer <span class="token function">pc2</span><span class="token punctuation">(</span><span class="token string">"Lenovo"</span><span class="token punctuation">,</span><span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">static</span> Computer <span class="token function">pc3</span><span class="token punctuation">(</span><span class="token string">"Asus"</span><span class="token punctuation">,</span><span class="token number">6500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">int</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">delete</span> p<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  p <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  Computer <span class="token operator">*</span> pp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span><span class="token number">5500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">/* pp->print(); */</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">/* (*pp).print(); */</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">delete</span> pp<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  pp <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VRbkJEdy11cjVsRmsxaUpZT1JFOWw4QkZmalNLN2UyakM2MmljdWJrZkl3TXc_ZT1MdlN1blo.png" alt="image-20240517091425912.png" /></p>
<h2 id="拷贝构造函数"><a class="anchor" href="#拷贝构造函数">#</a> 拷贝构造函数</h2>
<p>对于内置类型而言，使用一个变量初始化另一个变量是很常见的操作</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">int</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr></table></figure><p>那么对于自定义类型，我们也希望能有这样的效果，如</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point <span class="token function">pt1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Point pt2 <span class="token operator">=</span> pt1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>pt2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>发现这种操作也是可以通过的。执行  <code>Point pt2 = pt1;</code>  语句时，  <code>pt1</code>  对象已经存在，而  <code>pt2</code>  对象还不存在，所以也是这句创建了  <code>pt2</code>  对象，既然涉及到对象的创建，就必然需要调用构造函数，而这里会调用的就是拷贝构造函数 (复制构造函数)。</p>
<h3 id="拷贝构造函数的定义"><a class="anchor" href="#拷贝构造函数的定义">#</a> 拷贝构造函数的定义</h3>
<p>在 C++ 中，拷贝构造函数用于创建一个对象的新实例，该实例是另一个同类型对象的副本。如果类中包含指针成员指向动态分配的内存，使用默认的拷贝构造函数会导致浅拷贝，即新对象和原对象的指针成员指向同一块内存区域。</p>
<p>拷贝构造函数用于创建一个对象的新实例，该实例是另一个同类型对象的副本。它主要用于以下场景：</p>
<ol>
<li><strong>对象的初始化</strong>：当一个对象需要通过另一个同类型的对象来初始化时。</li>
<li><strong>函数参数传递</strong>：当函数的参数通过值传递对象时。</li>
<li><strong>函数返回对象</strong>：当函数返回一个对象时。</li>
</ol>
<p>拷贝构造函数具有以下特点：</p>
<ul>
<li><strong>参数</strong>：它接受一个对类类型的常量引用作为唯一参数，用于传递要拷贝的对象。</li>
<li><strong>名称</strong>：它的名称与类名相同，并带有一个参数。</li>
<li><strong>默认行为</strong>：如果未显式定义拷贝构造函数，编译器会生成一个默认的拷贝构造函数，该构造函数会逐个成员地拷贝已有对象的值。</li>
</ul>
<p>没有显式定义拷贝构造函数，这条复制语句依然可以通过，说明编译器自动提供了默认的拷贝构造函数。其形式是：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_ix<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_iy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>拷贝构造函数看起来非常简单，那么我们尝试对  <code>Computer</code>  类的对象进行同样的复制操作。发现同样可以编译通过，但运行报错。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"Acer"</span><span class="token punctuation">,</span><span class="token number">4500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Computer pc2 <span class="token operator">=</span> pc<span class="token punctuation">;</span> <span class="token comment">// 调用拷贝构造函数</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_price</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Computer(const Computer &amp; rhs)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VUOFRiV0RDZjI5SHFrbGhRSTZudVlBQlpCdjNNZ3d4Y3FpU2lhT2FQZjVMQ0E_ZT1qQ0hmN2I.png" alt="image-20240517101108391.png" /></p>
<p>浅拷贝意味着新对象和原对象共享相同的资源（如堆内存）。这会导致以下问题：</p>
<ul>
<li><strong>内存泄漏</strong>：当两个对象都试图释放同一块内存时，可能会导致内存泄漏或程序崩溃。</li>
<li><strong> <code>double free</code>  错误</strong>：当两个对象的析构函数都尝试释放同一块内存时，会导致  <code>double free</code>  错误。</li>
</ul>
<p>为了避免这些问题，需要在自定义的拷贝构造函数中实现深拷贝。深拷贝意味着为新对象分配新的内存，并复制原对象的数据到这块新内存中。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	  <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// 深拷贝构造函数</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	  <span class="token operator">:</span> <span class="token function">_price</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	_brand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Computer() called.\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>_brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"Acer"</span><span class="token punctuation">,</span> <span class="token number">4500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  Computer pc2 <span class="token operator">=</span> pc<span class="token punctuation">;</span> <span class="token comment">// 调用深拷贝构造函数</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  pc2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VaaEZrc2d2RTZSR2ptVkZPY3BNVEF3QnAyTTIwaUlsUkJ5MEo4YVhybUZxd0E_ZT1FSFZJemo.png" alt="image-20230831161420785.png" /></p>
<h3 id="拷贝构造函数的调用时机"><a class="anchor" href="#拷贝构造函数的调用时机">#</a> 拷贝构造函数的调用时机</h3>
<p>拷贝构造函数在以下情况下被调用：</p>
<ol>
<li>
<p><strong>对象初始化</strong>：当一个新对象通过已存在的对象来初始化时，调用拷贝构造函数。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point <span class="token function">pt1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 利用一个已经存在的对象用复制的方式创建出新的对象</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 调用拷贝构造，用 = 连接是为了跟内置类型保持一致</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Point pt2 <span class="token operator">=</span> pt1<span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>函数参数传递</strong>：当函数的参数以值的方式传递对象时，实参初始化形参会调用拷贝构造函数。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 当函数的实参和形参都是对象时</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 利用实参初始化形参，相当于是值传递</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 会发生复制</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">printPoint</span><span class="token punctuation">(</span>Point p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>Point pt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token function">printPoint</span><span class="token punctuation">(</span>pt<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用拷贝构造函数</span></pre></td></tr></table></figure><p>为了避免不必要的拷贝，可以按引用传递对象：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 为了避免这次不必要的拷贝，可以使用引用作为参数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">printPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>函数返回对象</strong>：当函数返回一个对象时，返回值需要通过拷贝构造函数初始化调用者的局部变量（编译器有优化）。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 函数的返回值是对象时</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 函数体中执行 return 语句时会发生复制</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Point <span class="token function">createPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    Point <span class="token function">p</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">;</span> <span class="token comment">// 调用拷贝构造函数</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>为了避免多余的拷贝，可以按引用返回对象，但要确保返回对象的生命周期：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 为了避免这次多余的拷贝，可以使用引用作为返回值</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 但一定要确保返回值的生命周期大于函数的生命周期</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Point<span class="token operator">&amp;</span> <span class="token function">createPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">static</span> Point <span class="token function">p</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">return</span> p<span class="token punctuation">;</span> <span class="token comment">// 返回引用</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>第三种情况直接编译并不会显示拷贝构造函数的调用，但是底层实际是调用了的，加上优化参数进行编译可以看到效果</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>g<span class="token operator">++</span> CopyComputer<span class="token punctuation">.</span>cc <span class="token operator">-</span>fno<span class="token operator">-</span>elide<span class="token operator">-</span>constructors</pre></td></tr></table></figure></li>
</ol>
<h3 id="拷贝构造函数的形式探究"><a class="anchor" href="#拷贝构造函数的形式探究">#</a> 拷贝构造函数的形式探究</h3>
<h4 id="拷贝构造函数是否可以去掉引用符号"><a class="anchor" href="#拷贝构造函数是否可以去掉引用符号">#</a> 拷贝构造函数是否可以去掉引用符号？</h4>
<p>拷贝构造函数的标准形式是：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ClassName</span><span class="token punctuation">(</span><span class="token keyword">const</span> ClassName<span class="token operator">&amp;</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这里的  <code>const ClassName&amp;</code>  是一个常量引用，允许我们通过引用传递对象，而不需要进行拷贝。</p>
<p>如果我们尝试将拷贝构造函数的参数改为值传递，即去掉引用符号，形式变为：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ClassName</span><span class="token punctuation">(</span>ClassName other<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在这种情况下，当我们用一个对象来初始化另一个对象时，会发生以下情况：</p>
<ol>
<li><strong>递归调用</strong>：当我们调用拷贝构造函数时，编译器会创建一个新的对象（形参）来接收传入的对象（实参）。这将再次调用拷贝构造函数来初始化这个新的对象。</li>
<li><strong>栈溢出</strong>：由于每次调用拷贝构造函数时都在创建新的对象，导致不断递归调用，最终会导致栈溢出，程序崩溃。</li>
</ol>
<p>以下是一个示例，展示了去掉引用符号后会导致的错误：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Constructor called."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment">// 错误的拷贝构造函数</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span>Point <span class="token keyword">const</span> other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 去掉引用符号</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Copy constructor called."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	  _x <span class="token operator">=</span> other<span class="token punctuation">.</span>_x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	  _y <span class="token operator">=</span> other<span class="token punctuation">.</span>_y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  Point <span class="token function">p1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token comment">// 形参的初始化 Poinnt const other = p1</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment">// 触发拷贝构造的第二种调用时机</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token comment">// 会再次对 p1 进行复制</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token comment">// 这样下去会导致拷贝构造无线调用，直到栈溢出，程序崩溃</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  Point p2 <span class="token operator">=</span> p1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VXeDlRMGhQcnNSQW9FbndHWFZlX2dBQkNob1gwWS14TVpwbHh2RmwxaTZ3N2c_ZT1oaGVVRkM.png" alt="image-20240422173226120.png" /></p>
<p>为了避免这种递归调用，拷贝构造函数的参数必须使用引用：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Constructor called."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// 正确的拷贝构造函数</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point <span class="token operator">&amp;</span>other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 使用引用</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Copy constructor called."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    _x <span class="token operator">=</span> other<span class="token punctuation">.</span>_x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    _y <span class="token operator">=</span> other<span class="token punctuation">.</span>_y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="拷贝构造函数是否可以去掉-const"><a class="anchor" href="#拷贝构造函数是否可以去掉-const">#</a> 拷贝构造函数是否可以去掉  <code> const</code>  ？</h4>
<p>拷贝构造函数的标准形式是：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ClassName</span><span class="token punctuation">(</span><span class="token keyword">const</span> ClassName <span class="token operator">&amp;</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>如果我们将拷贝构造函数的参数改为非  <code>const</code>  引用，即：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">ClassName</span><span class="token punctuation">(</span>ClassName <span class="token operator">&amp;</span>other<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在这种情况下，会出现以下问题：</p>
<ol>
<li>
<p><strong>修改原对象</strong>：去掉  <code>const</code>  后，拷贝构造函数可以修改传入的对象。这在拷贝构造的上下文中是不合理的，因为我们通常希望保留原对象的状态不变。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 错误的拷贝构造函数</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">Point</span><span class="token punctuation">(</span>Point<span class="token operator">&amp;</span> other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 去掉 const</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        _x <span class="token operator">=</span> other<span class="token punctuation">.</span>_x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        _y <span class="token operator">=</span> other<span class="token punctuation">.</span>_y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">// 这里可以意外地修改 other 对象</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>无法绑定临时对象</strong>：如果拷贝构造函数的参数是非  <code>const</code>  引用，它将无法接受临时对象（右值）。例如：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer<span class="token operator">&amp;</span> rhs <span class="token operator">=</span> <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token number">12000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 错误</span></pre></td></tr></table></figure><p>这段代码会导致编译错误，因为临时对象不能绑定到非常量引用。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 可以取址的变量（对象）称为左值</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 不能取值的变量（对象）称为右值</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token comment">// （匿名的或临时的变量、对象）</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  #</pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// &amp;1; // 数是在指令系统中的，没有存在内存中</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 非 const 引用只能绑定左值，不能绑定右值</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">int</span> <span class="token operator">&amp;</span>ref <span class="token operator">=</span> num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// int &amp;ref2 = 10;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">//const 引用既能绑定左值，又能绑定右值</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>ref3 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">const</span> <span class="token keyword">int</span> <span class="token operator">&amp;</span>ref4 <span class="token operator">=</span> num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
</ol>
<h2 id="赋值运算符函数"><a class="anchor" href="#赋值运算符函数">#</a> 赋值运算符函数</h2>
<p>赋值运算同样是一种很常见的运算，比如：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>x <span class="token operator">=</span> y<span class="token punctuation">;</span></pre></td></tr></table></figure><p>自定义类型当然也需要这种运算，比如：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point <span class="token function">pt1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pt1 <span class="token operator">=</span> pt2<span class="token punctuation">;</span><span class="token comment">// 赋值操作</span></pre></td></tr></table></figure><p>在执行  <code>pt1 = pt2;</code>  该语句时，  <code>pt1</code>  与  <code>pt2</code>  都存在，所以不存在对象的构造，这要与  <code>Point pt2 = pt1;</code>  语句区分开，这是不同的。</p>
<h3 id="赋值运算符函数的形式"><a class="anchor" href="#赋值运算符函数的形式">#</a> 赋值运算符函数的形式</h3>
<p>赋值运算符函数用于定义对象之间的赋值行为。其标准形式为：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>ClassName<span class="token operator">&amp;</span> ClassName<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> ClassName<span class="token operator">&amp;</span> other<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>对 Point 类进行测试时，会发现我们不需要显式给出赋值运算符函数，就可以执行测试。这是因为如果类中没有显式定义赋值运算符函数时，编译器会自动提供一个赋值运算符函数。对于 Point 类而言，其实现如下:</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point <span class="token operator">&amp;</span> Point<span class="token double-colon punctuation">::</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point <span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  _ix <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  _iy <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>手动写出赋值运算符，再加上函数调用的提示语句。执行发现语句被输出，也就是说，<strong>当对象已经创建时，将另一个对象的内容复制给这个对象，会调用赋值运算符函数</strong>。</p>
<p>虽然赋值运算符看起来是双目运算符，需要两个对象（一个左侧对象和一个右侧对象），但实际上，左侧对象是通过隐式的  <code>this</code>  指针提供的，不需要显式传递。 <code>this</code>  指针是一个指向当前对象的指针，它在成员函数内部自动可用。</p>
<p>赋值运算符的返回类型通常是对当前对象的引用（ <code>ClassName&amp;</code> ）。这样设计的原因包括：</p>
<ol>
<li><strong>链式赋值</strong>：允许像  <code>a = b = c</code>  这样的链式赋值操作。</li>
<li><strong>避免返回值被销毁</strong>：返回对象的引用，而不是对象本身，可以避免返回值在函数结束时被销毁。</li>
</ol>
<h3 id="this-指针"><a class="anchor" href="#this-指针">#</a>  <code>this</code>  指针</h3>
<p><code>this</code>  指针的本质是一个常量指针，形式为  <code>Type* const this</code> 。它存储了调用成员函数的对象的地址，并且不可被修改。</p>
<p><code>this</code>  指针在成员函数中隐式存在，指向调用该函数的对象实例，使得成员函数能够访问和修改该对象的成员变量。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 返回类型是 Point &amp;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 函数名是 operator=</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 参数是 const Point &amp;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">//this 不能显式地在参数列表中写出</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 因为编译器一定会加入一个 this 指针作为第一个参数</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Point <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// 可以通过 this 指针修改其指向的对象的内容</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 不能修改 this 指针的指向</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 因为 this 指针是常量指针</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">this</span><span class="token operator">-></span>_is <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">this</span><span class="token operator">-></span>_iy <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_is<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 想想返回值是什么？本对象</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">// 当对象调用 print 函数时，</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment">// 编译器会自动地添加一个参数：this 指针</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">//this 指针指向当前对象（调用本成员函数的对象）</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	   <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_ix <span class="token operator">&lt;&lt;</span> <span class="token string">","</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	   <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_iy <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>编译器在生成程序时会将对象的首地址存放在寄存器中，这就是  <code>this</code>  指针的存储位置。</p>
<p><strong>生命周期</strong>：</p>
<ul>
<li><code>this</code>  指针的生命周期始于成员函数的执行开始。当一个非静态成员函数被调用时， <code>this</code>  指针会自动设置为指向调用该函数的对象实例。</li>
<li>在成员函数执行期间， <code>this</code>  指针一直有效，可以用来访问调用对象的成员变量和成员函数。</li>
<li><code>this</code>  指针的生命周期结束于成员函数的执行结束。当成员函数返回时， <code>this</code>  指针的作用范围也随之结束。</li>
</ul>
<p><strong>悬挂指针</strong>：如果成员函数通过一个已经销毁或未初始化的对象调用， <code>this</code>  指针将是悬挂的，使用它将导致未定义行为。</p>
<p><strong>对象与  <code>this</code>  指针的关系</strong>： <code>this</code>  指针的生命周期与它所指向的对象的生命周期相关，但并不完全相同。对象可能在成员函数执行前就已存在，并在执行后继续存在。</p>
<ol>
<li>
<p><strong>对象调用函数时，如何找到自己本对象的数据成员？</strong></p>
<p>通过  <code>this</code>  指针，成员函数可以访问调用对象的成员变量。</p>
</li>
<li>
<p><strong> <code>this</code>  指针代表的是什么？</strong></p>
<p><code>this</code>  指针指向当前对象，即调用成员函数的对象实例。</p>
</li>
<li>
<p><strong> <code>this</code>  指针在参数列表中的位置？</strong></p>
<p><code>this</code>  指针是参数列表的第一位，编译器自动加入，不需要手动声明。</p>
</li>
<li>
<p><strong> <code>this</code>  指针的形式是什么？</strong></p>
<p><code>this</code>  指针的形式为  <code>ClassName* const this</code> ，表示它是一个指向当前对象的常量指针。</p>
</li>
</ol>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">this</span><span class="token operator">-></span>_ix <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">this</span><span class="token operator">-></span>_iy <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point &amp; operator=(const Point &amp;)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>成员函数中可以加上  <code>this</code>  指针，展示本对象通过  <code>this</code>  指针找到本对象的数据成员。但是不要在参数列表中显式加上  <code>this</code>  指针，因为编译器一定会在参数列表的第一位加上  <code>this</code>  指针，如果显式再给一个，参数数量就不对了。</p>
<h3 id="赋值运算符函数的定义"><a class="anchor" href="#赋值运算符函数的定义">#</a> 赋值运算符函数的定义</h3>
<p>当类的成员变量中包含指针时，需要特别小心处理赋值运算符，以避免浅拷贝带来的问题，如内存泄漏和悬挂指针。</p>
<p>以 Computer 类为例，默认的赋值运算符函数长这样</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token keyword">this</span><span class="token operator">-></span>_brand <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">this</span><span class="token operator">-></span>_price <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>默认的赋值运算符进行的是浅拷贝，即直接复制指针的值，而不是指针指向的数据。这会导致多个对象尝试释放同一块内存，或一个对象的析构函数错误地释放了另一个对象正在使用的内存。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VjUUNGd194YjNGRGppa3R2MUNLZ0ljQnBQRTRfUm95dDM2ekVUT09lOUxxNlE_ZT03Ykt4N3M.png" alt="undefined202403081024442.png" /></p>
<p>为了避免这些问题，需要在赋值运算符中实现深拷贝。深拷贝意味着为新对象分配新的内存，并复制数据到这块新内存中。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VZRVVZVG91Q1JCSXNHQjhlbjBtU1FvQlhCZ1FOUXBnbzRRalBURGNDN183WWc_ZT1pQWlFZU4.png" alt="undefined202403081029700.png" /></p>
<p>在实现深拷贝之前，首先要检查自赋值，即左侧对象是否正在尝试赋值给自己。如果是自赋值，应该直接返回。</p>
<ol>
<li><strong>检查自赋值</strong>：确保不是将对象赋值给自己。</li>
<li><strong>释放原有资源</strong>：释放左侧对象已有的动态分配的资源。</li>
<li><strong>深拷贝资源</strong>：为左侧对象分配新的资源，并从右侧对象复制数据。</li>
<li><strong>返回当前对象的引用</strong>：完成赋值后返回当前对象的引用。</li>
</ol>
<p>以下是  <code>Computer</code>  类赋值运算符的一个示例，展示了如何实现这四步：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 拷贝构造函数</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer<span class="token operator">&amp;</span> other<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token operator">:</span> <span class="token function">_price</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>_price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        _brand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> other<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token comment">// 赋值运算符</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    Computer<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">!=</span> <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 检查自赋值</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span>  <span class="token comment">// 释放原有资源</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            _brand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> rhs<span class="token punctuation">.</span>_brand<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 深拷贝</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            _price <span class="token operator">=</span> rhs<span class="token punctuation">.</span>_price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>  <span class="token comment">// 返回当前对象的引用</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    Computer <span class="token function">pc1</span><span class="token punctuation">(</span><span class="token string">"Dell"</span><span class="token punctuation">,</span> <span class="token number">1200.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    Computer <span class="token function">pc2</span><span class="token punctuation">(</span><span class="token string">"HP"</span><span class="token punctuation">,</span> <span class="token number">1500.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    pc1 <span class="token operator">=</span> pc2<span class="token punctuation">;</span>  <span class="token comment">// 调用赋值运算符</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    pc1<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出: HP 1500</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="赋值运算符函数的形式探究"><a class="anchor" href="#赋值运算符函数的形式探究">#</a> 赋值运算符函数的形式探究</h3>
<ol>
<li>
<p>赋值运算符函数的返回类型必须是引用吗？</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  ……</pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>赋值运算符函数的返回类型通常应该是引用。这是因为：</p>
<p><strong>避免多余拷贝</strong>：如果返回类型不是引用，如  <code>Computer operator=(const Computer&amp; rhs)</code> ，那么在赋值操作完成后，返回的  <code>Computer</code>  对象将被销毁，而其数据需要被拷贝到调用者期望的对象中，这增加了不必要的开销。</p>
</li>
<li>
<p>赋值运算符函数的返回类型可以是  <code>void</code>  吗？</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  ……</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>链式赋值问题</strong>：如果赋值运算符函数的返回类型是  <code>void</code> ，那么将无法支持链式赋值，因为  <code>void</code>  函数不能返回一个对象用于进一步的赋值操作。</p>
</li>
<li>
<p>赋值运算符函数的参数必须是引用吗？</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer <span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer rhs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  ……</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>避免多余拷贝</strong>：如果参数不是引用，如  <code>Computer&amp; operator=(Computer rhs)</code> ，那么参数传递将触发拷贝构造函数，这增加了不必要的拷贝开销。更重要的是，这将导致无法正确处理通过值传递导致的潜在问题，如自赋值保护。</p>
</li>
<li>
<p>赋值运算符函数的参数必须是一个  <code>const</code>  引用吗？</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Computer <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span>Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	……</pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>防止修改</strong>：使用  <code>const</code>  引用作为参数，如  <code>Computer&amp; operator=(const Computer&amp; rhs)</code> ，确保了在赋值过程中不会修改右侧对象。这是非常重要的，因为它允许将临时对象（右值）作为赋值源，同时保护了原对象不被修改。</p>
<p><strong>支持右值</strong>：如果去掉  <code>const</code> ，如  <code>Computer&amp; operator=(Computer&amp; rhs)</code> ，那么将无法接受临时对象作为参数，因为临时对象不能绑定到非  <code>const</code>  引用上。</p>
</li>
</ol>
<h2 id="特殊的数据成员"><a class="anchor" href="#特殊的数据成员">#</a> 特殊的数据成员</h2>
<p>在 C++ 的类中，有 4 种比较特殊的数据成员，分别是常量成员、引用成员、类对象成员和静态成员，它们的初始化与普通数据成员有所不同。</p>
<h3 id="常量数据成员"><a class="anchor" href="#常量数据成员">#</a> 常量数据成员</h3>
<p>在 C++ 类中，使用  <code>const</code>  关键字修饰的数据成员称为常量数据成员。一旦这些成员被初始化，它们的值就不能再被修改，保证了数据的不变性。</p>
<p>由于常量数据成员在对象的生命周期内不能被修改，因此它们必须在构造函数的初始化列表中进行初始化。在 C++11 及以后的版本中，也可以在成员变量声明时直接初始化。</p>
<p>与普通  <code>const</code>  常量的区别</p>
<ul>
<li><strong>普通  <code>const</code>  常量</strong>：必须在声明时初始化，并且之后不能再被修改。</li>
<li><strong>常量数据成员</strong>：同样必须在声明时或在构造函数的初始化列表中初始化，之后也不能被修改。</li>
</ul>
<p>以下是包含常量数据成员的  <code>Point</code>  类示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 构造函数初始化列表中初始化常量数据成员</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 打印点的坐标</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> _iy <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">const</span> <span class="token keyword">int</span> _ix<span class="token punctuation">;</span> <span class="token comment">// 常量数据成员</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">const</span> <span class="token keyword">int</span> _iy<span class="token punctuation">;</span> <span class="token comment">// 常量数据成员</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: (1, 2)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">//pt._ix = 3; // 错误：不能修改常量数据成员</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token comment">//pt._iy = 4; // 错误：不能修改常量数据成员</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>注意事项：</p>
<ul>
<li><strong>初始化时机</strong>：常量数据成员必须在对象构造时初始化，不能在构造函数体内通过赋值操作进行初始化。</li>
<li><strong>类模板</strong>：如果类是模板类，所有数据成员（包括非常量数据成员）都必须在类内初始化，因为模板类在定义时不会进行实例化。</li>
<li><strong>不变性</strong>：常量数据成员提供了对象状态的不变性保证，这在多线程环境或需要确保数据不被修改的场景中非常有用。</li>
</ul>
<h3 id="引用数据成员"><a class="anchor" href="#引用数据成员">#</a> 引用数据成员</h3>
<p>引用数据成员必须在对象构造时初始化，因为引用一旦被初始化，就不能再重新绑定到另一个对象。C++11 之后，可以在声明引用数据成员时直接初始化（绑定）。</p>
<p>引用数据成员的初始化只能在构造函数的初始化列表中进行，不能在构造函数体内通过赋值操作进行初始化。</p>
<p>以下是包含引用数据成员的  <code>Point</code>  类示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> z<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iz</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token comment">// 构造函数初始化列表中初始化引用成员</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ix: "</span> <span class="token operator">&lt;&lt;</span> _ix <span class="token operator">&lt;&lt;</span> <span class="token string">", iy: "</span> <span class="token operator">&lt;&lt;</span> _iy <span class="token operator">&lt;&lt;</span> <span class="token string">", iz: "</span> <span class="token operator">&lt;&lt;</span> _iz <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">int</span> <span class="token operator">&amp;</span>_iz<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">int</span> z <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: ix: 1, iy: 2, iz: 5</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>思考：构造函数接收一个参数初始化引用成员</p>
<p>在构造函数中接收一个参数用于初始化引用成员是可行的，但这个参数必须是一个已经存在的对象的引用，且在引用成员的生命周期内始终有效。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	  <span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	  <span class="token comment">/* , _ref (z) //z 的生命周期在构造函数执行完时结束 */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	  <span class="token punctuation">,</span> <span class="token function">_ref</span><span class="token punctuation">(</span>_ix<span class="token punctuation">)</span> <span class="token comment">//_ref 和 _ix 的生命周期都是在对象销毁时结束</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">/* , _ref(gNum) //ok */</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_ix</pre></td></tr><tr><td data-num="13"></td><td><pre>		 <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_iy</pre></td></tr><tr><td data-num="14"></td><td><pre>		 <span class="token operator">&lt;&lt;</span> <span class="token string">","</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_ref</pre></td></tr><tr><td data-num="15"></td><td><pre>		 <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">// C++ 11 允许引用成员在声明时初始化</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">int</span> <span class="token operator">&amp;</span>_ref <span class="token operator">=</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>注意事项</p>
<ul>
<li><strong>生命周期</strong>：引用成员必须绑定一个在其生命周期内始终有效的对象。</li>
<li><strong>不可重新绑定</strong>：引用成员一旦被初始化，就不能再绑定到另一个对象。</li>
<li><strong>悬挂引用</strong>：如果引用成员绑定的对象先于引用成员被销毁，那么引用成员将成为悬挂引用，访问它将导致未定义行为。</li>
</ul>
<h3 id="对象成员"><a class="anchor" href="#对象成员">#</a> 对象成员</h3>
<p>当一个类的对象被用作另一个类的数据成员时，我们称之为对象成员或成员子对象。对象成员的初始化必须在初始化列表中进行。</p>
<p>对象成员的初始化遵循以下规则：</p>
<ol>
<li><strong>初始化列表</strong>：在初始化列表中，必须使用对象成员的名称进行初始化。</li>
<li><strong>不能直接创建</strong>：不能在对象成员的声明中直接使用带参数的构造函数创建对象。</li>
</ol>
<p>以下是  <code>Line</code>  类包含两个  <code>Point</code>  对象成员的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token operator">~</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Point()"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// 其他成员函数和数据成员</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Line</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token function">Line</span><span class="token punctuation">(</span><span class="token keyword">int</span> x1<span class="token punctuation">,</span> <span class="token keyword">int</span> y1<span class="token punctuation">,</span> <span class="token keyword">int</span> x2<span class="token punctuation">,</span> <span class="token keyword">int</span> y2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 如果没有在 Line 构造函数的初始化列表中</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">// 显示调用 Point 的构造函数</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 那么会自动调用 Point 的无参函数</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token operator">:</span> <span class="token function">_pt1</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 显示调用 Point 的构造函数</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token function">_pt2</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span> <span class="token comment">// 括号前依然是对象成员的名字</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Line(int,int,int,int)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token operator">~</span><span class="token function">Line</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Line()"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token comment">// 其他成员函数和数据成员</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  Point _pt1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  Point _pt2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token comment">// 创建 Line 对象会马上调用 Line 的构造函数</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token comment">// 在 Line 的构造函数执行过程中调用 Point 的构造函数</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token comment">// Line 对象要销毁，就会马上调用 Line 的析构函数</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token comment">// Line 的析构函数执行完之后，再根据对象成员声明的反序</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  <span class="token comment">// 通过成员子对象调用 Point 的析构函数</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token comment">// 此处就是 _pt2 调用析构函数，执行完后，_ptl 再调用析构函数</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  Line <span class="token function">line</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token comment">// 输出顺序：Point (int,int), Point (int,int), Line (int,int,int,int)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token comment">// 析构顺序：~Line (), ~Point (), ~Point ()</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>构造函数和析构函数的调用顺序</p>
<ul>
<li><strong>构造顺序</strong>：当创建一个包含对象成员的类的对象时，构造函数的调用顺序是从基类到派生类，从对象成员到成员变量。</li>
<li><strong>析构顺序</strong>：当销毁一个包含对象成员的类的对象时，析构函数的调用顺序与构造函数的调用顺序相反，即从成员变量到对象成员。</li>
</ul>
<p>注意事项</p>
<ul>
<li><strong>默认构造函数</strong>：如果未在初始化列表中显式初始化对象成员，编译器会调用对象成员的默认无参构造函数。</li>
<li><strong>资源管理</strong>：如果对象成员申请了堆空间，需要确保在对象成员的析构函数中释放这些资源。</li>
</ul>
<p>如果  <code>Line</code>  类中有数据成员申请堆空间， <code>Point</code>  类对象也有数据成员申请堆空间，堆空间资源的回收顺序如下</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VRbklFd1B3cnlSR2xJVEpEa29WQ3dJQmZOMlUyd2NySzZ1T3Frcm1KNVE3dXc_ZT1KRnpNdzA.png" alt="image-20240628162920344.png" /></p>
<h3 id="静态数据成员"><a class="anchor" href="#静态数据成员">#</a> 静态数据成员</h3>
<p>静态数据成员是类的一部分，但它不属于某个特定的对象实例。它在所有对象之外独立存在，并且所有对象都共享同一个静态成员。</p>
<p>特点：</p>
<ul>
<li><strong>共享性</strong>：静态数据成员被类的所有对象共享。</li>
<li><strong>存储</strong>：静态数据成员存储在全局 / 静态存储区，不占用对象的存储空间。</li>
<li><strong>初始化</strong>：必须在类外进行初始化。</li>
</ul>
<p>以下是包含静态数据成员的  <code>Computer</code>  类示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 为非静态成员变量分配内存</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    _brand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    _price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    _totalPrice <span class="token operator">+=</span> price<span class="token punctuation">;</span>  <span class="token comment">// 更新静态成员变量</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span>  <span class="token comment">// 释放内存</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Total price: "</span> <span class="token operator">&lt;&lt;</span> _totalPrice <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">char</span><span class="token operator">*</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">static</span> <span class="token keyword">double</span> _totalPrice<span class="token punctuation">;</span>  <span class="token comment">// 声明静态成员变量</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">// 初始化静态成员变量</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">double</span> Computer<span class="token double-colon punctuation">::</span>_totalPrice <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  Computer <span class="token function">pc1</span><span class="token punctuation">(</span><span class="token string">"Dell"</span><span class="token punctuation">,</span> <span class="token number">1200.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  Computer <span class="token function">pc2</span><span class="token punctuation">(</span><span class="token string">"HP"</span><span class="token punctuation">,</span> <span class="token number">1500.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 直接通过类名访问静态成员函数</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>静态成员规则</p>
<ol>
<li><strong>私有静态成员</strong>：私有的静态数据成员无法在类外部直接访问，但可以在类的成员函数内部访问。</li>
<li><strong>类外初始化</strong>：静态数据成员必须在类外初始化。</li>
<li><strong>初始化格式</strong>：初始化时，应在成员名前加上类名和作用域限定符，不需要再加  <code>static</code>  关键字。</li>
<li><strong>初始化顺序</strong>：静态成员的初始化顺序与它们在类中的声明顺序一致，与对象的创建无关。</li>
<li><strong>访问方式</strong>：静态成员可以通过对象访问，也可以直接通过类名和作用域限定符访问。</li>
</ol>
<h2 id="特殊的成员函数"><a class="anchor" href="#特殊的成员函数">#</a> 特殊的成员函数</h2>
<p>除了特殊的数据成员以外， C++ 类中还有两种特殊的成员函数：静态成员函数和 const 成员函数。</p>
<h3 id="静态成员函数"><a class="anchor" href="#静态成员函数">#</a> 静态成员函数</h3>
<p>静态成员函数是类的一部分，但它不依赖于类的具体对象实例。它可以在没有创建类的对象的情况下被调用。</p>
<p>特点：</p>
<ol>
<li><strong>不依赖于对象</strong>：静态成员函数不依赖于某个具体的对象实例。</li>
<li><strong>调用方式</strong>：可以通过对象调用，但更常见的是通过类名加上作用域限定符调用。</li>
<li><strong>无  <code>this</code>  指针</strong>：静态成员函数没有  <code>this</code>  指针，因此不能访问非静态成员。</li>
<li><strong>访问限制</strong>：只能访问静态数据成员或调用静态成员函数。</li>
</ol>
<p>以下是  <code>Computer</code>  类包含静态成员函数的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    _brand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    _totalPrice <span class="token operator">+=</span> _price<span class="token punctuation">;</span>  <span class="token comment">// 累计总价</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span>  <span class="token comment">// 释放品牌名占用的内存</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token comment">// 静态成员函数</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Total price: "</span> <span class="token operator">&lt;&lt;</span> _totalPrice <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">//std::cout &lt;&lt; _price &lt;&lt; std::endl; // 错误：无法访问非静态成员</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">char</span><span class="token operator">*</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">static</span> <span class="token keyword">double</span> _totalPrice<span class="token punctuation">;</span>  <span class="token comment">// 静态数据成员</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token keyword">double</span> Computer<span class="token double-colon punctuation">::</span>_totalPrice <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 静态成员初始化</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  Computer <span class="token function">pc1</span><span class="token punctuation">(</span><span class="token string">"Dell"</span><span class="token punctuation">,</span> <span class="token number">1200.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  Computer <span class="token function">pc2</span><span class="token punctuation">(</span><span class="token string">"HP"</span><span class="token punctuation">,</span> <span class="token number">1500.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">printTotalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 通过类名调用静态成员函数</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>注意事项：</p>
<ul>
<li><strong>构造函数、析构函数、拷贝构造函数、赋值运算符</strong>：这些特殊的成员函数不能被声明为静态，因为它们需要访问和操作对象的非静态成员。</li>
<li><strong>访问非静态成员</strong>：静态成员函数无法直接访问非静态成员，因为它们没有  <code>this</code>  指针。</li>
<li><strong>访问静态成员</strong>：静态成员函数可以访问静态数据成员和调用静态成员函数。</li>
</ul>
<h3 id="const-成员函数"><a class="anchor" href="#const-成员函数">#</a>  <code>const</code>  成员函数</h3>
<p>在 C++ 类中，成员函数可以通过在函数声明末尾添加  <code>const</code>  关键字来声明为  <code>const</code>  成员函数。这表明该成员函数不会修改类的任何成员变量（除了那些用  <code>mutable</code>  修饰的成员）。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Brand: "</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Price: "</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// ...</span></pre></td></tr><tr><td data-num="9"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">char</span><span class="token operator">*</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>特点：</p>
<ol>
<li><strong>不修改成员变量</strong>： <code>const</code>  成员函数保证不会修改对象的非  <code>mutable</code>  成员变量。</li>
<li><strong> <code>this</code>  指针</strong>：在  <code>const</code>  成员函数中， <code>this</code>  指针被类型为  <code>const ClassName* const</code> ，这意味着你不能通过  <code>this</code>  指针来修改对象的任何成员。</li>
<li><strong>重载决策</strong>： <code>const</code>  和非  <code>const</code>  成员函数可以作为重载的一部分，使得同一个函数名可以用于对象的  <code>const</code>  和非  <code>const</code>  上下文。</li>
<li><strong>常量对象调用</strong>：只有  <code>const</code>  成员函数才能在常量对象上被调用。</li>
</ol>
<p>以下是  <code>const</code>  成员函数的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment">//const 成员函数</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Brand: "</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Price: "</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">char</span><span class="token operator">*</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token keyword">const</span> Computer <span class="token function">pc</span><span class="token punctuation">(</span><span class="token string">"Dell"</span><span class="token punctuation">,</span> <span class="token number">1200.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  pc<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 正确：可以在 const 对象上调用</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token comment">//pc.modify (); // 错误：不能在 const 对象上调用非 const 成员函数</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>注意事项：</p>
<ul>
<li><strong> <code>mutable</code>  关键字</strong>：虽然  <code>const</code>  成员函数不能修改非  <code>mutable</code>  成员变量，但可以通过  <code>mutable</code>  关键字修饰的成员变量来实现一些必要的修改。</li>
<li><strong> <code>const</code>  对象</strong>： <code>const</code>  成员函数可以在  <code>const</code>  对象上调用，这对于保证对象状态不被改变是有用的。</li>
</ul>
<h2 id="对象的组织"><a class="anchor" href="#对象的组织">#</a> 对象的组织</h2>
<p>有了自己定义的类，或者使用别人定义好的类创建对象，其机制与使用内置类型创建普通变量几乎完全一致，同样可以创建  <code>const</code>  对象、创建指向对象的指针、创建对象数组，还可使用  <code>new</code> ( <code>delete</code> ) 来创建 (回收) 堆对象。</p>
<h3 id="const-对象"><a class="anchor" href="#const-对象">#</a>  <code>const</code>  对象</h3>
<p>在 C++ 中， <code>const</code>  对象是其状态（数据成员）不能被修改的对象。这意味着只有  <code>const</code>  成员函数才能在  <code>const</code>  对象上被调用。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> _y <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 非 const 成员函数</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    _x <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    _y <span class="token operator">=</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">const</span> Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 正确：const 成员函数可以在 const 对象上调用</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token comment">//pt.move (); // 错误：非 const 成员函数不能在 const 对象上调用</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>const</code>  对象与  <code>const</code>  成员函数的规则：</p>
<ol>
<li><strong>重载决策</strong>： <code>const</code>  对象只能调用  <code>const</code>  成员函数，非  <code>const</code>  对象可以调用  <code>const</code>  或非  <code>const</code>  成员函数。</li>
<li><strong>单一  <code>const</code>  函数</strong>：如果类中只有一个  <code>const</code>  成员函数，它既可以被  <code>const</code>  对象也可以被非  <code>const</code>  对象调用。</li>
<li><strong>单一非  <code>const</code>  函数</strong>：如果类中只有一个非  <code>const</code>  成员函数，它不能被  <code>const</code>  对象调用。</li>
</ol>
<blockquote>
<p>一个类中可以有参数形式 “完全相同” 的两个成员函数（const 版本与非 const 版本），既然没有报错重定义，那么它们必然是构成了重载，为什么它们能构成重载呢？</p>
<p>即使两个成员函数的参数类型完全相同，它们也可以通过  <code>this</code>  指针的  <code>const</code>  性质来构成重载。 <code>const</code>  成员函数的  <code>this</code>  指针是  <code>const</code>  的，而非  <code>const</code>  成员函数的  <code>this</code>  指针不是  <code>const</code>  的。</p>
</blockquote>
<blockquote>
<p><code>const</code>  成员函数中不允许修改数据成员， <code>const</code>  数据成员初始化后不允许修改，其效果是否相同？</p>
<p><strong> <code>const</code>  数据成员与  <code>const</code>  成员函数</strong>：</p>
<ul>
<li>
<p><strong> <code>const</code>  数据成员</strong>：一旦初始化后就不能再被修改。</p>
</li>
<li>
<p><strong> <code>const</code>  成员函数</strong>：不能修改对象的非  <code>mutable</code>  数据成员。</p>
</li>
</ul>
<p>对于指针类型的数据成员，在  <code>const</code>  成员函数中的限制如下：</p>
<ul>
<li>
<p><strong> <code>const int* p</code> </strong>：不能通过  <code>p</code>  修改指向的值，也不能让  <code>p</code>  指向别的地址（即不能修改  <code>p</code>  的值）。</p>
</li>
<li>
<p><strong> <code>int* p</code> </strong>：在  <code>const</code>  成员函数中，不能让  <code>p</code>  指向别的地址，但可以修改  <code>p</code>  指向的值。</p>
</li>
</ul>
</blockquote>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_pX</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_pY</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>_y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">//const 成员函数</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>_pX <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>_pY <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// *_pX = 10; // 错误：不能修改指向的值</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">//_pX = &amp;_y;   // 错误：不能修改指针的指向</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">// 非 const 成员函数</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token operator">*</span>_pX <span class="token operator">=</span> x<span class="token punctuation">;</span>  <span class="token comment">// 正确：可以修改指向的值</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    _pX <span class="token operator">=</span> <span class="token operator">&amp;</span>_y<span class="token punctuation">;</span> <span class="token comment">// 正确：可以修改指针的指向</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">int</span><span class="token operator">*</span> _pX<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">int</span><span class="token operator">*</span> _pY<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">const</span> Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 正确：const 成员函数可以在 const 对象上调用</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token comment">//pt.move (); // 错误：非 const 成员函数不能在 const 对象上调用</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="指向对象的指针"><a class="anchor" href="#指向对象的指针">#</a> 指向对象的指针</h3>
<p>在 C++ 中，通过指向对象的指针来调用对象的成员函数是一个常见的操作。使用指针调用成员函数时，可以使用两种常见的语法： <code>-&gt;</code>  操作符和  <code>*</code>  操作符。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> _y <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  Point <span class="token function">pt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  Point <span class="token operator">*</span>p1 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  Point <span class="token operator">*</span>p2 <span class="token operator">=</span> <span class="token operator">&amp;</span>pt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  Point <span class="token operator">*</span>p3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>p1 <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"p1 is null\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    p1<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 尝试调用，但 p1 是 nullptr，这里会导致运行时错误</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>  p2<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 正确调用</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token punctuation">(</span><span class="token operator">*</span>p2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 等价的调用方式</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token keyword">delete</span> p3<span class="token punctuation">;</span>  <span class="token comment">// 清理动态分配的内存</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>指针调用成员函数的两种方式</p>
<ol>
<li>
<p><strong>使用  <code>-&gt;</code>  操作符</strong>：</p>
<ul>
<li>这是最常用的方式，直接使用  <code>-&gt;</code>  操作符来访问指针指向的对象的成员。</li>
<li>示例： <code>p2-&gt;print();</code></li>
</ul>
</li>
<li>
<p><strong>使用解引用操作符  <code>*</code> </strong>：</p>
<ul>
<li>先解引用指针，然后使用  <code>.</code>  操作符访问成员。</li>
<li>示例： <code>(*p2).print();</code></li>
</ul>
</li>
</ol>
<h3 id="对象数组"><a class="anchor" href="#对象数组">#</a> 对象数组</h3>
<p>对象数组的声明和初始化与普通数组类似，但每个数组元素都是类的对象。对象数组可以在声明时初始化，也可以稍后初始化。</p>
<p>声明对象数组：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point pts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 声明一个包含两个 Point 对象的数组</span></pre></td></tr></table></figure><p>在这种情况下，如果类有默认构造函数，将调用默认构造函数来初始化数组的每个元素。</p>
<p>初始化对象数组可以在声明数组时初始化数组元素：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point pts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// 使用构造函数初始化数组元素</span></pre></td></tr></table></figure><p>如果数组的初始化元素少于数组的大小，剩余的元素将使用默认构造函数进行初始化。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point pts<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// 剩余的元素使用默认构造函数初始化</span></pre></td></tr></table></figure><p>使用对象数组可以通过下标操作符  <code>[]</code>  来访问数组中的元素，并调用其成员函数：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>pts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用数组第一个元素的 print 函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用数组第二个元素的 print 函数</span></pre></td></tr></table></figure><p>也可以使用指针运算来访问数组元素：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>pts<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 等同于 pts [0].print ()</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span>pts <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 等同于 pts [1].print ()</span></pre></td></tr></table></figure><p>以下是使用对象数组的完整示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> _y <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  Point pts<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化前两个元素，第三个使用默认构造函数</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  pts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出: (1, 2)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  pts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出: (3, 4)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  pts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出: (0, 0)，因为第三个元素只进行了默认构造</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">// 使用指针访问</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  pts<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出: (1, 2)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">(</span><span class="token operator">&amp;</span>pts<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出: (0, 0)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>注意事项：</p>
<ul>
<li><strong>默认构造函数</strong>：如果类没有默认构造函数，那么在声明数组时必须提供足够的构造参数来初始化每个元素。</li>
<li><strong>数组大小</strong>：在初始化数组时，如果初始化器的数量少于数组的大小，剩余的元素将使用默认构造函数进行初始化。</li>
<li><strong>访问方式</strong>：可以通过下标或指针运算来访问数组元素。</li>
</ul>
<h3 id="堆对象"><a class="anchor" href="#堆对象">#</a> 堆对象</h3>
<p>在 C++ 中，使用  <code>new</code>  和  <code>delete</code>  操作符可以在堆（动态存储区）上分配和释放对象的内存。这种方式提供了更大的灵活性，特别是在对象大小未知或需要动态管理内存时。</p>
<p>单个对象的动态分配：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point <span class="token operator">*</span>pt1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 动态分配一个 Point 对象</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pt1<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 调用对象的成员函数</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">delete</span> pt1<span class="token punctuation">;</span>                     <span class="token comment">// 释放分配的内存</span></pre></td></tr><tr><td data-num="4"></td><td><pre>pt1 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>                  <span class="token comment">// 将指针置为 nullptr，防止悬挂指针</span></pre></td></tr></table></figure><p>对象数组的动态分配：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>Point <span class="token operator">*</span>pt2 <span class="token operator">=</span> <span class="token keyword">new</span> Point<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 动态分配一个包含 5 个 Point 对象的数组</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pt2<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 调用数组第一个对象的成员函数</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span>pt2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 调用数组第二个对象的成员函数</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">delete</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> pt2<span class="token punctuation">;</span>             <span class="token comment">// 释放分配的内存</span></pre></td></tr><tr><td data-num="5"></td><td><pre>pt2 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>             <span class="token comment">// 将指针置为 nullptr，防止悬挂指针</span></pre></td></tr></table></figure><p>注意事项：</p>
<ol>
<li><strong>匹配  <code>new</code>  和  <code>delete</code> </strong>：使用  <code>new</code>  分配的单个对象应该用  <code>delete</code>  释放，使用  <code>new[]</code>  分配的对象数组应该用  <code>delete[]</code>  释放。</li>
<li><strong>空指针检查</strong>：在释放内存后，应将指针置为  <code>nullptr</code> ，以避免悬挂指针问题。</li>
<li><strong>构造函数和析构函数</strong>：动态分配的对象在分配时会调用构造函数，在释放时会调用析构函数。</li>
</ol>
<p>以下是使用堆对象的完整示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_x</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_y</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _x <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> _y <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token keyword">int</span> _x<span class="token punctuation">,</span> _y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  Point <span class="token operator">*</span>pt1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 动态分配一个 Point 对象</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  pt1<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 输出: (11, 12)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token keyword">delete</span> pt1<span class="token punctuation">;</span>                     <span class="token comment">// 释放分配的内存</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  pt1 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>                  <span class="token comment">// 将指针置为 nullptr</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  Point <span class="token operator">*</span>pt2 <span class="token operator">=</span> <span class="token keyword">new</span> Point<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>      <span class="token comment">// 动态分配一个包含 5 个 Point 对象的数组</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  pt2<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// 输出: (0, 0)，使用默认构造函数</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token punctuation">(</span>pt2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 输出: (0, 0)，使用默认构造函数</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pt2<span class="token punctuation">;</span>                  <span class="token comment">// 释放分配的内存</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  pt2 <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>                  <span class="token comment">// 将指针置为 nullptr</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="newdelete-表达式的工作步骤"><a class="anchor" href="#newdelete-表达式的工作步骤">#</a> new/delete 表达式的工作步骤</h2>
<h3 id="new-表达式的三个工作步骤"><a class="anchor" href="#new-表达式的三个工作步骤">#</a>  <code>new</code>  表达式的三个工作步骤</h3>
<p>当在 C++ 中使用  <code>new</code>  表达式来创建一个自定义类型的对象时，会发生以下三个步骤：</p>
<ol>
<li><strong>申请未类型化的空间</strong>：
<ul>
<li>首先，调用  <code>operator new</code>  函数来分配足够的未初始化内存以存储对象。这个函数是标准库的一部分，它返回一个指向分配的内存的指针，该内存的大小足以容纳对象，但不包含对象的构造。</li>
<li><code>operator new</code>  通常接受所需内存的大小（以字节为单位）作为参数，并返回一个  <code>void*</code>  类型的指针。</li>
</ul>
</li>
<li><strong>调用构造函数初始化对象</strong>：
<ul>
<li>一旦内存被分配，就会在这块内存上调用对象的构造函数来初始化对象。构造函数会根据其参数（如果有的话）来初始化对象的成员变量。</li>
<li>这个步骤实际上是对象的构造过程，它确保对象在被使用前处于正确和一致的状态。</li>
</ul>
</li>
<li><strong>返回指向对象的指针</strong>：
<ul>
<li>构造函数调用完成后， <code>new</code>  表达式会返回一个指向新创建并初始化的对象的指针。</li>
<li>这个指针是类型安全的，即它的类型与被创建的对象的类型相匹配。</li>
</ul>
</li>
</ol>
<h3 id="delete-表达式的两个工作步骤"><a class="anchor" href="#delete-表达式的两个工作步骤">#</a>  <code>delete</code>  表达式的两个工作步骤</h3>
<p>当在 C++ 中使用  <code>delete</code>  表达式来释放一个自定义类型的对象时，会发生以下两个步骤：</p>
<ol>
<li>
<p><strong>调用析构函数</strong>：</p>
<ul>
<li>首先，调用对象的析构函数来释放对象所占用的资源，包括动态分配的内存（堆空间）。</li>
<li>析构函数负责执行任何必要的清理工作，以确保对象被销毁时不会留下未释放的资源。</li>
</ul>
</li>
<li>
<p><strong>回收对象所在的空间</strong>：</p>
<ul>
<li>析构函数调用完成后， <code>delete</code>  表达式会调用  <code>operator delete</code>  来释放对象所在的内存空间。</li>
<li><code>operator delete</code>  是一个标准库函数，它通常与  <code>operator new</code>  配对使用，用于释放之前通过  <code>new</code>  分配的内存。</li>
</ul>
</li>
</ol>
<p>以下是使用  <code>delete</code>  表达式释放对象的完整示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Student</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token operator">:</span> <span class="token function">_id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_name</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token function">strcpy</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Student constructor called.\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token operator">~</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Student() called.\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>      _name <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">void</span> <span class="token operator">*</span><span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size_t sz<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"operator new called.\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">void</span> <span class="token operator">*</span>ret <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>sz<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">return</span> ret<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>pointer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"operator delete called.\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token function">free</span><span class="token punctuation">(</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ID: "</span> <span class="token operator">&lt;&lt;</span> _id <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="33"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">"Name: "</span> <span class="token operator">&lt;&lt;</span> _name <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token keyword">int</span> _id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  Student <span class="token operator">*</span>stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"Jackie"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  stu<span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  <span class="token keyword">delete</span> stu<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出结果：</p>
<pre><code>Student constructor called.
operator new called.
ID: 100
Name: Jackie
~Student() called.
operator delete called.
</code></pre>
<p>注意事项</p>
<ul>
<li><strong>匹配  <code>new</code>  和  <code>delete</code> </strong>：使用  <code>new</code>  分配的对象应该使用  <code>delete</code>  来释放，使用  <code>new[]</code>  分配的对象数组应该使用  <code>delete[]</code>  来释放。</li>
<li><strong>自定义内存管理</strong>：可以为类自定义  <code>operator new</code>  和  <code>operator delete</code> ，以实现特定的内存管理策略。</li>
<li><strong>析构函数</strong>：析构函数负责释放对象持有的资源，并执行清理工作。</li>
</ul>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0ViYWNVOUlMUFE1S3F5YUpmRmoyaE5FQkI2VVo0MnJUOWhUX3Z4QW5pMmREY2c_ZT1QUmZNTUc.png" alt="image-20240517173347739.png" /></p>
<h3 id="创建对象的条件"><a class="anchor" href="#创建对象的条件">#</a> 创建对象的条件</h3>
<p>在 C++ 中，创建对象（无论是栈对象还是堆对象）需要满足特定的条件。</p>
<h4 id="创建堆对象的条件"><a class="anchor" href="#创建堆对象的条件">#</a> 创建堆对象的条件</h4>
<p>为了能够创建堆对象，类需要满足以下条件：</p>
<ol>
<li><strong>公有的  <code>operator new</code> </strong>：必须能够访问类的  <code>operator new</code>  函数来分配内存。如果这个函数是私有的，那么无法在类外部使用  <code>new</code>  表达式来创建对象。</li>
<li><strong>公有的  <code>operator delete</code> </strong>：必须能够访问类的  <code>operator delete</code>  函数来释放内存。如果这个函数是私有的，那么无法在类外部使用  <code>delete</code>  表达式来释放对象。</li>
<li><strong>可访问的构造函数</strong>：必须有一个可访问的构造函数来初始化对象。</li>
<li><strong>析构函数</strong>：析构函数在销毁对象时被调用，无论它是公有的还是私有的。</li>
</ol>
<h4 id="创建栈对象的条件"><a class="anchor" href="#创建栈对象的条件">#</a> 创建栈对象的条件</h4>
<p>为了能够创建栈对象，类需要满足以下条件：</p>
<ol>
<li><strong>可访问的构造函数</strong>：必须有一个可访问的构造函数来初始化对象。</li>
<li><strong>可访问的析构函数</strong>：析构函数在对象生命周期结束时被调用，必须能够访问。</li>
</ol>
<p>示例代码</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Student</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token function">Student</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_id</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    _name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token operator">~</span><span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Student() called.\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token comment">// 禁止生成堆对象</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">operator</span> <span class="token keyword">new</span><span class="token punctuation">(</span>size_t<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token keyword">void</span> <span class="token keyword">operator</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token comment">// 禁止生成栈对象</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">// ~Student () = delete; // 将析构函数设为删除，禁止生成栈对象</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"ID: "</span> <span class="token operator">&lt;&lt;</span> _id <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token operator">&lt;&lt;</span> <span class="token string">"Name: "</span> <span class="token operator">&lt;&lt;</span> _name <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">int</span> _id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token keyword">char</span><span class="token operator">*</span> _name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  Student <span class="token function">s1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Jackie"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 栈对象</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  s1<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token comment">// Student* s2 = new Student (2, "Tom"); // 错误：禁止生成堆对象</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token comment">// delete s2;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>总结：</p>
<ul>
<li><strong>创建堆对象</strong>：需要公有的  <code>operator new</code>  和  <code>operator delete</code> ，以及可访问的构造函数。</li>
<li><strong>创建栈对象</strong>：需要可访问的构造函数和析构函数。</li>
<li><strong>限制条件</strong>：可以通过将  <code>operator new</code> 、 <code>operator delete</code>  或析构函数设为私有或删除来限制对象的创建方式。</li>
<li><strong>默认行为</strong>：通常情况下，不需要特别定义  <code>operator new</code>  和  <code>operator delete</code> ，使用默认行为即可。</li>
</ul>
<h2 id="单例模式"><a class="anchor" href="#单例模式">#</a> 单例模式</h2>
<p>单例模式是 23 种常用设计模式中最简单的设计模式之一，它提供了一种创建对象的方式，确保只有单个对象被创建。这个设计模式主要目的是想在整个系统中只能出现类的一个实例，即一个类只有一个对象。</p>
<h3 id="将单例对象创建在静态区"><a class="anchor" href="#将单例对象创建在静态区">#</a> 将单例对象创建在静态区</h3>
<p>单例模式确保一个类只有一个实例，并提供一个全局访问点。在 C++ 中，可以通过以下步骤实现单例模式：</p>
<ol>
<li><strong>私有构造函数</strong>：将构造函数声明为私有，防止外部通过构造函数创建对象。</li>
<li><strong>静态成员函数</strong>：提供一个公有的静态成员函数，用于获取类的唯一实例。</li>
<li><strong>局部静态对象</strong>：在静态成员函数中创建一个局部静态对象，利用静态局部变量的生命周期和初始化特性保证对象的唯一性和线程安全。</li>
<li><strong>返回引用</strong>：静态成员函数返回类实例的引用，避免对象的不必要复制。</li>
</ol>
<p>以下是使用静态存储区实现单例模式的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 禁止外部通过 new 创建对象</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">static</span> Point<span class="token operator">&amp;</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token comment">// 当静态函数多次被调用</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 静态的局部对象只会被初始化一次</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 第一次调用时，静态对象会被初始化为一个对象实例</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token comment">// 后续的调用中，静态局部对象已经存在，不会再初始化</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 而是直接返回已经初始化的对象实例</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">static</span> Point <span class="token function">instance</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 局部静态对象</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">return</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> _ix <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> _iy <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">// 私有构造函数</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  Point<span class="token operator">&amp;</span> pt <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  pt<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>  Point<span class="token operator">&amp;</span> pt2 <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  pt2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">&amp;</span>pt <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">&amp;</span>pt2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出：</p>
<pre><code>Point(int,int)
(1, 2)
(1, 2)
0x7ffeedf6e9c0
0x7ffeedf6e9c0
</code></pre>
<p>注意事项：</p>
<ul>
<li><strong>内存压力</strong>：如果单例对象占用大量内存，可能会对静态存储区造成压力。在这种情况下，可以考虑使用其他方法，如动态内存分配。</li>
<li><strong>线程安全</strong>：示例中的实现在 C++11 及更高版本中是线程安全的，因为局部静态变量的初始化是线程安全的。</li>
<li><strong>销毁时机</strong>：静态存储区的对象在程序结束时销毁，可能需要手动管理资源释放。</li>
</ul>
<h3 id="将单例对象创建在堆区"><a class="anchor" href="#将单例对象创建在堆区">#</a> 将单例对象创建在堆区</h3>
<ol>
<li><strong>私有构造函数</strong>：确保不能在类外部直接创建对象。</li>
<li><strong>静态成员函数  <code>getInstance</code> </strong>：负责创建和管理单例对象的生命周期，返回指向单例对象的指针。</li>
<li><strong>静态成员函数  <code>releaseInstance</code> </strong>：负责释放单例对象占用的内存。</li>
<li><strong>私有析构函数</strong>：确保对象不能在类外部被销毁。</li>
<li><strong>删除拷贝构造函数和赋值运算符</strong>：确保单例对象不能被复制。</li>
</ol>
<p>示例代码：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 获取单例对象的引用</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">static</span> Point <span class="token operator">*</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> _instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">// 释放单例对象</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">delete</span> _instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    _instance <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    _ix <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    _iy <span class="token operator">=</span> y<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"("</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_ix <span class="token operator">&lt;&lt;</span> <span class="token string">", "</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-></span>_iy <span class="token operator">&lt;&lt;</span> <span class="token string">")"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token comment">// 私有构造函数</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">_ix</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token comment">// 私有析构函数</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  <span class="token operator">~</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Point()"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token comment">// 删除拷贝构造函数和赋值运算符</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  <span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  Point <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token keyword">int</span> _ix<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token keyword">int</span> _iy<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>  <span class="token comment">// 单例对象指针</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token keyword">static</span> Point <span class="token operator">*</span>_instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>Point <span class="token operator">*</span>Point<span class="token double-colon punctuation">::</span>_instance <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>  <span class="token comment">// 规范用法</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">83</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>  <span class="token comment">// 即使多次调用 destroy 函数也不会有 double free</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>  <span class="token class-name">Point</span><span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出：</p>
<pre><code>Point(int,int)
(21, 83)
(2, 8)
~Point()
</code></pre>
<p>注意事项：</p>
<ul>
<li><strong>内存管理</strong>：确保在程序适当的位置调用  <code>releaseInstance</code>  以释放单例对象占用的内存，避免内存泄漏。</li>
<li><strong>线程安全</strong>：在多线程环境中，需要添加额外的同步机制来确保  <code>getInstance</code>  的线程安全。</li>
<li><strong>对象复制</strong>：通过删除拷贝构造函数和赋值运算符，确保单例对象不能被复制。</li>
</ul>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VSa3F4UjRjVmxSR3FnZUxneEx3VWdRQjVWMVJtNldQTklpbldtc1VJLVhMU0E_ZT0yYU9nTjM.png" alt="undefined202403081817230.png" /></p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VXbXBWcGx6emk5R2gzZkN6ZkpkcG9jQnpPVFhtMFViaHFNdk9ETjFmTEJFZ3c_ZT1RZzdDeFQ.png" alt="image-20240423175410103.png" /></p>
<h3 id="单例对象的数据成员申请堆空间"><a class="anchor" href="#单例对象的数据成员申请堆空间">#</a> 单例对象的数据成员申请堆空间</h3>
<ol>
<li><strong>私有构造函数和析构函数</strong>：防止外部构造和销毁对象。</li>
<li><strong>静态实例指针</strong>：用于持有单例对象。</li>
<li><strong>getInstance 方法</strong>：用于获取单例对象的引用，如果对象不存在则创建它。</li>
<li><strong>destroy 方法</strong>：用于手动销毁单例对象，释放资源。</li>
</ol>
<p>执行  <code>destroy</code>  函数的回收顺序</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VSZEE5bl9PRDFWUG1UMWpEeXRTQ0JVQmFCUE5zWEd5Vy0wNVlWMm0tOU42dmc_ZT1hMmdUbW8.png" alt="image-20240518113329654.png" /> 要注意  <code>init</code>  函数中也需要考虑回收  <code>_brand</code>  原本管理的堆空间</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0Vhcll0b1lDZGxGQ21JNnFDeUctY2FNQmdyY1V2WmNJTnNnR1NwZXBVaDhnV2c_ZT04SXF1bHU.png" alt="image-20240518114114806.png" /></p>
<p>示例代码</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstring></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>cout<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">using</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre> <span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token keyword">static</span> Computer <span class="token operator">*</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _pInstance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      _pInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token string">"huawei"</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> _pInstance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_pInstance<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token keyword">delete</span> _pInstance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>      _pInstance <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      cout <span class="token operator">&lt;&lt;</span> <span class="token string">">> delete heap"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">/* release(); */</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    _brand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    _price <span class="token operator">=</span> price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"brand:"</span> <span class="token operator">&lt;&lt;</span> _brand <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"price:"</span> <span class="token operator">&lt;&lt;</span> _price <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre> <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>brand<span class="token punctuation">,</span> <span class="token keyword">double</span> price<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token operator">:</span> <span class="token function">_brand</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_price</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Computer(const char *,double)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token function">strcpy</span><span class="token punctuation">(</span>_brand<span class="token punctuation">,</span> brand<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token operator">~</span><span class="token function">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Computer()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre>  <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_brand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>      <span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> _brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>      _brand <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token function">Computer</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  Computer <span class="token operator">&amp;</span><span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Computer <span class="token operator">&amp;</span>rhs<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  <span class="token keyword">char</span> <span class="token operator">*</span>_brand<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>  <span class="token keyword">double</span> _price<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token keyword">static</span> Computer <span class="token operator">*</span>_pInstance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>Computer <span class="token operator">*</span>Computer<span class="token double-colon punctuation">::</span>_pInstance <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>  <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">"xiaomi"</span><span class="token punctuation">,</span> <span class="token number">6000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>  <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>  <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token number">18000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>  <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>  <span class="token class-name">Computer</span><span class="token double-colon punctuation">::</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出</p>
<pre><code>Computer(const char *,double)
brand:xiaomi
price:6000
brand:apple
price:18000
~Computer()
&gt;&gt; delete heap
</code></pre>
<p>注意事项</p>
<ul>
<li><strong>资源管理</strong>：在  <code>init</code>  方法中，确保在分配新的堆空间前释放已有的资源，避免内存泄漏。</li>
<li><strong>销毁顺序</strong>：在  <code>destroy</code>  方法中，确保先释放对象占用的资源，然后销毁对象本身。</li>
<li><strong>线程安全</strong>：在多线程环境中，需要添加锁来保证  <code>getInstance</code>  和  <code>destroy</code>  方法的线程安全性。</li>
</ul>
<h3 id="单例模式的应用场景"><a class="anchor" href="#单例模式的应用场景">#</a> 单例模式的应用场景</h3>
<ol>
<li><strong>频繁实例化和销毁</strong>：当对象的创建和销毁成本较高，且在程序中需要多次使用时，单例模式可以避免重复创建和销毁的开销。</li>
<li><strong>资源密集型对象</strong>：对于初始化需要大量资源的对象，如加载大型数据集或初始化复杂计算环境，单例模式可以确保这些资源只被加载一次。</li>
<li><strong>全局资源管理</strong>：对于那些本质上就应该是唯一的资源，如配置文件、日志记录器、网络连接等，单例模式提供了一种简单有效的管理方式。</li>
<li><strong>配置文件管理</strong>：配置文件通常包含程序运行所需的设置，使用单例模式可以确保配置的一致性和同步访问。</li>
<li><strong>线程池管理</strong>：在多线程程序中，线程池用于管理和复用线程，减少创建和销毁线程的开销。单例模式确保整个程序中只有一个线程池实例。</li>
<li><strong>GUI 应用程序中的全局状态管理</strong>：GUI 程序中经常需要管理用户会话、应用设置等全局状态。单例模式可以确保这些状态的一致性和可访问性。</li>
</ol>
<h2 id="c-字符串"><a class="anchor" href="#c-字符串">#</a> C++ 字符串</h2>
<p>字符串处理在程序中应用广泛， C 风格字符串是以  <code>'\0'</code>  （空字符）来结尾的字符数组，在 C++ 中通常用  <code>const char *</code>  表示，用  <code>&quot;&quot;</code>  包括的认为是 C 风格字符串。</p>
<p>对字符串进行操作的 C 函数定义在头文件  <code>&lt;string.h&gt;</code>  或  <code>&lt;cstring&gt;</code>  中。常用的函数如下：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 字符检查函数 (非修改式操作)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 返回 str 的长度，不包括 null 结束符</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 比较 lhs 和 rhs 是否相同。lhs 等于 rhs, 返回 0; lhs 大于 rhs，返回正数；lhs 小于 rhs，返回负数</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>rhs<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">int</span> <span class="token function">strncmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>rhs<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">// 在 str 中查找首次出现 ch 字符的位置；查找不到，返回空指针</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strchr</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">// 在 str 中查找首次出现子串 substr 的位置；查找不到，返回空指针</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> substr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 字符控制函数 (修改式操作)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strcpy</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将 src 复制给 dest，返回 dest</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strncpy</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//concatenates two strings</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">strncat</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>在使用时，程序员需要考虑字符数组大小的开辟，结尾空字符的处理，使用起来有诸多不便。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">char</span> str<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"hello,"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span> pstr <span class="token operator">=</span> <span class="token string">"world"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment">// 求取字符串长度</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token comment">// 字符串拼接</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span> ptmp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>pstr<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token function">strcpy</span><span class="token punctuation">(</span>ptmp<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token function">strcat</span><span class="token punctuation">(</span>ptmp<span class="token punctuation">,</span> pstr<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> ptmp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token comment">// 查找子串</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">char</span> <span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span>ptmp<span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token function">free</span><span class="token punctuation">(</span>ptmp<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>std::string</code>  是 C++ 标准库中的一个类，用于处理字符串。它定义在头文件  <code>&lt;string&gt;</code>  中，提供了一种安全、方便的字符串操作方式，与 C 风格的字符串相比，具有很多优点。</p>
<p><code>std::string</code>  的特点：</p>
<ol>
<li><strong>自动内存管理</strong>： <code>std::string</code>  自动管理内存，无需担心内存分配和释放。</li>
<li><strong>异常安全</strong>： <code>std::string</code>  的操作通常是异常安全的，即使在抛出异常的情况下，也不会导致内存泄漏。</li>
<li><strong>功能丰富</strong>：提供了大量的成员函数，可以方便地进行字符串的各种操作，如连接、比较、查找、替换等。</li>
<li><strong>类型安全</strong>：避免了 C 风格字符串的类型不安全问题。`</li>
</ol>
<p><code>std::string</code>  实际上是  <code>std::basic_string&lt;char&gt;</code>  的别名，后者是一个模板类，可以用于创建不同字符类型的字符串（如  <code>wchar_t</code>  用于宽字符字符串）。 <code>std::string</code>  专门用于处理以  <code>char</code>  为元素的字符串。</p>
<h3 id="stdstring-的构造"><a class="anchor" href="#stdstring-的构造">#</a>  <code>std::string</code>  的构造</h3>
<p><code>basic_string</code>  的常用构造</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">basic_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 无参构造</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">basic_string</span><span class="token punctuation">(</span> size_type count<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>              CharT ch，</pre></td></tr><tr><td data-num="5"></td><td><pre>              <span class="token keyword">const</span> Allocator<span class="token operator">&amp;</span> alloc <span class="token operator">=</span> <span class="token function">Allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//count + 字符</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token function">basic_string</span><span class="token punctuation">(</span> <span class="token keyword">const</span> basic_string<span class="token operator">&amp;</span> other<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>              size_type pos<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>              size_type count<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>              <span class="token keyword">const</span> Allocator<span class="token operator">&amp;</span> alloc <span class="token operator">=</span> <span class="token function">Allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接收一个 basic_string 对象</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token function">basic_string</span><span class="token punctuation">(</span> <span class="token keyword">const</span> CharT<span class="token operator">*</span> s<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>              size_type count<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>              <span class="token keyword">const</span> Allocator<span class="token operator">&amp;</span> alloc <span class="token operator">=</span> <span class="token function">Allocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 接收一个 C 风格字符串</span></pre></td></tr></table></figure><p><code>basic_string</code>  是一个模板类，它是  <code>std::string</code>  的基类。</p>
<p>在创建字符串对象时，我们可以直接使用  <code>std::string</code>  作为类名，如  <code>std::string str = &quot;hello&quot;</code> . 这是因为 C++ 标准库已经为我们定义了  <code>std:: string</code>  这个类型的别名。</p>
<p><code>std::string</code>  类提供了多种构造函数，使得在不同场景下创建字符串对象变得非常方便。</p>
<ol>
<li>
<p><strong>无参构造函数</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>创建一个空的字符串。</p>
</li>
<li>
<p><strong>重复字符构造函数</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>size_t count<span class="token punctuation">,</span> <span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>创建一个字符串，包含指定数量的重复字符。</p>
</li>
<li>
<p><strong>从 C 风格字符串构造</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>从 C 风格字符串创建一个  <code>std::string</code>  对象。第二个版本只使用字符串的前  <code>count</code>  个字符。</p>
</li>
<li>
<p><strong>拷贝构造函数</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>使用另一个  <code>std::string</code>  对象来初始化新对象。</p>
</li>
<li>
<p><strong>子字符串构造</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> size_t pos<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>从另一个  <code>std::string</code>  对象的指定位置开始，提取指定数量的字符创建新字符串。</p>
</li>
<li>
<p><strong>从迭代器范围构造</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>iterator first<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>iterator last<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>从给定的迭代器范围  <code>[first, last)</code>  创建字符串。</p>
</li>
</ol>
<p>以下是使用  <code>std::string</code>  的构造函数的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 无参构造</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string str1<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token comment">// 从 C 风格字符串构造</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string <span class="token function">str2</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// 从 C 风格字符串的子串构造</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string <span class="token function">str3</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "World"</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment">// 重复字符构造</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string <span class="token function">str4</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "AAAAAAAAAA"</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token comment">// 拷贝构造</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string str5 <span class="token operator">=</span> str2<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token comment">// 子字符串构造</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string str6 <span class="token operator">=</span> str2<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Hello"</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token comment">// 拼接构造</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string str7 <span class="token operator">=</span> str5 <span class="token operator">+</span> <span class="token string">", "</span> <span class="token operator">+</span> str3<span class="token punctuation">;</span> <span class="token comment">// "Hello, World"</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token comment">// 迭代器构造</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token keyword">char</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string <span class="token function">str8</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> arr <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token comment">//begin () 函数返回首迭代器</span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token comment">//end () 函数返回尾迭代器</span></pre></td></tr><tr><td data-num="31"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>iterator it1 <span class="token operator">=</span> str8<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token keyword">auto</span> it2 <span class="token operator">=</span> str8<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string <span class="token function">str9</span><span class="token punctuation">(</span>it1<span class="token punctuation">,</span> <span class="token operator">--</span>it2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token comment">// 打印所有字符串</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str1 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// ""</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "Hello"</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "World"</span></pre></td></tr><tr><td data-num="39"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str4 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "AAAAAAAAAA"</span></pre></td></tr><tr><td data-num="40"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str5 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "Hello"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str6 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "Hello"</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str7 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "Hello, World"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str8 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "Hello"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str9 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token comment">// "Hell"</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="stdstring-的常用操作"><a class="anchor" href="#stdstring-的常用操作">#</a>  <code>std::string</code>  的常用操作</h3>
<p><code>std::string</code>  提供了丰富的成员函数，用于执行各种字符串操作。</p>
<ol>
<li>
<p><strong>获取字符串数据</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span> <span class="token comment">// 获取出 C++ 字符串保存的字符串内容，以 C 风格字符串作为返回值</span></pre></td></tr></table></figure><ul>
<li><code>data()</code>  返回一个指向字符串数据的指针，不以空字符终止。</li>
<li><code>c_str()</code>  返回一个以空字符终止的 C 风格字符串。</li>
</ul>
</li>
<li>
<p><strong>判断字符串是否为空</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span> <span class="token comment">// 判空</span></pre></td></tr></table></figure></li>
<li>
<p><strong>获取字符串长度</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>size_type <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span> <span class="token comment">// 获取字符数</span></pre></td></tr><tr><td data-num="2"></td><td><pre>size_type <span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>追加字符或字符串</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>basic_string <span class="token operator">&amp;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> basic_string <span class="token operator">&amp;</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加字符串</span></pre></td></tr><tr><td data-num="3"></td><td><pre>basic_string <span class="token operator">&amp;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加 C 风格字符串</span></pre></td></tr><tr><td data-num="4"></td><td><pre>basic_string <span class="token operator">&amp;</span><span class="token function">append</span><span class="token punctuation">(</span>size_type count<span class="token punctuation">,</span> CharT ch<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加 count 个字符</span></pre></td></tr><tr><td data-num="5"></td><td><pre>basic_string <span class="token operator">&amp;</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">const</span> basic_string <span class="token operator">&amp;</span>str<span class="token punctuation">,</span> size_type pos<span class="token punctuation">,</span> size_type count<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 从原字符串末尾添加 str 从 pos 位置的 count 个字符</span></pre></td></tr></table></figure></li>
<li>
<p><strong>查找子串或字符</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>size_type <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> basic_string<span class="token operator">&amp;</span> str<span class="token punctuation">,</span> size_type pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span> <span class="token comment">// 从 C++ 字符串的 pos 位开始查找 C++ 字符串 str</span></pre></td></tr><tr><td data-num="2"></td><td><pre>size_type <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">char</span> ch<span class="token punctuation">,</span> size_type pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span> <span class="token comment">// 从 C++ 字符串的 pos 位开始查找字符 ch</span></pre></td></tr><tr><td data-num="3"></td><td><pre>size_type <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> s<span class="token punctuation">,</span> size_type pos<span class="token punctuation">,</span> size_type count<span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>  <span class="token comment">// 从 C++ 字符串的 pos 位开始，去查找 C 字符串的前 count 个字符</span></pre></td></tr></table></figure></li>
</ol>
<p>以下是使用  <code>std::string</code>  操作的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string str1 <span class="token operator">=</span> <span class="token string">"Hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string str2 <span class="token operator">=</span> <span class="token string">" World"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  std<span class="token double-colon punctuation">::</span>string str3<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token comment">// 追加字符串</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  str3<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  str3<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  str3<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Concatenated: "</span> <span class="token operator">&lt;&lt;</span> str3 <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">// 判断字符串是否为空</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Is str3 empty? "</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>str3<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"Yes"</span> <span class="token operator">:</span> <span class="token string">"No"</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token comment">// 获取字符串长度</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Length of str3: "</span> <span class="token operator">&lt;&lt;</span> str3<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">// 查找子串</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  std<span class="token double-colon punctuation">::</span>size_t pos <span class="token operator">=</span> str3<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Found '"</span> <span class="token operator">&lt;&lt;</span> str2 <span class="token operator">&lt;&lt;</span> <span class="token string">"' at position: "</span> <span class="token operator">&lt;&lt;</span> pos <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token comment">// 获取 C 风格字符串</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> cstr <span class="token operator">=</span> str3<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"C-style string: "</span> <span class="token operator">&lt;&lt;</span> cstr <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出</p>
<pre><code>Concatenated: Hello, World
Is str3 empty? No
Length of str3: 13
Found ' World' at position: 6
C-style string: Hello, World
</code></pre>
<p><code>std::string</code>  重载了比较运算符，可以直接使用  <code>==</code> ,  <code>!=</code> ,  <code>&lt;</code> ,  <code>&gt;</code> ,  <code>&lt;=</code> ,  <code>&gt;=</code>  等运算符进行字符串比较。</p>
<h3 id="stdstring-的遍历方法"><a class="anchor" href="#stdstring-的遍历方法">#</a>  <code>std::string</code>  的遍历方法</h3>
<p><code>std::string</code>  可以被视为一个字符容器，提供了多种方式来遍历其存储的字符。</p>
<ol>
<li>
<p><strong>通过下标遍历</strong>：<br />
使用下标操作符  <code>[]</code>  可以访问字符串中的每个字符。这种方法简洁直观，但需要确保索引有效，否则可能导致未定义行为。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>string <span class="token function">str</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span>size_t idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>idx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>使用  <code>at()</code>  函数遍历</strong>：<br />
 <code>at()</code>  函数提供了边界检查，如果索引超出字符串范围，会抛出  <code>std::out_of_range</code>  异常。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>  <span class="token comment">// 输出 'o'</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> str<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>  <span class="token comment">// 抛出异常</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>out_of_range<span class="token operator">&amp;</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Exception: "</span> <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>增强 for 循环（范围 for 循环）</strong>：<br />
C++11 引入了范围 for 循环，它使得遍历容器更加简洁。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">&amp;</span>ch <span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token comment">// 使用引用符号对容器本体进行操作</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 如果没有引用符号，操作就是对元素副本进行操作</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> ch <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>迭代器遍历</strong>：<br />
使用迭代器遍历字符串是一种更通用的方法，适用于所有支持迭代器的容器。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string<span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>it <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr></table></figure><p>在 C++11 之后，也可以使用  <code>auto</code>  关键字和基于范围的 for 循环来简化迭代器的使用：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>it <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ol>
<p>如指针一样，迭代器也有其固定的形式。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 某容器的迭代器形式为 容器名 ::iterator</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 此处 auto 推导出来 it 的类型为 string::iterator</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">auto</span> it <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">while</span><span class="token punctuation">(</span>it <span class="token operator">!=</span> str<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>it <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token operator">++</span>it<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="c-动态数组"><a class="anchor" href="#c-动态数组">#</a> C++ 动态数组</h2>
<p><code>std::vector</code>  是 C++ 标准模板库（STL）中的一个序列容器，它封装了动态大小数组的实现，提供了以下特性：</p>
<ol>
<li><strong>动态大小</strong>：
<ul>
<li><code>std::vector</code>  能够根据元素的添加或删除自动调整其容量。</li>
<li>当超出当前分配的内存时， <code>std::vector</code>  会分配一块更大的内存区域，并将现有元素复制到新内存区域，然后添加新元素。</li>
</ul>
</li>
<li><strong>动态插入和删除</strong>：
<ul>
<li><code>std::vector</code>  支持在容器的任意位置插入或删除元素。</li>
<li>插入操作可能涉及将后续元素向后移动以腾出空间，并可能触发容量重新分配。</li>
<li>删除操作涉及将后续元素向前移动以填补被删除元素留下的空位。</li>
</ul>
</li>
<li><strong>随机访问</strong>：
<ul>
<li><code>std::vector</code>  提供了随机访问迭代器，允许通过下标直接访问元素，提供了快速的索引访问能力。</li>
</ul>
</li>
</ol>
<h3 id="stdvector-的常用构造函数"><a class="anchor" href="#stdvector-的常用构造函数">#</a>  <code>std::vector</code>  的常用构造函数</h3>
<p><code>std::vector</code>  是 C++ 标准模板库中的一个序列容器，提供了多种构造函数来初始化容器。</p>
<ol>
<li>
<p><strong>无参构造函数</strong>：</p>
<ul>
<li>创建一个空的  <code>std::vector</code> ，不包含任何元素。</li>
</ul>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> numbers<span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>指定大小的构造函数</strong>：</p>
<ul>
<li>创建一个  <code>std::vector</code> ，包含指定数量的元素，每个元素初始化为该类型的默认值（如  <code>int</code>  的默认值为  <code>0</code> ）。</li>
</ul>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">></span> <span class="token function">numbers2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放 10 个 `0`</span></pre></td></tr></table></figure></li>
<li>
<p><strong>指定大小和默认值的构造函数</strong>：</p>
<ul>
<li>创建一个  <code>std::vector</code> ，包含指定数量的元素，每个元素初始化为指定的值。</li>
</ul>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">></span> <span class="token function">numbers3</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放 10 个 `20`</span></pre></td></tr></table></figure></li>
<li>
<p><strong>列表初始化</strong>：</p>
<ul>
<li>使用花括号  <code>&#123;&#125;</code>  直接指定  <code>std::vector</code>  中的元素。</li>
</ul>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> number3<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong>迭代器范围构造函数</strong>：</p>
<ul>
<li>使用两个迭代器（开始和结束迭代器）来初始化  <code>std::vector</code> ，复制指定范围内的元素。</li>
</ul>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">number4</span><span class="token punctuation">(</span>number3<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number3<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">//number4 中存储了 number3 中从开始到第四个元素之前的元素：&#123;1, 2, 3, 4&#125;</span></pre></td></tr></table></figure></li>
</ol>
<p>以下是使用  <code>std::vector</code>  构造函数的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 无参构造</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> numbers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 指定大小的构造</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">></span> <span class="token function">numbers2</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放 10 个 `0`</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 指定大小和默认值的构造</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">long</span><span class="token operator">></span> <span class="token function">numbers3</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放 10 个 `20`</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">// 列表初始化</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> number3<span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 迭代器范围构造</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">number4</span><span class="token punctuation">(</span>number3<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number3<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">// 输出验证</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"number4 contains:"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">:</span> number4<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span> <span class="token operator">&lt;&lt;</span> num<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出</p>
<pre><code>number4 contains: 1 2 3 4
</code></pre>
<h3 id="stdvector-的常用操作"><a class="anchor" href="#stdvector-的常用操作">#</a>  <code>std::vector</code>  的常用操作</h3>
<p><code>std::vector</code>  提供了一系列成员函数，用于管理容器的内容和状态。</p>
<ol>
<li>
<p><strong>迭代器访问</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 返回指向第一个元素的迭代器</span></pre></td></tr><tr><td data-num="2"></td><td><pre>iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 返回指向尾后位置（不是最后一个元素）的迭代器</span></pre></td></tr></table></figure></li>
<li>
<p><strong>判断容器状态</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>            <span class="token comment">// 判断容器是否为空</span></pre></td></tr><tr><td data-num="2"></td><td><pre>size_type <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>        <span class="token comment">// 返回容器中元素的数量</span></pre></td></tr><tr><td data-num="3"></td><td><pre>size_type <span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>     <span class="token comment">// 返回容器分配的内存可以容纳的元素数量</span></pre></td></tr></table></figure></li>
<li>
<p><strong>元素添加和删除</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">push_back</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在容器末尾添加一个新元素</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// 删除容器的最后一个元素</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">// 删除容器中的所有元素</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">shrink_to_fit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// 减少容器的容量以适应其大小</span></pre></td></tr></table></figure></li>
<li>
<p><strong>内存管理</strong>：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">reserve</span><span class="token punctuation">(</span>size_type new_cap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 改变容器的容量，通常用于优化性能</span></pre></td></tr></table></figure></li>
</ol>
<p>以下是使用  <code>std::vector</code>  操作的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> v<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token comment">// 添加元素</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  v<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  v<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token comment">// 遍历</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Initial vector: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token comment">// 删除最后一个元素</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  v<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token comment">// 遍历</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Vector after pop_back: "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> v<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token comment">// 清空容器</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  v<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>  <span class="token comment">// 检查是否为空</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Vector is empty.\n"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出</p>
<pre><code>Initial vector: 10 20
Vector after pop_back: 10
Vector is empty.
</code></pre>
<h3 id="stdvector-的遍历"><a class="anchor" href="#stdvector-的遍历">#</a>  <code>std::vector</code>  的遍历</h3>
<p><code>std::vector</code>  可以使用迭代器、下标操作符、 <code>at()</code>  成员函数和基于范围的 for 循环进行遍历。</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> v <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 下标遍历</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span>size_t idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> idx <span class="token operator">&lt;</span> v<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>idx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> nums<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 使用迭代器遍历</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token double-colon punctuation">::</span>iterator it <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> v<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token operator">*</span>it <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// 使用基于范围的 for 循环遍历</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> val <span class="token operator">:</span> v<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> val <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>std::vector</code>  不仅可以存储基本数据类型，还可以存储自定义类型的对象、指针、其他容器等。</p>
<h3 id="stdvector-的动态扩容机制"><a class="anchor" href="#stdvector-的动态扩容机制">#</a>  <code>std::vector</code>  的动态扩容机制</h3>
<p>当  <code>std::vector</code>  容器中的元素数量达到当前容量时，如果继续添加新元素，容器会自动进行扩容。扩容过程一般包括以下步骤：</p>
<ol>
<li><strong>开辟新空间</strong>： <code>std::vector</code>  会分配一块新的内存空间，这块新空间的容量通常是当前容量的两倍（不同编译器的实现可能有所不同，有的可能是 1.5 倍）。</li>
<li><strong>分配内存</strong>：通过分配器（Allocator）分配新的空间。分配器负责内存的分配和释放。</li>
<li><strong>复制元素</strong>：将现有元素从旧空间复制到新空间。</li>
<li><strong>添加新元素</strong>：在新空间中添加新元素。</li>
<li><strong>回收旧空间</strong>：释放旧空间，以避免内存泄漏。</li>
</ol>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VlOTZGN09oaGpCSnNsZWptYVFCM0E0QlNhUDdGbGtid1F4NjRzOHc0NkIxY2c_ZT12bWY4Q3Y.png" alt="undefined202403111142666.png" /></p>
<p>以下是演示  <code>std::vector</code>  动态扩容的示例：</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> numbers<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"初始大小: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 容量: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>  numbers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"添加一个元素后, 大小: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 容量: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  numbers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"再添加一个元素后, 大小: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 容量: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  numbers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"再添加一个元素后, 大小: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 容量: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>  <span class="token comment">// 继续添加元素，观察容量的变化</span></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    numbers<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"最终大小: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">", 容量: "</span> <span class="token operator">&lt;&lt;</span> numbers<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出</p>
<figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>初始大小: 0, 容量: 0</pre></td></tr><tr><td data-num="2"></td><td><pre>添加一个元素后, 大小: 1, 容量: 1</pre></td></tr><tr><td data-num="3"></td><td><pre>再添加一个元素后, 大小: 2, 容量: 2</pre></td></tr><tr><td data-num="4"></td><td><pre>再添加一个元素后, 大小: 3, 容量: 4</pre></td></tr><tr><td data-num="5"></td><td><pre>最终大小: 13, 容量: 16</pre></td></tr></table></figure><h3 id="stdvector-的底层实现"><a class="anchor" href="#stdvector-的底层实现">#</a>  <code>std::vector</code>  的底层实现</h3>
<p>在 C++ 的标准库中， <code>std::vector</code>  是一个动态数组容器，其底层实现主要依赖于三个指针来管理存储的元素。这三个指针分别是：</p>
<ol>
<li>
<p><strong>_start</strong>：</p>
<ul>
<li>指向当前数组中第一个元素存放的位置。</li>
<li>当  <code>std::vector</code>  被创建时，这个指针指向分配的内存的起始位置。</li>
</ul>
</li>
<li>
<p><strong>_finish</strong>：</p>
<ul>
<li>指向当前数组中最后一个元素存放的下一个位置。</li>
<li>这个指针在元素被添加或删除时会更新，表示当前有效元素的结束位置。</li>
</ul>
</li>
<li>
<p><strong>_end_of_storage</strong>：</p>
<ul>
<li>指向当前数组能够存放元素的最后一个空间的下一个位置。</li>
<li>这个指针用于管理内存的容量，当需要扩容时， <code>std::vector</code>  会使用这个指针来决定是否需要分配更多的内存。</li>
</ul>
</li>
</ol>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VlNk9oZDlfWHB4QXQzZnhCMVJxMVFRQlJ1TlR2Q01nUDlGMkNlMWtnMUVlR3c_ZT1SYzY4dmU.png" alt="image-20231009161203935.png" /></p>
<p>可以推导出：</p>
<ul>
<li><strong>size()</strong>：
<ul>
<li>通过计算  <code>_finish - _start</code>  来获取当前存储的元素数量。</li>
</ul>
</li>
<li><strong>capacity()</strong>：
<ul>
<li>通过计算  <code>_end_of_storage - _start</code>  来获取当前分配的内存容量。</li>
</ul>
</li>
</ul>
<div class="tags"><a href="/tags/cpp/" rel="tag"><i class="ic i-tag"></i>C++</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-12-15 15:00:41" itemprop="dateModified" datetime="2024-12-15T15:00:41+08:00">2024-12-15</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>樱小路七叶<i class="ic i-at"><em>@</em></i>Nana7ha's Café Stella</li><li class="link"><strong>本文链接：</strong><a href="http://cwlrin.github.io/c-cpp/cpp-base/C++%20%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1/" title="C++ 类和对象">http://cwlrin.github.io/c-cpp/cpp-base/C++ 类和对象/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/c-cpp/cpp-base/%E4%BB%8E%20C%20%E5%88%B0%20C++/" rel="prev" itemprop="url" title="从 C 到 C++" style="background-image: linear-gradient(to bottom right, #9bdfc9, #c7bdbc);"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>C++ 基础</span><h3>从 C 到 C++</h3></a></div><div class="item right"><a href="/c-cpp/cpp-base/C++%20%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81/" rel="next" itemprop="url" title="C++ 输入输出流" style="background-image: linear-gradient(to bottom right, #aab189, #8ec5e1);"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>C++ 基础</span><h3>C++ 输入输出流</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%80%9D%E6%83%B3"><span class="toc-number">1.</span> <span class="toc-text"> 面向对象思想</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B%E8%AE%BAprocedural-programming"><span class="toc-number">1.1.</span> <span class="toc-text"> 过程论（Procedural Programming）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E8%AE%BAobject-oriented-programming-oop"><span class="toc-number">1.2.</span> <span class="toc-text"> 对象论（Object-Oriented Programming, OOP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B%E8%AE%BA%E4%B8%8E%E5%AF%B9%E8%B1%A1%E8%AE%BA%E7%9A%84%E8%BE%A9%E8%AF%81%E5%85%B3%E7%B3%BB"><span class="toc-number">1.3.</span> <span class="toc-text"> 过程论与对象论的辩证关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">2.</span> <span class="toc-text"> 类的定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">2.1.</span> <span class="toc-text"> 访问修饰符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#struct-%E4%B8%8E-class-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">2.2.</span> <span class="toc-text">   struct  与   class  的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">2.3.</span> <span class="toc-text"> 成员函数的定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text"> 对象的创建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%88%9B%E5%BB%BA%E8%A7%84%E5%88%99"><span class="toc-number">3.1.</span> <span class="toc-text"> 对象的创建规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%95%B0%E6%8D%AE%E6%88%90%E5%91%98%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.2.</span> <span class="toc-text"> 对象的数据成员初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%89%80%E5%8D%A0%E7%A9%BA%E9%97%B4%E5%A4%A7%E5%B0%8F"><span class="toc-number">3.3.</span> <span class="toc-text"> 对象所占空间大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E9%92%88%E6%95%B0%E6%8D%AE%E6%88%90%E5%91%98"><span class="toc-number">3.4.</span> <span class="toc-text"> 指针数据成员</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E9%94%80%E6%AF%81"><span class="toc-number">4.</span> <span class="toc-text"> 对象的销毁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text"> 自定义析构函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8%E6%97%B6%E6%9C%BA"><span class="toc-number">4.2.</span> <span class="toc-text"> 析构函数的调用时机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">5.</span> <span class="toc-text"> 拷贝构造函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">5.1.</span> <span class="toc-text"> 拷贝构造函数的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E8%B0%83%E7%94%A8%E6%97%B6%E6%9C%BA"><span class="toc-number">5.2.</span> <span class="toc-text"> 拷贝构造函数的调用时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8E%A2%E7%A9%B6"><span class="toc-number">5.3.</span> <span class="toc-text"> 拷贝构造函数的形式探究</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%8E%BB%E6%8E%89%E5%BC%95%E7%94%A8%E7%AC%A6%E5%8F%B7"><span class="toc-number">5.3.1.</span> <span class="toc-text"> 拷贝构造函数是否可以去掉引用符号？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E5%8E%BB%E6%8E%89-const"><span class="toc-number">5.3.2.</span> <span class="toc-text"> 拷贝构造函数是否可以去掉   const  ？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E5%87%BD%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text"> 赋值运算符函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E5%87%BD%E6%95%B0%E7%9A%84%E5%BD%A2%E5%BC%8F"><span class="toc-number">6.1.</span> <span class="toc-text"> 赋值运算符函数的形式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#this-%E6%8C%87%E9%92%88"><span class="toc-number">6.2.</span> <span class="toc-text">  this  指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">6.3.</span> <span class="toc-text"> 赋值运算符函数的定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%8B%E5%80%BC%E8%BF%90%E7%AE%97%E7%AC%A6%E5%87%BD%E6%95%B0%E7%9A%84%E5%BD%A2%E5%BC%8F%E6%8E%A2%E7%A9%B6"><span class="toc-number">6.4.</span> <span class="toc-text"> 赋值运算符函数的形式探究</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E6%95%B0%E6%8D%AE%E6%88%90%E5%91%98"><span class="toc-number">7.</span> <span class="toc-text"> 特殊的数据成员</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%95%B0%E6%8D%AE%E6%88%90%E5%91%98"><span class="toc-number">7.1.</span> <span class="toc-text"> 常量数据成员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E6%95%B0%E6%8D%AE%E6%88%90%E5%91%98"><span class="toc-number">7.2.</span> <span class="toc-text"> 引用数据成员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%88%90%E5%91%98"><span class="toc-number">7.3.</span> <span class="toc-text"> 对象成员</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%95%B0%E6%8D%AE%E6%88%90%E5%91%98"><span class="toc-number">7.4.</span> <span class="toc-text"> 静态数据成员</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-number">8.</span> <span class="toc-text"> 特殊的成员函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-number">8.1.</span> <span class="toc-text"> 静态成员函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-number">8.2.</span> <span class="toc-text">  const  成员函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-number">9.</span> <span class="toc-text"> 对象的组织</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#const-%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.1.</span> <span class="toc-text">  const  对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8C%87%E9%92%88"><span class="toc-number">9.2.</span> <span class="toc-text"> 指向对象的指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%95%B0%E7%BB%84"><span class="toc-number">9.3.</span> <span class="toc-text"> 对象数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.4.</span> <span class="toc-text"> 堆对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#newdelete-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">10.</span> <span class="toc-text"> new&#x2F;delete 表达式的工作步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#new-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E4%B8%89%E4%B8%AA%E5%B7%A5%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">10.1.</span> <span class="toc-text">  new  表达式的三个工作步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%B7%A5%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">10.2.</span> <span class="toc-text">  delete  表达式的两个工作步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">10.3.</span> <span class="toc-text"> 创建对象的条件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A0%86%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">10.3.1.</span> <span class="toc-text"> 创建堆对象的条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%A0%88%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="toc-number">10.3.2.</span> <span class="toc-text"> 创建栈对象的条件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.</span> <span class="toc-text"> 单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%8D%95%E4%BE%8B%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E5%9C%A8%E9%9D%99%E6%80%81%E5%8C%BA"><span class="toc-number">11.1.</span> <span class="toc-text"> 将单例对象创建在静态区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%86%E5%8D%95%E4%BE%8B%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E5%9C%A8%E5%A0%86%E5%8C%BA"><span class="toc-number">11.2.</span> <span class="toc-text"> 将单例对象创建在堆区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%95%B0%E6%8D%AE%E6%88%90%E5%91%98%E7%94%B3%E8%AF%B7%E5%A0%86%E7%A9%BA%E9%97%B4"><span class="toc-number">11.3.</span> <span class="toc-text"> 单例对象的数据成员申请堆空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">11.4.</span> <span class="toc-text"> 单例模式的应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">12.</span> <span class="toc-text"> C++ 字符串</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stdstring-%E7%9A%84%E6%9E%84%E9%80%A0"><span class="toc-number">12.1.</span> <span class="toc-text">  std::string  的构造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdstring-%E7%9A%84%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">12.2.</span> <span class="toc-text">  std::string  的常用操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdstring-%E7%9A%84%E9%81%8D%E5%8E%86%E6%96%B9%E6%B3%95"><span class="toc-number">12.3.</span> <span class="toc-text">  std::string  的遍历方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c-%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84"><span class="toc-number">13.</span> <span class="toc-text"> C++ 动态数组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stdvector-%E7%9A%84%E5%B8%B8%E7%94%A8%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">13.1.</span> <span class="toc-text">  std::vector  的常用构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdvector-%E7%9A%84%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">13.2.</span> <span class="toc-text">  std::vector  的常用操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdvector-%E7%9A%84%E9%81%8D%E5%8E%86"><span class="toc-number">13.3.</span> <span class="toc-text">  std::vector  的遍历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdvector-%E7%9A%84%E5%8A%A8%E6%80%81%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6"><span class="toc-number">13.4.</span> <span class="toc-text">  std::vector  的动态扩容机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stdvector-%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0"><span class="toc-number">13.5.</span> <span class="toc-text">  std::vector  的底层实现</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/c-cpp/cpp-base/%E4%BB%8E%20C%20%E5%88%B0%20C++/" rel="bookmark" title="从 C 到 C++">从 C 到 C++</a></li><li  class="active"><a href="/c-cpp/cpp-base/C++%20%E7%B1%BB%E5%92%8C%E5%AF%B9%E8%B1%A1/" rel="bookmark" title="C++ 类和对象">C++ 类和对象</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81/" rel="bookmark" title="C++ 输入输出流">C++ 输入输出流</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD/" rel="bookmark" title="C++ 运算符重载">C++ 运算符重载</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E5%85%B3%E8%81%94%E6%80%A7%E5%AE%B9%E5%99%A8/" rel="bookmark" title="C++ 关联性容器">C++ 关联性容器</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E7%BB%A7%E6%89%BF/" rel="bookmark" title="C++ 继承">C++ 继承</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E5%A4%9A%E6%80%81/" rel="bookmark" title="C++ 多态">C++ 多态</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E6%A8%A1%E6%9D%BF/" rel="bookmark" title="C++ 模板">C++ 模板</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E7%A7%BB%E5%8A%A8%E8%AF%AD%E4%B9%89/" rel="bookmark" title="C++ 移动语义">C++ 移动语义</a></li><li ><a href="/c-cpp/cpp-base/C++%20%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/" rel="bookmark" title="C++ 资源管理">C++ 资源管理</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="樱小路七叶" src="/assets/avatar.jpg"/><p class="name" itemprop="name">樱小路七叶</p><div class="description" itemprop="description">技术与美日新月异</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">88</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">11</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">15</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/cwlrin" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;cwlrin"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/ying-xiao-lu-qi-ye" class="item zhihu" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;ying-xiao-lu-qi-ye"><i class="ic i-zhihu"></i></a><a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=411590211" class="item music" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;411590211"><i class="ic i-cloud-music"></i></a><a target="_blank" rel="noopener" href="https://space.bilibili.com/8013992" class="item bilibili" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;8013992"><i class="ic i-bilibili"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/c-cpp/cpp-base/C++%20%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/c-cpp/cpp-base/%E4%BB%8E%20C%20%E5%88%B0%20C++/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2020 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">樱小路七叶 @ 七葉の喫茶ステラ</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.4m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">21:47</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `c-cpp/cpp-base/C++ 类和对象/`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html>