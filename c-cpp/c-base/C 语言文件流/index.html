<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"/><meta name="theme-color" content="#222"/><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/><meta name="renderer" content="webkit"/><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"/><link rel="alternate" href="/rss.xml" title="Nana7ha's Café Stella" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="Nana7ha's Café Stella" type="application/atom+xml"><link rel="alternate" type="application/json" title="Nana7ha's Café Stella" href="http://cwlrin.wiki/feed.json"/><link rel="preconnect" href="https://s4.zstatic.net"/><link rel="preconnect" href="https://at.alicdn.com"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.20"><link rel="modulepreload" href="/js/chunk-NPDU2HRQ.js"></link><link rel="modulepreload" href="/js/chunk-R2ID445Y.js"></link><link rel="modulepreload" href="/js/chunk-YHPSMGA6.js"></link><link rel="modulepreload" href="/js/copy-tex-2AKW2INC.js"></link><link rel="modulepreload" href="/js/index.esm-TLZT3I4E.js"></link><link rel="modulepreload" href="/js/post-AWU7OAKV.js"></link><link rel="modulepreload" href="/js/quicklink-3TNKEFE4.js"></link><link rel="modulepreload" href="/js/siteInit.js"></link><link rel="preload" href="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VjSjZkRkVEVDFkSmtaVFFYWThxWHpjQjFlZzRBNkFxcG1Jb2pLeldLVUVoNlE_ZT1zcmhPOW0.png" as="image" fetchpriority="high"><meta name="keywords" content="C"/><meta name="description" content="技术与美日新月异"/><link rel="canonical" href="http://cwlrin.wiki/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E6%B5%81/"><title>C 语言文件流</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">C 语言文件流</h1><div class="meta"><span class="item" title="创建时间：2020-03-20 11:52:38"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2020-03-20T11:52:38+08:00">2020-03-20</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>36k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>33 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">七葉の喫茶ステラ</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VjSjZkRkVEVDFkSmtaVFFYWThxWHpjQjFlZzRBNkFxcG1Jb2pLeldLVUVoNlE_ZT1zcmhPOW0.png" loading="eager" decoding="async" fetchpriority="high" alt="Nana7ha's Café Stella"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemListElement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/c-cpp/" itemprop="item" rel="index" title="分类于C/C++"><span itemprop="name">C/C++<meta itemprop="position" content="0"/></span></a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope="itemscope" itemtype="https://schema.org/ListItem"><a href="/categories/c-cpp/c-basic/" itemprop="item" rel="index" title="分类于C 语言基础"><span itemprop="name">C 语言基础<meta itemprop="position" content="1"/></span></a></span></div><article class="post block" itemscope="itemscope" itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://cwlrin.wiki/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E6%B5%81/"/><span hidden="hidden" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"/><meta itemprop="name" content="樱小路七叶"/><meta itemprop="description" content=", 技术与美日新月异"/></span><span hidden="hidden" itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="Nana7ha's Café Stella"/></span><div class="body md" itemprop="articleBody"><h2 id="输入输出流"><a class="anchor" href="#输入输出流">#</a> 输入输出流</h2>
<h3 id="文件打开方式"><a class="anchor" href="#文件打开方式">#</a> 文件打开方式</h3>
<p>在处理文件操作时，我们可以通过指定不同的模式来打开文件，主要的模式有：</p>
<ol>
<li><strong>'r' 只读模式</strong>：此模式下，文件将被打开用于读取，不允许写入或修改文件内容。</li>
<li><strong>'w' 只写模式</strong>：此模式下，文件将被打开用于写入。如果文件已存在，其内容将被截断，即原有内容将被删除。</li>
<li><strong>'a' 附加模式</strong>：此模式下，文件将被打开用于追加数据到文件末尾。如果文件不存在，将创建新文件。</li>
</ol>
<p>这些模式可以与以下选项结合使用：</p>
<ul>
<li><strong>'t' 文本模式</strong>：指示以文本文件形式打开文件。在文本模式下，系统会自动处理换行符，根据不同操作系统的规则转换为相应的换行表示。</li>
<li><strong>'b' 二进制模式</strong>：指示以二进制文件形式打开文件。在二进制模式下，数据将被按原样读写，不进行任何转换。</li>
</ul>
<p>如果不指定模式，默认情况下文件将以文本形式打开。</p>
<p><strong>二进制文件与文本文件的区别</strong>：</p>
<ol>
<li>在 <strong>Windows 系统</strong> 中，文本文件使用  <code>&quot;\r\n&quot;</code>  表示换行。如果以文本模式打开文件并写入换行符  <code>&quot;\n&quot;</code> ，系统会自动将其转换为  <code>&quot;\r\n&quot;</code> 。而在二进制文件中， <code>&quot;\n&quot;</code>  被直接视为换行。</li>
<li>在 <strong>类 Unix/Linux 系统</strong> 中，文本文件使用  <code>&quot;\n&quot;</code>  表示换行，因此在这些系统中，文本文件和二进制文件在换行处理上没有区别。</li>
</ol>
<p>此外，模式末尾的 <strong>'+'</strong> 表示附加功能，例如 'r+'<strong> 读写模式</strong>：允许同时进行读写操作，而不是仅读。</p>
<table>
<thead>
<tr>
<th>打开方式</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td style="text-align:left">以只读方式打开文件，该文件必须存在。</td>
</tr>
<tr>
<td>r+</td>
<td style="text-align:left">以读 / 写方式打开文件，该文件必须存在。</td>
</tr>
<tr>
<td>rb+</td>
<td style="text-align:left">以读 / 写方式打开一个二进制文件，只允许读 / 写数据。</td>
</tr>
<tr>
<td>rt+</td>
<td style="text-align:left">以读 / 写方式打开一个文本文件，允许读和写。</td>
</tr>
<tr>
<td>w</td>
<td style="text-align:left">打开只写文件，若文件存在则长度清为 0，即该文件内容消失。</td>
</tr>
<tr>
<td>w+</td>
<td style="text-align:left">打开可读 / 写文件，若文件存在则文件长度清零，即该文件内容会消失。</td>
</tr>
<tr>
<td>a</td>
<td style="text-align:left">以附加的方式打开只写文件。若文件不存在，则会建立该文件，如果文件存在，写入的数据会被加到文件末尾，即文件原先的内容会被保留（EOF 符保留）。</td>
</tr>
<tr>
<td>a+</td>
<td style="text-align:left">以附加方式打开可读 / 写的文件。若文件不存在，则会建立该文件，如果文件存在，则写入的数据会被加到文件尾后，即文件原先的内容会被保留（原来的 EOF 符不保留）。</td>
</tr>
<tr>
<td>wb</td>
<td style="text-align:left">以只写方式打开或新建一个二进制文件，只允许写数据。</td>
</tr>
<tr>
<td>wb+</td>
<td style="text-align:left">以读 / 写方式打开或建立一个二进制文件，允许读和写。</td>
</tr>
<tr>
<td>wt+</td>
<td style="text-align:left">以读 / 写方式打开或建立一个文本文件，允许读写。</td>
</tr>
<tr>
<td>at+</td>
<td style="text-align:left">以读 / 写方式打开一个文本文件，允许读或在文本末追加数据。</td>
</tr>
<tr>
<td>ab+</td>
<td style="text-align:left">以读 / 写方式打开一个二进制文件，允许读或在文件末追加数据。</td>
</tr>
</tbody>
</table>
<h3 id="文件打开失败"><a class="anchor" href="#文件打开失败">#</a> 文件打开失败</h3>
<p>在文件操作过程中，如果遇到文件打开失败的情况，我们可以通过以下几种方式来获取错误信息：</p>
<ol>
<li><strong>使用  <code>perror()</code>  函数</strong>：这个函数可以直接将错误信息输出到标准错误（stderr）。它根据全局变量  <code>errno</code>  的当前值，输出对应的错误描述。</li>
<li><strong>获取  <code>errno</code>  错误码</strong>： <code>errno</code>  是一个全局变量，它存储了最近一次系统调用或库函数失败的错误码。通过检查  <code>errno</code>  的值，可以确定错误的具体原因。</li>
<li><strong>使用  <code>strerror()</code>  函数</strong>：这个函数接受一个错误码作为参数，并返回对应的错误信息字符串。与  <code>perror()</code>  不同的是， <code>strerror()</code>  允许你自定义错误信息的输出方式和格式。</li>
</ol>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestFileError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"CMakeLists.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Open successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件打开后，必须关闭</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"error: %d\n"</span><span class="token punctuation">,</span> errno<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取错误码</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token function">strerror</span><span class="token punctuation">(</span>errno<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 获取错误码对应的提示信息</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 打印自带的提示错误信息</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="文件打开成功"><a class="anchor" href="#文件打开成功">#</a> 文件打开成功</h3>
<p>若需打开项目目录中的 &quot;CMakeLists.txt&quot; 文件，应先通过相应的命令更改工作目录。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VjOVkzbDJzdEd4RWxhbHBLb0lEanZFQk1aWEdjb0lBcTFqOXhmNGVxTVh4bWc_ZT1SaTRoeDI.png" alt="" /></p>
<p>文件成功打开后，读取操作仍可能遇到错误。此时可以使用  <code>ferror()</code>  函数来判断是否存在错误。该函数返回非零值时，指示在上一次文件操作中发生了错误。</p>
<p>同时，为了确定文件读取是否结束，可以使用  <code>feof()</code>  函数。该函数在文件读取未结束时返回零（false），一旦到达文件末尾则返回非零值（true）。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestFileError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"CMakeLists.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Open successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token keyword">int</span> err <span class="token operator">=</span> <span class="token function">ferror</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件读取是否出错</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token keyword">int</span> eof <span class="token operator">=</span> <span class="token function">feof</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 文件读取是否结束</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"err: %d\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0，说明没有出错</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"eof: %d\n"</span><span class="token punctuation">,</span> eof<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0，说明没有结束</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件打开后，必须关闭</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印自带的提示错误信息</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="文件流的缓冲"><a class="anchor" href="#文件流的缓冲">#</a> 文件流的缓冲</h2>
<h3 id="缓冲的来源"><a class="anchor" href="#缓冲的来源">#</a> 缓冲的来源</h3>
<p>文件数据的读写操作通常比内存读写效率要低得多。如果没有缓冲机制，CPU 在处理文件数据时，需要不断地发送指令给 DMA（Direct Memory Access，一种专门负责 IO 数据读写的硬件）。DMA 随后从文件中读取数据到内存，然后 CPU 再进行处理。在这个过程中，CPU 需要全程参与，这极大地浪费了 CPU 资源。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0ViZnVURUlBeWhCQ25HMHg0cHVMMDhBQnEtNXUtbXJJRG1fNHl1Z3g1VDFld0E_ZT1RUGlEOHg.png" alt="" /></p>
<p>为了解决这个问题，引入了文件流缓冲机制。通过在 DMA 和 CPU 之间添加一个缓冲区，DMA 可以将文件数据首先读取到缓冲区中。当缓冲区满了之后，DMA 再通知 CPU 进行处理。此时，CPU 一次性读取整个缓冲区的数据并进行处理，而不是对每一个数据项单独处理。</p>
<p>这种缓冲机制有效地降低了 IO 操作对 CPU 的占用，提高了系统的效率。它允许 DMA 和 CPU 以不同的速度独立工作，减少了 CPU 等待 IO 操作完成的时间，从而可以处理其他任务。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VTaUJJcEoyVkNsRGlWcnVYWEhlcm8wQkd5Tlo5MnpIeDB6aGRUOWVXdEkyMFE_ZT01TjBqZXA.png" alt="" /></p>
<h3 id="设置缓冲区大小"><a class="anchor" href="#设置缓冲区大小">#</a> 设置缓冲区大小</h3>
<p>在文件 I/O 操作中，可以通过  <code>setbuf()</code>  和  <code>setvbuf()</code>  函数来设置缓冲区，以优化数据的读写效率。</p>
<ol>
<li>
<p><strong> <code>setbuf()</code>  函数</strong>：此函数接受两个参数，即文件指针和缓冲区的指针。使用  <code>setbuf()</code>  时，无法直接指定缓冲区的大小，因为该函数仅知道缓冲区的起始地址，而不了解其大小。编译器通常将  <code>setbuf()</code>  的缓冲区大小默认为  <code>BUFSIZ</code> 。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">char</span> buf<span class="token punctuation">[</span>BUFSIZ<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setbuf</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong> <code>setvbuf()</code>  函数</strong>：与  <code>setbuf()</code>  相比， <code>setvbuf()</code>  提供了更多的灵活性，允许设置缓冲区的大小和缓冲方式。它接受四个参数：文件指针、缓冲区指针、缓冲方式和缓冲区大小。</p>
<ul>
<li>缓冲方式可以是  <code>_IOFBF</code> （全量缓冲）， <code>_IOLBF</code> （按行缓冲），或  <code>_IONBF</code> （禁用缓冲）。</li>
<li>缓冲区大小可以自定义，以字节为单位。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">8192</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">setvbuf</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> _IOFBF<span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ol>
<p>​ 通过  <code>setvbuf()</code>  函数，开发者可以根据应用程序的需求，自定义缓冲区的大小和缓冲策略，从而提高文件操作的性能。</p>
<h3 id="缓冲区的生命周期和清空"><a class="anchor" href="#缓冲区的生命周期和清空">#</a> 缓冲区的生命周期和清空</h3>
<p>为了确保文件流操作的效率，缓冲区的生命周期应该覆盖或者长于文件流的生命周期。通常，可以通过  <code>malloc()</code>  函数分配一块内存作为缓冲区。一旦文件流关闭，就应该释放这块内存，以避免内存泄漏。</p>
<p>清空缓冲区，即强制将缓冲区中的数据写入文件，可以使用  <code>fflush()</code>  函数。这个函数可以立即将缓冲区的内容输出，而不需要等待缓冲区满。这对于控制台输出（例如  <code>stdout</code> ）尤其有用，因为在调试过程中，控制台可能不会自动显示缓冲区的内容。</p>
<p>添加  <code>fflush()</code>  函数后，可以确保控制台立即输出缓冲区中的所有内容，这对于实时监控程序的输出非常有用。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestFflush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"CMakeLists.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">8192</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		<span class="token function">setvbuf</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> _IOFBF<span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Open successfully"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token keyword">int</span> err <span class="token operator">=</span> <span class="token function">ferror</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件读取是否出错</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">int</span> eof <span class="token operator">=</span> <span class="token function">feof</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 文件读取是否结束</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"err: %d\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0，说明没有出错</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"eof: %d\n"</span><span class="token punctuation">,</span> eof<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0，说明没有结束</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 清空缓冲区</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件打开后，必须关闭</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fopen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 打印自带的提示错误信息</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="读写一个字符"><a class="anchor" href="#读写一个字符">#</a> 读写一个字符</h2>
<h3 id="读一个字符"><a class="anchor" href="#读一个字符">#</a> 读一个字符</h3>
<p>在 C 语言中，有三种常用的函数用于读取单个字符： <code>getchar()</code> 、 <code>getc()</code>  和  <code>fgetc()</code> 。</p>
<ol>
<li><strong> <code>getchar()</code> </strong>：这是一个宏，用于从标准输入（ <code>stdin</code> ）读取一个字符。它与  <code>getc(stdin)</code>  等价。</li>
<li><strong> <code>getc()</code> </strong>：这也是一个宏，可以用于读取指定文件流的一个字符。</li>
<li><strong> <code>fgetc()</code> </strong>：与  <code>getc()</code>  功能相同，但是以函数形式实现。</li>
</ol>
<p>所有这些函数的返回值都是一个整数，当文件流结束时，它们会返回特定的宏  <code>EOF</code> （End Of File）。</p>
<p>在循环读取字符时，需要检查  <code>EOF</code>  标识以确定是否到达输入的末尾。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestEof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		<span class="token keyword">int</span> next_input <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>next_input <span class="token operator">==</span> <span class="token constant">EOF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token comment">// 如果是结束标识</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>next_input <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>			<span class="token comment">// 不打印换行</span></pre></td></tr><tr><td data-num="10"></td><td><pre>			<span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token comment">// 没结束，不换行的情况下，打印用户输入</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c\n"</span><span class="token punctuation">,</span> next_input<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>要结束控制台输入并触发  <code>EOF</code> ，不同操作系统有不同的快捷键：</p>
<ul>
<li>在 <strong>Linux</strong> 系统中，使用  <code>Ctrl + D</code> 。</li>
<li>在 <strong>Windows</strong> 系统中，使用  <code>Ctrl + Z</code> ，这在某些环境中可能需要额外的步骤来识别为  <code>EOF</code> 。</li>
</ul>
<p>需要注意的是，某些开发环境（如 CLion 的控制台）可能不支持这些快捷键来触发  <code>EOF</code> ，因此需要在系统的命令行界面（如 Windows 的 CMD）中进行测试。</p>
<h3 id="写一个字符"><a class="anchor" href="#写一个字符">#</a> 写一个字符</h3>
<p>与读取字符相对应的，写入字符也可以使用三个函数： <code>putchar()</code> 、 <code>putc()</code>  和  <code>fputc()</code> 。</p>
<ol>
<li><strong> <code>putchar()</code> </strong>：这是一个宏，用于向标准输出（ <code>stdout</code> ）写入一个字符。</li>
<li><strong> <code>putc()</code> </strong>：这也是一个宏，可以用于向指定的文件流写入一个字符。</li>
<li><strong> <code>fputc()</code> </strong>：与  <code>putc()</code>  功能相同，但是以函数形式实现。</li>
</ol>
<p>这些函数通常用于向控制台或其他文件流输出单个字符。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestEof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		<span class="token keyword">int</span> next_input <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>next_input <span class="token operator">==</span> <span class="token constant">EOF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>			<span class="token comment">// 如果是结束标识</span></pre></td></tr><tr><td data-num="7"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>next_input <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>			<span class="token keyword">continue</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token comment">// 没结束，不换行的情况下，打印用户输入</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token comment">// 输出单个字符</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token function">putchar</span><span class="token punctuation">(</span>next_input<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="读取一个文件将其打印至控制台"><a class="anchor" href="#读取一个文件将其打印至控制台">#</a> 读取一个文件将其打印至控制台</h3>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 打开文件</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"CMakeLists.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 检查文件是否成功打开</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 循环读取文件直到文件结束</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">int</span> next_input <span class="token operator">=</span> <span class="token function">getc</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 从文件中读取一个字符</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token comment">// 检查是否到达文件末尾</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>next_input <span class="token operator">==</span> <span class="token constant">EOF</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token comment">// 将读取的字符输出到控制台</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token function">fputc</span><span class="token punctuation">(</span>next_input<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 向控制台写入一个字符</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">// 关闭文件</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment">// 如果文件打开失败，打印错误信息</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Error opening file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="读写一行字符"><a class="anchor" href="#读写一行字符">#</a> 读写一行字符</h2>
<h3 id="读一行字符"><a class="anchor" href="#读一行字符">#</a> 读一行字符</h3>
<p>读取控制台输入的一行字符可以使用以下几种函数：</p>
<ol>
<li>
<p><strong> <code>gets_s()</code> </strong>：这是一个安全的函数，用于读取控制台输入的一行字符，直到遇到换行符  <code>\n</code> 。它接收两个参数：一个字符数组  <code>buffer</code>  和一个表示最大字符数的  <code>size</code> 。 <code>gets_s()</code>  函数在读取成功时返回  <code>buffer</code> ，读取失败时返回  <code>NULL</code> 。需要注意的是， <code>size</code>  参数应该比实际需要的字符数多一个，以保留空间给字符串结束符  <code>\0</code> 。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">gets_s</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong> <code>fgets()</code> </strong>：这个函数用于从指定的文件流中读取一行字符。它接收三个参数：一个字符数组  <code>buffer</code> ，一个表示最大字符数的  <code>size</code> ，以及一个文件流  <code>stream</code> 。 <code>fgets()</code>  会读取最多  <code>size - 1</code>  个字符，并将最后一个位置留给  <code>\0</code> 。如果遇到换行符， <code>fgets()</code>  会将其一同读入  <code>buffer</code> ，然后存储  <code>\0</code>  结束符。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ol>
<p><code>gets()</code>  函数由于其不安全性，已经被废弃，不应在新的代码中使用。相比之下， <code>gets_s()</code>  和  <code>fgets()</code>  提供了更好的安全性和灵活性。</p>
<h3 id="写一行字符"><a class="anchor" href="#写一行字符">#</a> 写一行字符</h3>
<ol>
<li>
<p><strong> <code>puts()</code> </strong>：这是一个简单的函数，用于向标准输出（ <code>stdout</code> ）写入一行字符。它接收一个参数，即要输出的字符串（以空字符  <code>\0</code>  结尾）。 <code>puts()</code>  会在字符串的末尾自动添加换行符  <code>\n</code> 。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
<li>
<p><strong> <code>fputs()</code> </strong>：与  <code>puts()</code>  类似， <code>fputs()</code>  也用于写入字符串，但它允许指定输出的文件流。它接收两个参数：要写入的字符串和目标文件流。与  <code>puts()</code>  不同， <code>fputs()</code>  不会自动添加换行符，因此，如果需要换行，必须手动在字符串中包含  <code>\n</code> 。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"Hello, World!\n"</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure></li>
</ol>
<p><code>fputs()</code>  函数的灵活性使其可以用于除了标准输出之外的其他文件流，例如文件或管道。这使得它在需要将数据写入不同目的地时非常有用。</p>
<p>需注意，<strong>这些函数不能用于二进制文件，只能用作文本文件</strong>。</p>
<h2 id="读写指定大小的字节"><a class="anchor" href="#读写指定大小的字节">#</a> 读写指定大小的字节</h2>
<h3 id="字节"><a class="anchor" href="#字节">#</a> 字节</h3>
<p>在计算机科学中，字节（Byte）是信息的基本单位，每个字节由 8 位（bit）组成。位是计算机处理和存储数据的最小单位，代表一个二进制数字，即 0 或 1。因此，一个字节可以表示 2828 或 256 种不同的状态。</p>
<p>在 ASCII 码表中，每种字符都被分配了一个特定的数字编码。例如，换行符（Line Feed, LF）的 ASCII 码是 10，用二进制表示为  <code>0000 1010</code> 。若从十六进制角度看，这个编码对应的是  <code>0a</code> 。</p>
<p>ASCII 码表是一种字符编码标准，用于将数字值映射到特定的字符上，从而允许计算机存储和交换文本数据。ASCII 码表中的每个字符都用一个字节来表示，这使得它能够容纳 128 个不同的字符（0-127 的值），包括字母、数字、标点符号和控制字符。</p>
<h3 id="读字节"><a class="anchor" href="#读字节">#</a> 读字节</h3>
<p><strong> <code>fread()</code>  函数用于从文件流中读取指定数量的字节。</strong> 它是一个多功能的函数，可以读取任何类型的数据，只要指定了正确的数据大小和数量。该函数具有以下参数：</p>
<ol>
<li><strong> <code>void \*ptr</code> </strong>：一个通用指针，指向用于存储读取数据的内存块。</li>
<li><strong> <code>size_t size</code> </strong>：每个数据项的大小（以字节为单位）。</li>
<li><strong> <code>size_t count</code> </strong>：要读取的数据项数量。</li>
<li><strong> <code>FILE \*stream</code> </strong>：指向  <code>FILE</code>  结构的指针，表示要读取数据的文件流。</li>
</ol>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VlSkE3MTNoRy01UGdWLUhpZlBhZGE4QmU5b1VxYTB0Uk1Zb1p6cWsxUlJVV1E_ZT1VcE1EYVE.png" alt="" /></p>
<p><strong>返回值</strong>：  <code>fread()</code>  函数返回实际读取的字节数。如果返回的字节数小于请求读取的总字节数（即  <code>size * count</code> ），这可能意味着已经到达文件末尾或发生了错误。在这种情况下，可以进一步检查  <code>feof()</code>  或  <code>ferror()</code>  来确定读取结束的原因。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">Echo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">// 读字节</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">size_t</span> bytes_read <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes_read <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Error read from stdin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"EOF"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token function">fwrite</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bytes_read<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 还剩些字节打印出来</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment">// 写字节</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token function">fwrite</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>当使用标准输入  <code>stdin</code>  进行测试时，按下换行键实际上会将换行符作为输入的一部分传递给  <code>fread()</code>  函数。这意味着换行符会被当作  <code>0a</code>  字节读入到提供的缓冲区  <code>buffer</code>  中。这与前面讨论的字符读写函数的行为不同，因为那些函数通常在遇到换行符时停止读取。</p>
<p>例如，如果用户输入数字  <code>1234567</code>  并按下换行键， <code>fread()</code>  会将这些数字和换行符一起读入缓冲区。在小端序系统中，这意味着缓冲区的低地址处将首先存储数值的高位。换行符作为输入流的一部分，也会被存储在缓冲区中，紧跟在输入数字之后。</p>
<p>需要注意的是， <code>fread()</code>  函数本身并不处理换行符，它只是简单地从文件流中读取指定数量的字节。因此，在使用  <code>fread()</code>  从  <code>stdin</code>  读取数据时，开发者需要自行处理缓冲区中可能包含的换行符。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VmTHoycjllVnRWR2h5dUE4LWpNcHV3QkloV2libGt6MzJKN2RwNEc3SHpuRnc_ZT10dlQzaWc.png" alt="" /></p>
<h3 id="写字节"><a class="anchor" href="#写字节">#</a> 写字节</h3>
<p><code>fwrite()</code>  函数与  <code>fread()</code>  相对应，用于向文件流写入数据。 <code>fwrite()</code>  的第一个参数是指向要写入的数据的指针，并且添加了  <code>const</code>  限定符，这表明在写入过程中数据不会被修改，这与  <code>fread()</code>  的用法是一致的。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VlVHVPMzU0R181RXJWT3I5RnMxZ2g4QjFyUVFTX0s5ZWVCRVlhakRWQlhhMWc_ZT03VGVjd2Y.png" alt="" /></p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">Echo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">int</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		<span class="token comment">// 读字节</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token class-name">size_t</span> bytes_read <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d, "</span><span class="token punctuation">,</span> buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>bytes_read <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>				<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Error read from stdin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>				<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"EOF"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>				<span class="token function">fwrite</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bytes_read<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 还剩些字节打印出来</span></pre></td></tr><tr><td data-num="17"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token comment">// 写字节</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token function">fwrite</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在小端序系统中，多字节数据的字节序是低位在前，高位在后。例如，如果输入是  <code>1234567890abcdef</code> ，并且只考虑前四个字节  <code>1234</code> ，在小端序系统中，这些字节将被存储和读取为  <code>31,32,33,34</code> （在 ASCII 码表中，字符  <code>'1'</code>  对应的十六进制是  <code>31</code> ）。</p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VXQTdjRk5iT1J0QnU4MkVlZXgtcHRRQmNvcmpsRVpHdFcxcmR0bTN2OWhYekE_ZT1UeXN0MmE.png" alt="" /></p>
<p><img loading="lazy" data-src="https://dlink.host/1drv/aHR0cHM6Ly8xZHJ2Lm1zL2kvYy9iZGU1MWU2MjVlZjhmY2M1L0VlNnhhbS1oanU1SmhGYl83LTQxWGRnQnJQc0RCeEw2TnZsblpaYmI0SGNOa0E_ZT1ETU9RMXI.png" alt="" /></p>
<h2 id="序列化和反序列化的基本实现"><a class="anchor" href="#序列化和反序列化的基本实现">#</a> 序列化和反序列化的基本实现</h2>
<p>Java 中，序列化是把对象转换为字节序列，存到磁盘中。而反序列化是从磁盘中读取字节序列将它们反序列化成对象读出来。对应到 C 中，实际上便是将结构体和二进制文件互相转化。</p>
<p>在 C 语言中，使用  <code>fread()</code>  和  <code>fwrite()</code>  函数可以实现结构体数据的序列化和反序列化。以下是实现这一过程的步骤：</p>
<ol>
<li><strong>定义结构体</strong>：首先定义一个结构体，它将被用来存储需要序列化的数据。</li>
<li><strong>读取结构体</strong>：使用  <code>fread()</code>  函数从二进制文件中读取数据到结构体中。</li>
<li><strong>打印结构体内容</strong>：输出当前结构体的内容，以验证读取操作。</li>
<li><strong>修改结构体属性</strong>：修改结构体中的部分属性值。</li>
<li><strong>保存结构体</strong>：使用  <code>fwrite()</code>  函数将修改后的结构体数据写回二进制文件。</li>
</ol>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ERROR</span> <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OK</span> <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">int</span> visibility<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">int</span> region<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> font_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span> Settings<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">void</span> <span class="token function">PrintSettings</span><span class="token punctuation">(</span>Settings <span class="token operator">*</span>settings<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"settings->visibility: %d\n"</span><span class="token punctuation">,</span> settings<span class="token operator">-></span>visibility<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"settings->region: %d\n"</span><span class="token punctuation">,</span> settings<span class="token operator">-></span>region<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"settings->font_size: %d\n"</span><span class="token punctuation">,</span> settings<span class="token operator">-></span>font_size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">// 序列化，将结构体转为二进制文件</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">int</span> <span class="token function">SaveSettings</span><span class="token punctuation">(</span>Settings <span class="token operator">*</span>settings<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>settings_file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>settings_file<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意是二进制</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token operator">-></span>visibility<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>settings<span class="token operator">-></span>visibility<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token operator">-></span>region<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>settings<span class="token operator">-></span>region<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token operator">-></span>font_size<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>settings<span class="token operator">-></span>font_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">return</span> OK<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Failed to save settings."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">return</span> ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">// 将二进制文件读取为结构体，如果打开失败，返回默认值</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">void</span> <span class="token function">LoadSettings</span><span class="token punctuation">(</span>Settings <span class="token operator">*</span>settings<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>settings_file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>settings_file<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token operator">-></span>visibility<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>settings<span class="token operator">-></span>visibility<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token operator">-></span>region<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>settings<span class="token operator">-></span>region<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token function">fread</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token operator">-></span>font_size<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>settings<span class="token operator">-></span>font_size<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token comment">// 文件读取失败时，自动为结构体赋默认值</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        settings<span class="token operator">-></span>visibility <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        settings<span class="token operator">-></span>region <span class="token operator">=</span> <span class="token number">86</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        settings<span class="token operator">-></span>font_size <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    Settings settings<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token comment">// 读取二进制文件</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token function">LoadSettings</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token punctuation">,</span> <span class="token string">"settings.bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token function">PrintSettings</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token comment">// 修改 settings</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    settings<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>    settings<span class="token punctuation">.</span>font_size <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token comment">// 保存到二进制文件中</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token function">SaveSettings</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>settings<span class="token punctuation">,</span> <span class="token string">"settings.bin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>序列化结构体到二进制文件</strong>：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> visibility<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> region<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">int</span> font_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span> Settings<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 定义状态码</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OK</span> <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// 将结构体序列化到二进制文件</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">int</span> <span class="token function">SaveSettings</span><span class="token punctuation">(</span>Settings <span class="token operator">*</span>settings<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>settings_file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>settings_file<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 以二进制写入模式打开文件</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token function">fwrite</span><span class="token punctuation">(</span>settings<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Settings<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 写入整个结构体</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> OK<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Failed to save settings."</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">return</span> ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>从二进制文件反序列化为结构体</strong>：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 从二进制文件读取并反序列化为结构体</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">LoadSettings</span><span class="token punctuation">(</span>Settings <span class="token operator">*</span>settings<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>settings_file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>settings_file<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 以二进制读取模式打开文件</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token function">fread</span><span class="token punctuation">(</span>settings<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>Settings<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 读取整个结构体</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 如果文件读取失败，设置默认值</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        settings<span class="token operator">-></span>visibility <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        settings<span class="token operator">-></span>region <span class="token operator">=</span> <span class="token number">86</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        settings<span class="token operator">-></span>font_size <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在这些函数中， <code>fwrite()</code>  用于将  <code>Settings</code>  结构体实例的字节写入到二进制文件中，而  <code>fread()</code>  用于从二进制文件中读取字节到  <code>Settings</code>  结构体实例中。如果文件操作失败， <code>SaveSettings</code>  函数返回错误码，而  <code>LoadSettings</code>  函数则为结构体设置默认值。</p>
<h2 id="复制一个文件"><a class="anchor" href="#复制一个文件">#</a> 复制一个文件</h2>
<h3 id="方法一"><a class="anchor" href="#方法一">#</a> 方法一</h3>
<p>要复制一个文件，可以逐字符地从源文件读取内容并写入到目标文件中。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// 定义复制文件的状态码</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_SUCCESS</span> <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_ILLEGAL_ARGUMENTS</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_SRC_OPEN_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">2</span></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_SRC_READ_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">3</span></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_DEST_OPEN_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">4</span></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_DEST_WRITE_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">5</span></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_UNKNOWN_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">100</span></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">int</span> <span class="token function">CopyFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>dest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">// 检查参数是否合法</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>src <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> dest <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token keyword">return</span> COPY_ILLEGAL_ARGUMENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token comment">// 打开源文件</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	FILE <span class="token operator">*</span>src_file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>src_file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token keyword">return</span> COPY_SRC_OPEN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token comment">// 打开目标文件</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	FILE <span class="token operator">*</span>dest_file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>dest_file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭源文件</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token keyword">return</span> COPY_DEST_OPEN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token comment">// 进行文件复制操作</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token keyword">int</span> result <span class="token operator">=</span> COPY_SUCCESS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token keyword">int</span> src_input<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>src_input <span class="token operator">=</span> <span class="token function">getc</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">EOF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">putc</span><span class="token punctuation">(</span>src_input<span class="token punctuation">,</span> dest_file<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">EOF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>			result <span class="token operator">=</span> COPY_DEST_WRITE_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token comment">// 检查源文件读取是否失败</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>		result <span class="token operator">=</span> COPY_SRC_READ_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token comment">// 关闭文件流</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>dest_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>	<span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>	<span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">CopyFile</span><span class="token punctuation">(</span><span class="token string">"main.c"</span><span class="token punctuation">,</span> <span class="token string">"01.c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"result: %d\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre></pre></td></tr><tr><td data-num="57"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在这个示例中，首先检查传入的参数是否合法，然后尝试打开源文件和目标文件。如果任一文件打开失败，将返回相应的错误码。在文件复制过程中，使用  <code>getc()</code>  函数从源文件读取字符，并使用  <code>putc()</code>  函数将字符写入目标文件。如果在写入过程中遇到错误，返回写入错误码。复制完成后检查源文件的读取是否存在错误，并关闭两个文件流。</p>
<h3 id="方法二"><a class="anchor" href="#方法二">#</a> 方法二</h3>
<p>使用  <code>fgets()</code>  和  <code>fputs()</code>  函数可以高效地复制文件内容。这个过程需要注意几个关键点：</p>
<ul>
<li><code>fopen()</code>  打开文件流失败时会返回  <code>NULL</code> 。</li>
<li><code>ferror()</code>  用于判断文件读取是否失败。</li>
<li><code>feof()</code>  用于判断文件读取是否结束。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/timeb.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;locale.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 定义七种情况</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_SUCCESS</span> <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_ILLEGAL_ARGUMENTS</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span>  </span><span class="token comment">// 参数非法</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_SRC_OPEN_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">2</span>     </span><span class="token comment">// 源文件打开失败</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_SRC_READ_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">3</span>     </span><span class="token comment">// 源文件读取失败</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_DEST_OPEN_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">4</span>    </span><span class="token comment">// 目标文件打开失败</span></span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_DEST_WRITE_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">5</span>   </span><span class="token comment">// 目标文件写入失败</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">COPY_UNKNOWN_ERROR</span> <span class="token expression"><span class="token operator">-</span><span class="token number">100</span>    </span><span class="token comment">// 未知错误</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">512</span></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token class-name">long_time_t</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">int</span> <span class="token function">CopyFile2</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>dest<span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>src <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> dest <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> COPY_ILLEGAL_ARGUMENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  FILE <span class="token operator">*</span>src_file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>src_file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// 文件流打开失败</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">return</span> COPY_SRC_OPEN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>  FILE <span class="token operator">*</span>dest_file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>  <span class="token keyword">if</span><span class="token punctuation">(</span>dest_file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 注意关闭已经打开的文件流</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">return</span> COPY_DEST_OPEN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>  <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 读取最大字符数为 BUFFER_SIZE - 1，留一个给 '\0'</span></pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token keyword">int</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token comment">// 读</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">char</span><span class="token operator">*</span> src_input <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> src_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span>src_input <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 读取不到字符时，判断原因</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token comment">// 读取结束</span></pre></td></tr><tr><td data-num="44"></td><td><pre>        result <span class="token operator">=</span> COPY_SUCCESS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 读取失败</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        result <span class="token operator">=</span> COPY_SRC_READ_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 未知错误</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        result <span class="token operator">=</span> COPY_UNKNOWN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>      <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>      <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token comment">// 写</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fputs</span><span class="token punctuation">(</span>src_input<span class="token punctuation">,</span> dest_file<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">EOF</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 写入失败</span></pre></td></tr><tr><td data-num="55"></td><td><pre>      result <span class="token operator">=</span> COPY_DEST_WRITE_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>      <span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token function">fclose</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>  <span class="token function">fclose</span><span class="token punctuation">(</span>dest_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>  <span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="方法三"><a class="anchor" href="#方法三">#</a> 方法三</h3>
<p><strong>文件复制方法：</strong></p>
<ol>
<li><strong>方法一</strong>：使用逐字符读取和写入函数（如  <code>fgetc()</code>  和  <code>fputc()</code> ）进行文件复制。这种方法速度较慢，但适用于文本和二进制文件。</li>
<li><strong>方法二</strong>：使用逐行读取和写入函数（如  <code>fgets()</code>  和  <code>fputs()</code> ）进行文件复制。这种方法速度较快，但仅限于文本文件。</li>
<li><strong>方法三</strong>：使用  <code>fread()</code>  和  <code>fwrite()</code>  函数进行文件复制。这种方法速度最快，同时适用于文本和二进制文件。</li>
</ol>
<p><strong>原因分析</strong>：</p>
<ul>
<li>在前两种方法中，读取和写入操作是分开的，需要分别检查读取和写入的结果。</li>
<li>使用  <code>fread()</code>  和  <code>fwrite()</code>  函数时，读取结束后不是通过检查读取内容是否为  <code>NULL</code>  来判断，而是通过检查读取的字节数是否小于设定的缓冲区大小  <code>BUFFER_SIZE</code> 。因此，需要在读写操作之后判断读取的字节数，以确定是否需要采取其他措施。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span> <span class="token function">CopyFile3</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>src<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>dest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>src <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> dest <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>		<span class="token keyword">return</span> COPY_ILLEGAL_ARGUMENTS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>	FILE <span class="token operator">*</span>src_file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>src_file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>		<span class="token comment">// 文件流打开失败</span></pre></td></tr><tr><td data-num="9"></td><td><pre>		<span class="token keyword">return</span> COPY_SRC_OPEN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>	FILE <span class="token operator">*</span>dest_file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>dest_file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 注意关闭已经打开的文件流</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token keyword">return</span> COPY_DEST_OPEN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 读取最大字符数为 BUFFER_SIZE - 1，留一个给 '\0'</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">int</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token comment">// 读</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token class-name">size_t</span> bytes_read <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> src_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>		<span class="token comment">// 读多少字节，写多少字节</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token class-name">size_t</span> bytes_write <span class="token operator">=</span> <span class="token function">fwrite</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> bytes_read<span class="token punctuation">,</span> dest_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>bytes_write <span class="token operator">&lt;</span> bytes_read<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>			<span class="token comment">// 如果写比读的少，一定写入错误</span></pre></td></tr><tr><td data-num="29"></td><td><pre>			result <span class="token operator">=</span> COPY_DEST_WRITE_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>		<span class="token comment">// 如果读不满数组，判断原因</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>bytes_read <span class="token operator">&lt;</span> BUFFER_SIZE<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>				<span class="token comment">// 文件读取失败</span></pre></td></tr><tr><td data-num="37"></td><td><pre>				result <span class="token operator">=</span> COPY_SRC_READ_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>				<span class="token comment">// 文件读取结束</span></pre></td></tr><tr><td data-num="40"></td><td><pre>				result <span class="token operator">=</span> COPY_SUCCESS<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>				<span class="token comment">// 发生未知错误</span></pre></td></tr><tr><td data-num="43"></td><td><pre>				result <span class="token operator">=</span> COPY_UNKNOWN_ERROR<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>src_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>dest_file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>	<span class="token keyword">return</span> result<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="三种方法的时间对比"><a class="anchor" href="#三种方法的时间对比">#</a> 三种方法的时间对比</h3>
<p>在处理大文件复制任务时，使用  <code>fgets()</code>  和  <code>fputs()</code>  函数的方法通常比使用  <code>fgetc()</code>  和  <code>fputc()</code>  函数更为高效。这种效率提升的主要原因在于文件操作中的锁机制。</p>
<ul>
<li>当使用  <code>fgetc()</code>  逐个字符读取时，每读取一个字符，系统可能需要加一次锁来确保数据的一致性。这种频繁的锁操作会增加额外的时间开销。</li>
<li>相比之下， <code>fgets()</code>  函数一次读取一整行，只要求一次锁，这样就减少了锁的频率，从而减少了时间消耗。</li>
</ul>
<p>因此，在复制文件时，如果可能的话，优先选择使用  <code>fgets()</code>  和  <code>fputs()</code>  函数进行批量读写，而不是逐个字符地使用  <code>fgetc()</code>  和  <code>fputc()</code> 。这样可以显著提高大文件复制的效率。</p>
<p><code>fwrite()</code>  的复制速度远快于上两种。</p>
<h2 id="格式化文本的输入输出"><a class="anchor" href="#格式化文本的输入输出">#</a> 格式化文本的输入输出</h2>
<h3 id="sscanf-和-sprintf"><a class="anchor" href="#sscanf-和-sprintf">#</a>  <code>sscanf()</code>  和  <code>sprintf()</code></h3>
<p><strong> <code>sscanf()</code>  函数</strong>：</p>
<ul>
<li>类似于  <code>scanf()</code> ，但  <code>sscanf()</code>  从指定的字符串而不是标准输入读取数据。</li>
<li>它根据提供的格式字符串解析输入字符串，并将解析出的数据存储在指定的变量中。</li>
<li>例如， <code>sscanf(&quot;10-5&quot;, &quot;%d&quot;, &amp;number)</code>  会从字符串 &quot;10-5&quot; 中读取整数值 10 并存储在变量  <code>number</code>  中。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// int sscanf(const char *str, const char *format, ...)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestSscanf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>src <span class="token operator">=</span> <span class="token string">"12.123"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">int</span> b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">sscanf</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> <span class="token string">"%2d.%3d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a: %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// a: 12</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"b: %d\n"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// b: 123</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong> <code>sprintf()</code>  函数</strong>：</p>
<ul>
<li>用于将格式化的数据写入一个字符串。</li>
<li>它类似于  <code>printf()</code> ，但输出目标是一个字符数组而不是标准输出。</li>
<li><code>sprintf()</code>  的第一个参数是目标字符串，后续参数是按照格式字符串格式化的数据。</li>
<li>例如， <code>sprintf(output, &quot;%d&quot;, number)</code>  会将变量  <code>number</code>  的值格式化为字符串，并存储在  <code>output</code>  字符串中。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// int sprintf(char *str, const char *format, ...)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestSprintf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>dest <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>src <span class="token operator">=</span> <span class="token string">"hi"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// hi</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    dest <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>dest <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// hhi</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>    dest <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">sprintf</span><span class="token punctuation">(</span>dest <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// hellohi</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="vscanf-和-vprintf"><a class="anchor" href="#vscanf-和-vprintf">#</a>  <code>vscanf()</code>  和  <code>vprintf()</code></h3>
<p><strong> <code>vprintf()</code>  函数</strong>：</p>
<ul>
<li><code>vprintf()</code>  函数与  <code>printf()</code>  类似，但可以接受变长参数列表  <code>va_list</code> ，这意味着它可以处理任意数量的参数。</li>
<li>它通常与  <code>va_start</code> 、 <code>va_arg</code>  和  <code>va_end</code>  宏一起使用，这些宏用于访问变长参数列表中的参数。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdarg.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestVprintf</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	va_list args<span class="token punctuation">;</span>           <span class="token comment">// 1. 获取第二个参数里所有的变量</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2. 每个变量对应自己的格式</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token function">vprintf</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3. 打印各变量，类比于 printf () 函数</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token function">TestVprintf</span><span class="token punctuation">(</span><span class="token string">"%d, %s\n"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"arguments"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2, arguments</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong> <code>vscanf()</code>  函数</strong>：</p>
<ul>
<li><code>vscanf()</code>  函数与  <code>scanf()</code>  类似，也接受变长参数列表  <code>va_list</code> ，允许从输入中读取任意数量和类型的数据。</li>
<li>同样，它需要与  <code>va_start</code> 、 <code>va_arg</code>  和  <code>va_end</code>  宏配合使用，以遍历和读取变长参数列表中的参数。</li>
</ul>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestVscanf</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>format<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	va_list args<span class="token punctuation">;</span> <span class="token comment">// 1. 获取第二个参数里所有的变量</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2. 每个变量对应自己的格式</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token function">vscanf</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">va_end</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">int</span> a<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">char</span> b<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token function">TestVscanf</span><span class="token punctuation">(</span><span class="token string">"%d %s"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//b 最多输入三个字符</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token function">TestVprintf</span><span class="token punctuation">(</span><span class="token string">"a: %d\nb: %s"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token comment">// printf("a: %d\nb: %s", a, b);</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="重定向标准输入输出流"><a class="anchor" href="#重定向标准输入输出流">#</a> 重定向标准输入输出流</h2>
<h3 id="freopen-将-stdout-重定向到其他文件流"><a class="anchor" href="#freopen-将-stdout-重定向到其他文件流">#</a>  <code>freopen()</code>  将  <code>stdout</code>  重定向到其他文件流</h3>
<p><code>freopen()</code>  函数是 C 语言标准库中用于重定向文件流的函数。以下是对  <code>freopen()</code>  函数的简要介绍和使用示例：</p>
<p>函数原型：</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre>FILE <span class="token operator">*</span><span class="token function">freopen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mode<span class="token punctuation">,</span> FILE <span class="token operator">*</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>参数说明：</p>
<ul>
<li><code>path</code> ：新文件的路径，可以是文件名或设备名称。</li>
<li><code>mode</code> ：打开文件的模式，如  <code>&quot;w&quot;</code> （写入）、 <code>&quot;a&quot;</code> （追加）等。</li>
<li><code>stream</code> ：要重定向的文件流，如  <code>stdout</code> 。</li>
</ul>
<p>返回值：</p>
<ul>
<li>成功时返回指向新文件流的指针。</li>
<li>失败时返回  <code>NULL</code> 。</li>
</ul>
<p>功能描述： <code>freopen()</code>  函数可以用于将一个已经打开的文件流重定向到另一个文件。这在需要将标准输出（ <code>stdout</code> ）或标准错误（ <code>stderr</code> ）重定向到文件而不是控制台时非常有用。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestFreopen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// attention: Chinese cannot be written here!</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token function">freopen</span><span class="token punctuation">(</span><span class="token string">"output.txt"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 stdout 文件流重定向到 output.log 文件中</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>freopen()</code>  函数确实能够将  <code>stdout</code>  重定向到文件，但它通常不会用来将  <code>stdout</code>  从文件重定向回控制台。这是因为  <code>freopen()</code>  的设计是用来打开或重新打开文件的，而不是用来重新绑定到标准输出流。</p>
<h3 id="dupdup2-将-stdout-重定向到其他文件流"><a class="anchor" href="#dupdup2-将-stdout-重定向到其他文件流">#</a>  <code>dup()</code> ， <code>dup2()</code>  将  <code>stdout</code>  重定向到其他文件流</h3>
<p><code>dup()</code>  函数： <code>dup()</code>  函数复制一个文件描述符，返回新的文件描述符。如果原文件描述符是标准输出（ <code>stdout</code> ）， <code>dup()</code>  可以复制它并保存，以便后续使用。</p>
<p><code>dup2()</code>  函数： <code>dup2()</code>  函数接受两个参数：要复制的文件描述符和目标文件描述符。它将第一个文件描述符指向的文件重定向到第二个文件描述符。</p>
<p>使用场景：当需要将  <code>stdout</code>  重定向到文件，并且之后可能需要恢复  <code>stdout</code>  到控制台输出时，可以使用  <code>dup()</code>  和  <code>dup2()</code>  函数。</p>
<p>每个文件流都与一个文件描述符相关联，而每个文件描述符都指向一个文件。例如，标准输出流  <code>stdout</code>  通常与控制台输出文件关联，我们可以将其视为  <code>stdout_A</code> 。当使用  <code>freopen()</code>  函数时，可以将  <code>stdout</code>  流重定向到另一个文件  <code>file_B</code> 。要将  <code>stdout</code>  流从  <code>file_B</code>  恢复到原始的控制台输出  <code>stdout_A</code> ，可以使用  <code>dup2()</code>  函数。 <code>dup2()</code>  函数通过复制一个现有的文件描述符到另一个文件描述符来实现重定向。在这个过程中，实际上是在修改  <code>stdout</code>  的底层文件描述符，使其重新指向原始的控制台输出。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//dup () 函数在不同系统下的头文件名</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__APPLE__<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">defined</span><span class="token punctuation">(</span>__linux__<span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>_WIN32<span class="token punctuation">)</span></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">include</span> <span class="token string">&lt;io.h></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 1. 是否要转化为文件流</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">// 2. 转化之前是否是控制台输出的文件流</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestDup</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">static</span> <span class="token keyword">int</span> save_stdout_no <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 定义一个文件描述符，-1 为控制台输出</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token comment">// 将 stdout 重定向至 其他文件流</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>save_stdout_no <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>			<span class="token comment">// 如果此时为控制台输出</span></pre></td></tr><tr><td data-num="19"></td><td><pre>			<span class="token comment">// 保存 stdout 控制台输出的文件描述符</span></pre></td></tr><tr><td data-num="20"></td><td><pre>			save_stdout_no <span class="token operator">=</span> <span class="token function">dup</span><span class="token punctuation">(</span><span class="token function">fileno</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// 将控制台缓存全部清除</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		<span class="token function">freopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件流之间的相互转化可借助文件名进行，stdout 没有对应文件名，所以麻烦了点</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token comment">// 如果文件名为 NULL，说明想恢复至原有的 stdout 文件流</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token keyword">if</span> <span class="token punctuation">(</span>save_stdout_no <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>			<span class="token comment">// 不在控制台输出，需要转换为控制台输出；否则就是在控制台输出，不需要转换</span></pre></td></tr><tr><td data-num="30"></td><td><pre>			<span class="token function">fflush</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>			<span class="token function">dup2</span><span class="token punctuation">(</span>save_stdout_no<span class="token punctuation">,</span> <span class="token function">fileno</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>			<span class="token function">close</span><span class="token punctuation">(</span>save_stdout_no<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>			save_stdout_no <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 在控制台输出就是 -1</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// 控制台</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	<span class="token function">TestDup</span><span class="token punctuation">(</span><span class="token string">"output.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转为 output.log</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token function">TestDup</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转为控制台</span></pre></td></tr><tr><td data-num="43"></td><td><pre>	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>	<span class="token function">TestDup</span><span class="token punctuation">(</span><span class="token string">"output.log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转为 output.log</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token function">TestDup</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转为控制台</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>程序运行结果为 1 3 end 输出在控制台，而 2 4 输出在 output.log 文件中。但 msvc 编译器下运行结果有误，mingw 编译器下运行结果无误。原因暂且未知。</p>
<h2 id="统计文件字符个数"><a class="anchor" href="#统计文件字符个数">#</a> 统计文件字符个数</h2>
<h3 id="统计中文文本字符个数"><a class="anchor" href="#统计中文文本字符个数">#</a> 统计中文文本字符个数</h3>
<ol>
<li>
<p><strong>使用宽字符函数</strong>：可以使用  <code>wcslen()</code>  函数来获取宽字符串（通常用于表示 Unicode 或其他多字节字符集）的长度。 <code>fgetws()</code>  函数用于从文件中读取宽字符串。</p>
</li>
<li>
<p><strong>设置编码</strong>：在不同操作系统中设置特定编码的方法有所不同：</p>
<ul>
<li>在 <strong>Windows</strong> 系统下，设置 GBK 编码使用  <code>setlocale(LC_ALL, &quot;chs&quot;)</code> 。</li>
<li>在 <strong>Linux</strong> 和 <strong>Mac</strong> 系统下，设置 GBK 编码使用  <code>setlocale(LC_ALL, &quot;zh_CN.gbk&quot;)</code> 。</li>
</ul>
<p>对于 UTF-8 编码，设置方法在不同系统中是一致的，使用  <code>setlocale(LC_ALL, &quot;zh_CN.utf-8&quot;)</code> 。</p>
</li>
<li>
<p><strong>文件读取</strong>：在设置了正确的编码之后，使用  <code>fopen()</code>  函数以读取模式打开文件。不同系统下打开文件的代码略有差异：</p>
<ul>
<li>在 <strong>Windows</strong> 系统下，读取 UTF-8 编码的文件需要指定编码，例如  <code>fopen(filename, &quot;r, ccs=utf-8&quot;)</code> 。</li>
<li>在 <strong>Linux</strong> 和 <strong>Mac</strong> 系统下，打开文件的代码为  <code>fopen(filename, &quot;r&quot;)</code> 。</li>
</ul>
</li>
</ol>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;locale.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;wchar.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 设定错误类型</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ERROR_ILLEGAL_FILENAME</span> <span class="token expression"><span class="token operator">-</span><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ERROR_CANNOT_OPEN_FILE</span> <span class="token expression"><span class="token operator">-</span><span class="token number">2</span></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ERROR_READ_FILE</span> <span class="token expression"><span class="token operator">-</span><span class="token number">3</span></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ERROR_UNSUPPORTED_CHARSET</span> <span class="token expression"><span class="token operator">-</span><span class="token number">99</span></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CHARSET_UTF8</span> <span class="token expression"><span class="token number">0</span></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">CHARSET_GBK</span> <span class="token expression"><span class="token number">1</span></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">512</span></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">int</span> <span class="token function">CountCharactersInFile</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token keyword">const</span> <span class="token operator">*</span>filename<span class="token punctuation">,</span> <span class="token keyword">int</span> charset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>filename <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ERROR_ILLEGAL_FILENAME<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>	FILE <span class="token operator">*</span>file<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token comment">// 不同编码格式，执行不同操作</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token keyword">switch</span> <span class="token punctuation">(</span>charset<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token keyword">case</span> CHARSET_GBK<span class="token operator">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_WIN32  </span><span class="token comment">// 设定不同系统对应的 GBK 编码</span></span></pre></td></tr><tr><td data-num="26"></td><td><pre>			<span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">"chs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span></pre></td></tr><tr><td data-num="28"></td><td><pre>			<span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">"zh_CN.gbk"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>			file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token keyword">case</span> CHARSET_UTF8<span class="token operator">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>			<span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">"zh_CN.utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不同系统下设定 utf-8 方法相同</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_WIN32 </span><span class="token comment">// 不同系统使用 utf-8 格式，读取的方法有差别</span></span></pre></td></tr><tr><td data-num="38"></td><td><pre>		file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"r, ccs=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span></pre></td></tr><tr><td data-num="40"></td><td><pre>			file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="42"></td><td><pre>			<span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>		<span class="token keyword">default</span><span class="token operator">:</span> <span class="token keyword">return</span> ERROR_UNSUPPORTED_CHARSET<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token comment">// 文件打开失败</span></pre></td></tr><tr><td data-num="48"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token keyword">return</span> ERROR_CANNOT_OPEN_FILE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>	<span class="token comment">// 文件打开成功</span></pre></td></tr><tr><td data-num="51"></td><td><pre>	<span class="token class-name">wchar_t</span> wcs<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgetws</span><span class="token punctuation">(</span>wcs<span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>		<span class="token comment">// 文件没读完</span></pre></td></tr><tr><td data-num="55"></td><td><pre>		count <span class="token operator">+=</span> <span class="token function">wcslen</span><span class="token punctuation">(</span>wcs<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 读取的字符个数加和</span></pre></td></tr><tr><td data-num="56"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>	<span class="token comment">// 文件读完，判断读完的原因</span></pre></td></tr><tr><td data-num="58"></td><td><pre>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ferror</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"method error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>		<span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 文件打开就要关闭，注意！！</span></pre></td></tr><tr><td data-num="61"></td><td><pre>		<span class="token keyword">return</span> ERROR_READ_FILE<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>	<span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>	<span class="token keyword">return</span> count<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>	<span class="token function">TestWchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre></pre></td></tr><tr><td data-num="71"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"data/sanguo_gbk.txt: %d\n"</span><span class="token punctuation">,</span> <span class="token function">CountCharactersInFile</span><span class="token punctuation">(</span><span class="token string">"data/sanguo_gbk.txt"</span><span class="token punctuation">,</span> CHARSET_GBK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"data/sanguo_utf8.txt: %d\n"</span><span class="token punctuation">,</span> <span class="token function">CountCharactersInFile</span><span class="token punctuation">(</span><span class="token string">"data/sanguo_utf8.txt"</span><span class="token punctuation">,</span> CHARSET_UTF8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"data/CMakeLists_gbk.txt: %d\n"</span><span class="token punctuation">,</span> <span class="token function">CountCharactersInFile</span><span class="token punctuation">(</span><span class="token string">"data/CMakeLists_gbk.txt"</span><span class="token punctuation">,</span> CHARSET_GBK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"data/CMakeLists_utf8.txt: %d\n"</span><span class="token punctuation">,</span> <span class="token function">CountCharactersInFile</span><span class="token punctuation">(</span><span class="token string">"data/CMakeLists_utf8.txt"</span><span class="token punctuation">,</span> CHARSET_UTF8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre></pre></td></tr><tr><td data-num="77"></td><td><pre>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="统计英文文本字符个数"><a class="anchor" href="#统计英文文本字符个数">#</a> 统计英文文本字符个数</h3>
<p>统计英文字符个数通常使用窄字符（单字节字符）相关的函数，如  <code>strlen()</code>  和  <code>fgets()</code> 。这些函数适用于处理英文字符，因为英文字符通常只占用一个字符宽度。然而，也可以使用宽字符函数来统计字符个数，尤其是当涉及到多字节字符集或需要与宽字符函数兼容时。</p>
<p>以下是统计英文字符个数的方法：</p>
<ol>
<li><strong>使用窄字符函数</strong>：
<ul>
<li><code>strlen()</code>  函数返回字符串中窄字符的数量，不包括结尾的空字符。</li>
<li><code>fgets()</code>  函数从文件中读取一行文本到缓冲区，可以结合  <code>strlen()</code>  使用。</li>
</ul>
</li>
<li><strong>使用宽字符函数</strong>：
<ul>
<li><code>wcslen()</code>  函数返回宽字符串中宽字符的数量，不包括结尾的空宽字符。</li>
<li><code>fgetws()</code>  函数从文件中读取一行宽字符到宽字符缓冲区。</li>
</ul>
</li>
</ol>
<p><strong>注意</strong>：</p>
<ul>
<li>当使用宽字符函数统计字符个数时，需要确保文件的编码格式与程序中设置的编码格式一致。如果不一致，可能会导致统计结果不准确。</li>
<li>在 Windows 平台上，使用 MinGW 或 MSVC 编译器时，需要注意编译器的默认编码格式。如果文件编码格式与编译器默认编码格式不一致，可能会导致程序错误或不正确的输出。</li>
</ul>
<p><strong>编译器和文件编码一致性</strong>：</p>
<ul>
<li>确保文件本身的编码格式与编译器使用的编码格式一致。</li>
<li>如果使用宽字符函数，还需要确保程序代码中设置的编码格式与文件编码格式一致。</li>
</ul>
<h2 id="输入输出流的位置"><a class="anchor" href="#输入输出流的位置">#</a> 输入输出流的位置</h2>
<h3 id="获取文件流的读取位置"><a class="anchor" href="#获取文件流的读取位置">#</a> 获取文件流的读取位置</h3>
<p><code>ftell()</code>  函数返回当前文件流的读取位置，即从文件开头到当前读取点的字节偏移量</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestFtell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"CMakeLists.txt"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以二进制读取模式打开文件</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Error opening file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 在读取任何内容之前，读取位置应该是 0</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">long</span> position <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Initial position: %ld\n"</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Initial position: 0</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 定义缓冲区大小</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">const</span> <span class="token class-name">size_t</span> BUFFER_SIZE <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 读取一定数量的字节到缓冲区</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    position <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Position after first read: %ld\n"</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Position after first read: 128</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment">// 继续读取更多字节</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    position <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Position after second read: %ld\n"</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Position after second read: 256</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token comment">// 关闭文件</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token function">TestFtell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>首先以二进制模式打开了一个文件。然后使用  <code>ftell()</code>  函数来打印文件流的初始读取位置，这应该是 0。接着读取 128 字节到缓冲区，再次使用  <code>ftell()</code>  来打印新的读取位置，这将是 128。再次读取 128 字节，并打印当前的读取位置，它将是 256。</p>
<p>注意， <code>ftell()</code>  函数返回的是一个  <code>long</code>  类型的值，它表示从文件开头到当前读取点的字节偏移量。</p>
<h3 id="设定窄字符下的文件流读取位置"><a class="anchor" href="#设定窄字符下的文件流读取位置">#</a> 设定窄字符下的文件流读取位置</h3>
<p><code>fseek()</code>  函数可以改变文件流的当前位置，其使用方式如下：</p>
<ol>
<li><strong>从文件开头偏移</strong>：使用  <code>SEEK_SET</code>  标志，从文件开头开始偏移。</li>
<li><strong>从当前位置偏移</strong>：使用  <code>SEEK_CUR</code>  标志，从当前文件流的位置开始偏移。</li>
<li><strong>从文件末尾偏移</strong>：使用  <code>SEEK_END</code>  标志，从文件末尾开始偏移。</li>
</ol>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestfSeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"CMakeLists.txt"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以二进制模式打开文件</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Error opening file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 从文件开头偏移 10 个字节</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">fseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token constant">SEEK_SET</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">long</span> position <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: %ld\n"</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 预期位置: 10</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// 从当前位置再偏移 15 个字节</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token function">fseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token constant">SEEK_CUR</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    position <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: %ld\n"</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 预期位置: 25</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment">// 从文件末尾偏移 -10 个字节</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token function">fseek</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token constant">SEEK_END</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    position <span class="token operator">=</span> <span class="token function">ftell</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: %ld\n"</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 根据文件实际大小，预期位置可能会变化</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token function">TestfSeek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意</strong>：</p>
<ul>
<li><code>ftell()</code>  和  <code>fseek()</code>  函数通常用于二进制文件流，因为它们基于字节进行操作。</li>
<li>在文本文件中，由于可能涉及字符编码转换， <code>ftell()</code>  可能不会返回实际读取的字节数。</li>
<li>宽字符和多字节字符编码可能导致  <code>fseek()</code>  在设置偏移量时出现问题，因为它可能将指针设置在字符的中间。</li>
</ul>
<h3 id="读取和设定宽字符下的文件流位置"><a class="anchor" href="#读取和设定宽字符下的文件流位置">#</a> 读取和设定宽字符下的文件流位置</h3>
<p><code>fgetpos()</code>  函数用于获取当前文件流的位置，并将其存储在  <code>fpos_t</code>  类型的变量中。 <code>fsetpos()</code>  函数则用于将文件流的位置设置为之前使用  <code>fgetpos()</code>  获取的位置。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestFsetpos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">,</span> <span class="token string">"w+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 以读写模式打开文件</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Error opening file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">fpos_t</span> position<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 获取当前文件流位置</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token function">fgetpos</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 写入一些数据</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 再次获取文件流位置</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">fgetpos</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 将文件流位置设置回之前的位置</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token function">fsetpos</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token operator">&amp;</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 打印当前位置，应该是写入 "hello" 前的位置加上 "hello" 的长度</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"position: %lld\n"</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">TestFsetpos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意</strong>：</p>
<ul>
<li><code>fgetpos()</code>  和  <code>fsetpos()</code>  函数的返回类型是  <code>int</code> ，而不是  <code>fpos_t</code> 。成功时返回 0，失败时返回非零值。</li>
<li>并非所有文件流都支持  <code>fsetpos()</code>  函数。例如，标准输出  <code>stdout</code>  不支持随机访问。</li>
<li>在某些系统或编译器中， <code>stdout</code>  的文件位置可能被设置为 0 或其他值，这取决于实现。</li>
</ul>
<h2 id="其他常见的文件操作"><a class="anchor" href="#其他常见的文件操作">#</a> 其他常见的文件操作</h2>
<h3 id="删除文件"><a class="anchor" href="#删除文件">#</a> 删除文件</h3>
<p><code>remove()</code>  函数尝试删除指定路径的文件。如果文件成功删除，函数返回 0；如果发生错误，如文件不存在或权限不足，函数返回 -1。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 尝试删除 "data/main.c" 文件</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"data/main.c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Deletion result of 'data/main.c': %d\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>	 <span class="token comment">// 如果文件存在并被删除，输出 0</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 尝试删除 "data/main2.c" 文件</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> result2 <span class="token operator">=</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"data/main2.c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Deletion result of 'data/main2.c': %d\n"</span><span class="token punctuation">,</span> result2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 如果文件不存在或无法删除，输出 -1</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token function">TestRemove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意</strong>：</p>
<ul>
<li>使用  <code>remove()</code>  函数时，需要确保程序有足够的权限来删除指定的文件。</li>
<li>如果文件正在被使用或程序没有足够的权限，删除操作可能会失败。</li>
<li>在调用  <code>remove()</code>  之前，最好检查文件是否存在，以避免不必要的错误。</li>
</ul>
<h3 id="重命名"><a class="anchor" href="#重命名">#</a> 重命名</h3>
<p><code>rename()</code>  函数尝试将指定的文件或目录重命名。如果重命名成功，函数返回 0；如果发生错误，如源文件不存在或权限不足，函数返回 -1。</p>
<p>在使用  <code>rename()</code>  函数处理包含中文字符的文件名时，确保环境正确设置为支持 UTF-8 编码是必要的。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;locale.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestRename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 设置 locale 以支持 UTF-8 编码的文件名</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">setlocale</span><span class="token punctuation">(</span>LC_ALL<span class="token punctuation">,</span> <span class="token string">"zh_CN.utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 尝试重命名文件</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">"data/三国演义.txt"</span><span class="token punctuation">,</span> <span class="token string">"data/sanguo.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Renaming 'data/三国演义.txt' to 'data/sanguo.txt' succeeded.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Failed to rename 'data/三国演义.txt'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"result: %d\n"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// result: 0</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 尝试重命名另一个文件</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">int</span> result2 <span class="token operator">=</span> <span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">"data/main2.c"</span><span class="token punctuation">,</span> <span class="token string">"data/main.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Renaming 'data/main2.c' to 'data/main.txt' succeeded.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Failed to rename 'data/main2.c'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"result: %d\n"</span><span class="token punctuation">,</span> result2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//result: -1 或其他值，取决于操作是否成功</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token function">TestRename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意</strong>：</p>
<ul>
<li>在调用  <code>rename()</code>  之前，使用  <code>setlocale()</code>  设置适当的区域设置，以确保程序可以正确处理 UTF-8 编码的文件名。</li>
<li>如果  <code>rename()</code>  调用失败， <code>perror()</code>  函数可以用来输出错误信息。</li>
<li>确保源文件和目标文件名在文件系统中不会导致冲突或权限问题。</li>
</ul>
<h3 id="创建临时文件"><a class="anchor" href="#创建临时文件">#</a> 创建临时文件</h3>
<p><strong>创建临时文件</strong>：</p>
<ol>
<li><strong>使用  <code>tmpfile()</code>  函数</strong>：此函数创建一个临时文件，该文件在程序退出时自动删除。它返回一个指向新创建的文件流的指针。</li>
<li><strong>获取临时文件路径</strong>：在某些编译器（如 MSVC）中，可以通过类型转换和结构体来获取临时文件的路径和文件名。 <code>WinFile</code>  结构体中的  <code>_tmpfname</code>  成员存储了文件的路径。</li>
<li><strong>使用  <code>tmpnam()</code>  函数</strong>：此函数生成一个唯一的文件名，存储在提供的缓冲区中。确保缓冲区的大小至少为  <code>L_tmpnam</code> ，以避免溢出。</li>
</ol>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">void</span> <span class="token function">TestTmpfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 创建临时文件</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    FILE <span class="token operator">*</span>file <span class="token operator">=</span> <span class="token function">tmpfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Failed to create temporary file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 在 MSVC 编译器中，可以通过特定方式获取临时文件的路径</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_MSC_VER</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">union</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            FILE _public_file<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">char</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">char</span> <span class="token operator">*</span>_base<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">int</span> _cnt<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">int</span> _flags<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">int</span> _file<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">int</span> _charbuf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">int</span> _bufsiz<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">char</span> <span class="token operator">*</span>_tmpfname<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span> WinFile<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>    WinFile <span class="token operator">*</span>win_file <span class="token operator">=</span> <span class="token punctuation">(</span>WinFile <span class="token operator">*</span><span class="token punctuation">)</span>file<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>win_file<span class="token operator">-></span>_tmpfname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示临时文件的路径 C:\Users\ 用户名 \AppData\Local\Temp\tzg.0</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token comment">// 使用 tmpnam () 获取临时文件名及路径</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>L_tmpnam<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token function">tmpnam</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token function">puts</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 显示由 tmpnam () 生成的临时文件路径</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token comment">// 关闭临时文件</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token function">TestTmpfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意</strong>：</p>
<ul>
<li><code>tmpfile()</code>  函数创建的临时文件仅用于二进制写入和读取，不支持追加或文本模式。</li>
<li>使用  <code>tmpnam()</code>  函数时，每次调用都会生成一个新的唯一文件名。</li>
</ul>
<h3 id="获取文件大小"><a class="anchor" href="#获取文件大小">#</a> 获取文件大小</h3>
<p>要获取文件的大小，可以使用  <code>struct stat</code>  结构体和  <code>stat()</code>  函数。 <code>stat()</code>  函数获取文件信息并填充  <code>struct stat</code>  结构体，其中  <code>st_size</code>  成员包含了文件的大小。</p>
<p>此代码在 msvc 编译器（无中文注释）的情况下成功运行，一旦加入中文注释，运行结果便会出错。在 mingw 编译器下可成功运行，结果与 msvc 编译器（无中文注释）的结果相同。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">long</span> <span class="token function">GetFileSize</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stat</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 成功获取文件状态</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> st<span class="token punctuation">.</span>st_size<span class="token punctuation">;</span>  <span class="token comment">// 返回文件大小</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Failed to get file size"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 发生错误时返回 -1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>filename <span class="token operator">=</span> <span class="token string">"example.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">long</span> size <span class="token operator">=</span> <span class="token function">GetFileSize</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The size of '%s' is: %ld bytes\n"</span><span class="token punctuation">,</span> filename<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意</strong>：</p>
<ul>
<li><code>stat()</code>  函数的第二个参数需要一个  <code>struct stat</code>  类型的指针。</li>
<li><code>st.st_size</code>  成员是一个  <code>long</code>  类型的值，它仅支持返回最大 4GB 的文件大小。</li>
<li>如果需要支持更大的文件，可以使用  <code>_stat64i32</code>  或  <code>_stat64</code> （取决于平台和编译器）。</li>
</ul>
<h3 id="判断是否为目录"><a class="anchor" href="#判断是否为目录">#</a> 判断是否为目录</h3>
<p>要判断一个给定的文件名是否指向一个目录，可以使用  <code>struct stat</code>  结构体和  <code>stat()</code>  函数。 <code>st_mode</code>  成员包含了文件的类型和权限模式，通过与  <code>S_IFDIR</code>  宏进行位运算，可以检查文件是否为目录。</p>
<figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> <span class="token function">IsDirectory</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stat</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 成功获取文件状态</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> <span class="token function">S_ISDIR</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>st_mode<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 使用 S_ISDIR 宏判断是否为目录</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Failed to get file status"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 发生错误时返回 -1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>path <span class="token operator">=</span> <span class="token string">"example_directory"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsDirectory</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"'%s' is a directory.\n"</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"'%s' is not a directory.\n"</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>注意</strong>：</p>
<ul>
<li><code>S_ISDIR()</code>  是一个宏，用于检查  <code>st_mode</code>  是否表示目录。</li>
<li><code>stat()</code>  函数的第二个参数需要一个  <code>struct stat</code>  类型的指针。</li>
<li>如果  <code>stat()</code>  调用失败，会打印错误信息并返回  <code>-1</code> 。</li>
</ul>
<div class="tags"><a href="/tags/c/" rel="tag"><i class="ic i-tag"></i>C</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于 </span><time title="修改时间：2024-12-11 16:21:34" itemprop="dateModified" datetime="2024-12-11T16:21:34+08:00">2024-12-11</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>樱小路七叶<i class="ic i-at"><em>@</em></i>Nana7ha's Café Stella</li><li class="link"><strong>本文链接：</strong><a href="http://cwlrin.wiki/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E6%B5%81/" title="C 语言文件流">http://cwlrin.wiki/c-cpp/c-base/C 语言文件流/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%8E%92%E5%BA%8F/" rel="prev" itemprop="url" title="C 语言排序" style="background-image: linear-gradient(to bottom right, #eac289, #fddedd);"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>C 语言基础</span><h3>C 语言排序</h3></a></div><div class="item right"><a href="/c-cpp/linux-c/Linux%20C%20%E5%9F%BA%E7%A1%80/" rel="next" itemprop="url" title="Linux C 基础" style="background-image: linear-gradient(to bottom right, #f7f6c8, #c1a7b5);"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>Linux C</span><h3>Linux C 基础</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81"><span class="toc-number">1.</span> <span class="toc-text"> 输入输出流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text"> 文件打开方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E5%A4%B1%E8%B4%A5"><span class="toc-number">1.2.</span> <span class="toc-text"> 文件打开失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E6%88%90%E5%8A%9F"><span class="toc-number">1.3.</span> <span class="toc-text"> 文件打开成功</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%B5%81%E7%9A%84%E7%BC%93%E5%86%B2"><span class="toc-number">2.</span> <span class="toc-text"> 文件流的缓冲</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E7%9A%84%E6%9D%A5%E6%BA%90"><span class="toc-number">2.1.</span> <span class="toc-text"> 缓冲的来源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%86%B2%E5%8C%BA%E5%A4%A7%E5%B0%8F"><span class="toc-number">2.2.</span> <span class="toc-text"> 设置缓冲区大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E6%B8%85%E7%A9%BA"><span class="toc-number">2.3.</span> <span class="toc-text"> 缓冲区的生命周期和清空</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6"><span class="toc-number">3.</span> <span class="toc-text"> 读写一个字符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6"><span class="toc-number">3.1.</span> <span class="toc-text"> 读一个字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E4%B8%80%E4%B8%AA%E5%AD%97%E7%AC%A6"><span class="toc-number">3.2.</span> <span class="toc-text"> 写一个字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E5%B0%86%E5%85%B6%E6%89%93%E5%8D%B0%E8%87%B3%E6%8E%A7%E5%88%B6%E5%8F%B0"><span class="toc-number">3.3.</span> <span class="toc-text"> 读取一个文件将其打印至控制台</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E4%B8%80%E8%A1%8C%E5%AD%97%E7%AC%A6"><span class="toc-number">4.</span> <span class="toc-text"> 读写一行字符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E4%B8%80%E8%A1%8C%E5%AD%97%E7%AC%A6"><span class="toc-number">4.1.</span> <span class="toc-text"> 读一行字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E4%B8%80%E8%A1%8C%E5%AD%97%E7%AC%A6"><span class="toc-number">4.2.</span> <span class="toc-text"> 写一行字符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E6%8C%87%E5%AE%9A%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%AD%97%E8%8A%82"><span class="toc-number">5.</span> <span class="toc-text"> 读写指定大小的字节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E8%8A%82"><span class="toc-number">5.1.</span> <span class="toc-text"> 字节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%AD%97%E8%8A%82"><span class="toc-number">5.2.</span> <span class="toc-text"> 读字节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%AD%97%E8%8A%82"><span class="toc-number">5.3.</span> <span class="toc-text"> 写字节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.</span> <span class="toc-text"> 序列化和反序列化的基本实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E5%88%B6%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text"> 复制一个文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">7.1.</span> <span class="toc-text"> 方法一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">7.2.</span> <span class="toc-text"> 方法二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89"><span class="toc-number">7.3.</span> <span class="toc-text"> 方法三</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%96%B9%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E5%AF%B9%E6%AF%94"><span class="toc-number">7.4.</span> <span class="toc-text"> 三种方法的时间对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%96%87%E6%9C%AC%E7%9A%84%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA"><span class="toc-number">8.</span> <span class="toc-text"> 格式化文本的输入输出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sscanf-%E5%92%8C-sprintf"><span class="toc-number">8.1.</span> <span class="toc-text">  sscanf()  和  sprintf()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vscanf-%E5%92%8C-vprintf"><span class="toc-number">8.2.</span> <span class="toc-text">  vscanf()  和  vprintf()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E5%90%91%E6%A0%87%E5%87%86%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81"><span class="toc-number">9.</span> <span class="toc-text"> 重定向标准输入输出流</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#freopen-%E5%B0%86-stdout-%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E6%B5%81"><span class="toc-number">9.1.</span> <span class="toc-text">  freopen()  将  stdout  重定向到其他文件流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dupdup2-%E5%B0%86-stdout-%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E6%B5%81"><span class="toc-number">9.2.</span> <span class="toc-text">  dup() ， dup2()  将  stdout  重定向到其他文件流</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E5%AD%97%E7%AC%A6%E4%B8%AA%E6%95%B0"><span class="toc-number">10.</span> <span class="toc-text"> 统计文件字符个数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E4%B8%AD%E6%96%87%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%AA%E6%95%B0"><span class="toc-number">10.1.</span> <span class="toc-text"> 统计中文文本字符个数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E8%8B%B1%E6%96%87%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%AA%E6%95%B0"><span class="toc-number">10.2.</span> <span class="toc-text"> 统计英文文本字符个数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%B5%81%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">11.</span> <span class="toc-text"> 输入输出流的位置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E6%B5%81%E7%9A%84%E8%AF%BB%E5%8F%96%E4%BD%8D%E7%BD%AE"><span class="toc-number">11.1.</span> <span class="toc-text"> 获取文件流的读取位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E5%AE%9A%E7%AA%84%E5%AD%97%E7%AC%A6%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E6%B5%81%E8%AF%BB%E5%8F%96%E4%BD%8D%E7%BD%AE"><span class="toc-number">11.2.</span> <span class="toc-text"> 设定窄字符下的文件流读取位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%92%8C%E8%AE%BE%E5%AE%9A%E5%AE%BD%E5%AD%97%E7%AC%A6%E4%B8%8B%E7%9A%84%E6%96%87%E4%BB%B6%E6%B5%81%E4%BD%8D%E7%BD%AE"><span class="toc-number">11.3.</span> <span class="toc-text"> 读取和设定宽字符下的文件流位置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B8%B8%E8%A7%81%E7%9A%84%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">12.</span> <span class="toc-text"> 其他常见的文件操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6"><span class="toc-number">12.1.</span> <span class="toc-text"> 删除文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D"><span class="toc-number">12.2.</span> <span class="toc-text"> 重命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6"><span class="toc-number">12.3.</span> <span class="toc-text"> 创建临时文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%96%87%E4%BB%B6%E5%A4%A7%E5%B0%8F"><span class="toc-number">12.4.</span> <span class="toc-text"> 获取文件大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E6%98%AF%E5%90%A6%E4%B8%BA%E7%9B%AE%E5%BD%95"><span class="toc-number">12.5.</span> <span class="toc-text"> 判断是否为目录</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" rel="bookmark" title="C 语言数据类型">C 语言数据类型</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E8%AF%AD%E5%8F%A5/" rel="bookmark" title="C 语言语句">C 语言语句</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0/" rel="bookmark" title="C 语言函数">C 语言函数</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E5%A4%B4%E6%96%87%E4%BB%B6/" rel="bookmark" title="C 语言头文件">C 语言头文件</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%95%B0%E7%BB%84/" rel="bookmark" title="C 语言数组">C 语言数组</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E5%AD%97%E7%AC%A6%E4%B8%B2/" rel="bookmark" title="C 语言字符串">C 语言字符串</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E7%BB%93%E6%9E%84%E4%BD%93/" rel="bookmark" title="C 语言结构体">C 语言结构体</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%8C%87%E9%92%88/" rel="bookmark" title="C语言指针">C语言指针</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E9%93%BE%E8%A1%A8/" rel="bookmark" title="C 语言数据结构——链表">C 语言数据结构——链表</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E6%A0%88/" rel="bookmark" title="C 语言数据结构——栈">C 语言数据结构——栈</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E9%98%9F%E5%88%97/" rel="bookmark" title="C 语言数据结构——队列">C 语言数据结构——队列</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E5%93%88%E5%B8%8C%E8%A1%A8/" rel="bookmark" title="C 语言数据结构——哈希表">C 语言数据结构——哈希表</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/" rel="bookmark" title="C 语言数据结构——二叉搜索树">C 语言数据结构——二叉搜索树</a></li><li ><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%8E%92%E5%BA%8F/" rel="bookmark" title="C 语言排序">C 语言排序</a></li><li  class="active"><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%96%87%E4%BB%B6%E6%B5%81/" rel="bookmark" title="C 语言文件流">C 语言文件流</a></li><li ><a href="/c-cpp/c-base/%E8%BF%9B%E7%A8%8B%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4/" rel="bookmark" title="进程虚拟内存空间">进程虚拟内存空间</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="樱小路七叶" src="/assets/avatar.jpg"/><p class="name" itemprop="name">樱小路七叶</p><div class="description" itemprop="description">技术与美日新月异</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">91</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">11</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">13</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/cwlrin" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;cwlrin"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://www.zhihu.com/people/ying-xiao-lu-qi-ye" class="item zhihu" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;ying-xiao-lu-qi-ye"><i class="ic i-zhihu"></i></a><a target="_blank" rel="noopener" href="https://music.163.com/#/user/home?id=411590211" class="item music" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;411590211"><i class="ic i-cloud-music"></i></a><a target="_blank" rel="noopener" href="https://space.bilibili.com/8013992" class="item bilibili" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;8013992"><i class="ic i-bilibili"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li></ul></li><li class="item dropdown"><a href="#" onclick="return false;"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/c-cpp/linux-c/Linux%20C%20%E5%9F%BA%E7%A1%80/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/c-cpp/c-base/C%20%E8%AF%AD%E8%A8%80%E6%8E%92%E5%BA%8F/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"></div><div class="status"><div class="copyright">&copy; 2020 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">樱小路七叶 @ 七葉の喫茶ステラ</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.4m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">21:46</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
    path: `c-cpp/c-base/C 语言文件流/`,
    favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    nocopy: "false",
    copyright: `复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。`,
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};
</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha384-Zm+UU4tdcfAm29vg+MTbfu&#x2F;&#x2F;q5B&#x2F;lInMbMCr4T8c9rQFyOv6PlfQYpB5wItcXWe7" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" integrity="sha384-TOxsBplaL96&#x2F;QDWPIUg+ye3v89qSE3s22XNtJMmCeZEep3cVDmXy1zEfZvVv+y2m" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.20" type="module" fetchpriority="high" defer></script></body></html>